Ext.apply(Ext,{clone:function(obj){return Ext.apply({},obj)},copyToIf:function(target,source,notFields){notFields=notFields||[];for(var p in source){if(notFields.indexOf(p)<0){target[p]=source[p]}}return target},extendX:function(supr,fn,scope){return Ext.extend(supr,fn.call(scope||window,supr.prototype))},del:function(o,args){var ps=Array.prototype.splice.call(arguments,1);Ext.each(ps,function(p){delete o[p]})},args:function(){var args=arguments.callee.caller.arguments;if(Ext.isArray(args[0])){return args[0]}else{return Array.prototype.slice.call(args,0)}return args},pluckRecord:function(arr,prop){var ret=[],val;Ext.each(arr,function(v){if(v.get){ret.push(v.get(prop))}else{ret.push(window.undefined)}});return ret},getObjVal:function(o,v){try{if(!o){return null}if(!v){return o}var ps=v.split("."),val=o;for(var i=0;i<ps.length;i++){if(!val){return null}val=val[ps[i]]}return val}catch(e){return null}},objPcount:function(o){var count=0;if(typeof o=="object"){for(var p in o){if(o.hasOwnProperty(p)){count++}}}return count},urlAppend:function(url,s){if(!Ext.isEmpty(s)){if(Ext.isObject(s)){s=Ext.urlEncode(s)}return url+(url.indexOf("?")===-1?"?":"&")+s}return url},formatMoney:function(v,num){if(typeof v!=="number"){var v=parseFloat(v);if(isNaN(v)){return 0}}num=num||0;return parseFloat(Math.round(v*Math.pow(10,num))/Math.pow(10,num).toFixed(num))},arr2Map:function(key){var arr=Ext.combine.apply(Ext,Array.prototype.slice.call(arguments,1));var obj={};if(arr.length){Ext.each(arr,function(o){if(Ext.isDefined(o[key])){obj[o[key]]=o}})}return obj},arr2obj:function(arr,valPrefix,fields,filterFn){var values={};var getV=function(v){if(v&&v.value!==undefined){v=v.value}else{if(v&&v.id!==undefined){v=v.id}}if(v&&typeof v=="object"&&v.clearTime){v=v.format("Y-m-d")}return v};if(Ext.isArray(valPrefix)){valPrefix="";if(Ext.isFunction(fields)){filterFn=fields;fields=null}fields=valPrefix}valPrefix=valPrefix||"";if(Ext.isArray(arr)){Ext.each(arr,function(data,i){if(data instanceof Ext.data.Record){data=data.data}if(fields&&fields.length){if(!Ext.isFunction(filterFn)||filterFn(data)!==false){for(var j=0;j<fields.length;j++){var p=fields[j];var k=valPrefix+p;values[k]=values[k]||[];values[k][i]=getV(data[p])}}}else{if(!Ext.isFunction(filterFn)||filterFn(data)!==false){for(var p in data){var k=valPrefix+p;values[k]=values[k]||[];values[k][i]=getV(data[p])}}}})}return values}});Ext.applyIf(Array.prototype,{copy:function(){return this.slice()},isEmpty:function(){if(this.length&&this.length>0){return false}return true},removeAt:function(index){this.splice(index,1)},removeKey:function(keyValue,keyName){keyName=keyName||"id";Ext.each(this,function(o,i){if(o[keyName]==keyValue){this.removeAt(i);return}},this)},contains:function(obj){return(this.indexOf(obj)>=0)},distinct:function(valid){var ArrayObj={};var returnArray=[];for(var i=0;i<this.length;i++){if(ArrayObj[this[i]]||(valid&&Ext.isEmpty(this[i]))){continue}ArrayObj[this[i]]=this[i];returnArray.push(this[i])}return returnArray}});Ext.apply(Ext.form.VTypes,{daterange:function(val,field){var date=field.parseDate(val);if(!date){return}if(field.startDateField&&(!this.dateRangeMax||(date.getTime()!=this.dateRangeMax.getTime()))){var start=Ext.getCmp(field.startDateField);start.setMaxValue(date);start.validate();this.dateRangeMax=date}else{if(field.endDateField&&(!this.dateRangeMin||(date.getTime()!=this.dateRangeMin.getTime()))){var end=Ext.getCmp(field.endDateField);end.setMinValue(date);end.validate();this.dateRangeMin=date}}return true}});Ext.override(Ext.form.CheckboxGroup,{onRender:function(ct,position){if(!this.el){var panelCfg={cls:this.groupCls,layout:"column",border:false,renderTo:ct};var colCfg={defaultType:this.defaultType,layout:"form",border:false,defaults:{hideLabel:true,name:this.name,anchor:"100%"}};if(this.items[0].items){Ext.apply(panelCfg,{layoutConfig:{columns:this.items.length},defaults:this.defaults,items:this.items});for(var i=0,len=this.items.length;i<len;i++){Ext.applyIf(this.items[i],colCfg)}}else{var numCols,cols=[];if(typeof this.columns=="string"){this.columns=this.items.length}if(!Ext.isArray(this.columns)){var cs=[];for(var i=0;i<this.columns;i++){cs.push((100/this.columns)*0.01)}this.columns=cs}numCols=this.columns.length;for(var i=0;i<numCols;i++){var cc=Ext.apply({items:[]},colCfg);cc[this.columns[i]<=1?"columnWidth":"width"]=this.columns[i];if(this.defaults){cc.defaults=Ext.apply(cc.defaults||{},this.defaults)}cols.push(cc)}if(this.vertical){var rows=Math.ceil(this.items.length/numCols),ri=0;for(var i=0,len=this.items.length;i<len;i++){if(i>0&&i%rows==0){ri++}if(this.items[i].fieldLabel){this.items[i].hideLabel=false}cols[ri].items.push(this.items[i])}}else{for(var i=0,len=this.items.length;i<len;i++){var ci=i%numCols;if(this.items[i].fieldLabel){this.items[i].hideLabel=false}cols[ci].items.push(this.items[i])}}Ext.apply(panelCfg,{layoutConfig:{columns:numCols},items:cols})}this.panel=new Ext.Panel(panelCfg);this.el=this.panel.getEl();if(this.forId&&this.itemCls){var l=this.el.up(this.itemCls).child("label",true);if(l){l.setAttribute("htmlFor",this.forId)}}var fields=this.panel.findBy(function(c){return c.isFormField},this);this.items=new Ext.util.MixedCollection(false,function(o){return o.inputValue||o.value});this.items.addAll(fields)}Ext.form.CheckboxGroup.superclass.onRender.call(this,ct,position)},getValue:function(){var val=[];this.items.filter("checked",true).each(function(item){var v=Ext.value(item.inputValue,item.value);if(!Ext.isEmpty(v)){val.push(v)}},this);return val},getName:function(){return this.name||this.id},setValue:function(v){if(Ext.isArray(v)){v=v.toString().split(",")}else{if(v){v=v.split(/[,;\s]/)}}var arr=[].concat(v||[]);this.items.eachKey(function(key,item,i,len){var checked=arr.indexOf(String(key))>=0;item.setValue(checked)},this)},initValue:function(){if(this.value!==undefined&&this.value!==null){this.setValue(this.value)}}});Ext.override(Ext.form.RadioGroup,{setValue:function(v){this.items.each(function(item){if(item.inputValue==v){item.setValue(true)}},this)}});Ext.apply(Ext.form.Field.prototype,{clearDirty:function(){this.originalValue=this.getValue()},clearData:function(){var v=this.initialConfig.value;if(v===this.emptyText||v===undefined){v=""}this.originalValue=v},setOriginalValue:function(v){this.setValue(v);this.clearDirty()},getCursorPosition:function(){var d=this.el.dom;if(d.setSelectionRange){return d.selectionStart||0}else{if(d.createTextRange){var currentRange=document.selection.createRange();var workRange=currentRange.duplicate();d.select();var allRange=document.selection.createRange();var len=0;while(workRange.compareEndPoints("StartToStart",allRange)>0){workRange.moveStart("character",-1);len++}currentRange.select();return len}}},canFocus:function(){return !(/hidden|labelfield|checkbox|radio/.test(this.getXType())||this.disabled||this.hidden||(this.el.dom.readOnly===true))}});Ext.override(Ext.form.DateField,{clearData:function(){var v=this.initialConfig.value;if(v===this.emptyText||v===undefined){v=""}this.originalValue=this.parseDate(this.formatDate(this.parseDate(v)))}});Ext.apply(Ext.Container.prototype,{findSomeThing:function(id){var m,ct=this;this.cascade(function(c){if(ct!=c&&c.id===id||(c.isFormField&&(c.dataIndex==id||c.id==id||c.getName()==id))){m=c;return false}});return m||null},getItem:function(id){return this.getComponent(id)}});Ext.apply(Ext.DatePicker.prototype,{handleDateClick:function(e,t){e.stopEvent();if(t.dateValue&&!Ext.fly(t.parentNode).hasClass("x-date-disabled")){var now=new Date();var d=new Date(t.dateValue);d.setHours(now.getHours());d.setMinutes(now.getMinutes());d.setSeconds(now.getSeconds());this.setValue(d,true);this.fireEvent("select",this,this.value)}},selectToday:function(){if(this.todayBtn&&!this.todayBtn.disabled){this.setValue(new Date(),true);this.fireEvent("select",this,this.value)}},setValue:function(value,keepTime){var old=this.value;this.value=keepTime?value:value.clearTime(true);if(this.el){this.update(this.value)}}});Ext.override(Ext.form.ComboBox.prototype,{onTriggerClick:function(){var disabled=false;if(this.ownerCt){this.ownerCt.bubble(function(c){if(c.disabled){disabled=true}})}if(this.disabled||disabled){return}if(this.isExpanded()){this.collapse();this.el.focus()}else{this.onFocus({});if(this.triggerAction=="all"){this.doQuery(this.allQuery,true)}else{this.doQuery(this.getRawValue())}this.el.focus()}},processValue:function(value){if(this.comboBlank===false){return this.getValue()}else{return Ext.form.ComboBox.superclass.processValue.call(this,value)}}});Ext.override(Ext.form.ComboBox,{trigger2Class:"search",hideTrigger2:true,onRender:function(ct,position){if(this.hiddenName&&!Ext.isDefined(this.submitValue)){this.submitValue=false}this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+Ext.value(this.trigger1Class,"")},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+Ext.value(this.trigger2Class,"")}]};Ext.form.ComboBox.superclass.onRender.call(this,ct,position);if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.hiddenName,id:(this.hiddenId||Ext.id())},"before",true)}if(Ext.isGecko){this.el.dom.setAttribute("autocomplete","off")}if(!this.lazyInit){this.initList()}else{this.on("focus",this.initList,this,{single:true})}},onTrigger1Click:function(){Ext.form.ComboBox.prototype.onTriggerClick.apply(this,arguments)},onTrigger2Click:function(){},getTriggerWidth:function(){var tw=0;Ext.each(this.triggers,function(t,index){var triggerIndex="Trigger"+(index+1),w=t.getWidth();if(w===0&&!this["hidden"+triggerIndex]){tw+=this.defaultTriggerWidth}else{tw+=w}},this);return tw},onDestroy:function(){if(this.dqTask){this.dqTask.cancel();this.dqTask=null}this.bindStore(null);Ext.destroy(this.triggers,this.resizer,this.view,this.pageTb,this.list);Ext.destroyMembers(this,"hiddenField");Ext.form.ComboBox.superclass.onDestroy.call(this)},initTrigger:function(){var ts=this.trigger.select(".x-form-trigger",true);var triggerField=this;ts.each(function(t,all,index){var triggerIndex="Trigger"+(index+1);t.hide=function(){var w=triggerField.wrap.getWidth();this.dom.style.display="none";triggerField.el.setWidth(w-triggerField.trigger.getWidth());this["hidden"+triggerIndex]=true};t.show=function(){var w=triggerField.wrap.getWidth();this.dom.style.display="";triggerField.el.setWidth(w-triggerField.trigger.getWidth());this["hidden"+triggerIndex]=false};if(this["hide"+triggerIndex]){t.dom.style.display="none";this["hidden"+triggerIndex]=true}this.mon(t,"click",this["on"+triggerIndex+"Click"],this,{preventDefault:true});t.addClassOnOver("x-form-trigger-over");t.addClassOnClick("x-form-trigger-click")},this);this.triggers=ts.elements}});Ext.apply(Ext.form.ComboBox.prototype,{PleaseSelectedValue:"--PleaseSelectedValue--",PleaseSelectedText:"--请选择--",disableChoice:false,reload:function(){this.store.reload()},bindStore:function(store,initial){if(this.store&&!initial){this.store.un("beforeload",this.onBeforeLoad,this);this.store.un("load",this.onLoad,this);this.store.un("loadexception",this.collapse,this);if(!store){this.store=null;if(this.view){this.view.setStore(null)}}}if(store){this.store=Ext.StoreMgr.lookup(store);if(this.view){this.view.setStore(store)}if(this.store.data.getCount()>0&&(this.allowBlank||this.nullText)&&!this.disableChoice){var o={};o[this.valueField]=this.PleaseSelectedValue;var nullText=this.nullText?this.nullText:this.PleaseSelectedText;this.nullText=nullText;o[this.displayField]=nullText;this.store.insert(0,new Ext.data.Record(o))}if(!this.lastOptions){this.store.on("beforeload",this.onBeforeLoad,this);this.store.on("loadexception",this.collapse,this);if((this.allowBlank||this.nullText)&&!this.disableChoice){this.store.on("load",function(A,B){var o={};o[this.valueField]=this.PleaseSelectedValue;o[this.displayField]=this.nullText?this.nullText:this.PleaseSelectedText;this.nullText=nullText;if(this.store&&this.store.insert&&this.store.find(this.valueField,o[this.valueField])<0){this.store.insert(0,new Ext.data.Record(o))}},this)}this.store.on("load",this.onLoad,this)}}},setValue:function(v){var text=v;if(this.valueField){var r=this.findRecord(this.valueField,v);if(r){text=r.data[this.displayField]}else{if(this.valueNotFoundText!==undefined){text=this.valueNotFoundText}}}this.lastSelectionText=text;if(this.hiddenField){this.hiddenField.value=(v==this.PleaseSelectedValue?"":v)}Ext.form.ComboBox.superclass.setValue.call(this,text);this.value=v},getValue:function(){if(this.value==this.PleaseSelectedValue||this.value==this.nullText){return""}else{if(this.valueField){return typeof this.value!="undefined"?this.value:""}else{return Ext.form.ComboBox.superclass.getValue.call(this)}}}});Ext.apply(Ext.Toolbar.prototype,{getValues:function(){var c=this;var values={};if(!c.items||!c.items.getCount()){return values}c.items.each(function(item){if(item.isFormField){var name=(item.itemId||item.name||item.id);var v=item.getValue();if(v instanceof Date){v=v.format("Y-m-d")}values[name]=v}},this);return values},insert:Ext.Toolbar.prototype.insertButton});Ext.apply(Ext.Window.prototype,{onRender:function(ct,position){Ext.Window.superclass.onRender.call(this,ct,position);if(this.plain){this.el.addClass("x-window-plain")}this.focusEl=this.el.createChild({tag:"a",href:"#",cls:"x-dlg-focus",tabIndex:"-1",html:"&#160;"});this.focusEl.swallowEvent("click",true);this.proxy=this.el.createProxy("x-window-proxy");this.proxy.enableDisplayMode("block");if(this.modal){this.mask=this.container.createChild({cls:"ext-el-mask"},this.el.dom);this.mask.enableDisplayMode("block");this.mask.hide()}this.getKeyMap().addBinding([{key:"x",alt:true,fn:function(){this.hide()},scope:this},{key:Ext.EventObject.TAB,fn:function(k,e){if(this.buttons&&this.buttons.length){if(this.buttons[this.buttons.length-1].el.hasClass("x-btn-focus")){e.stopEvent();var firstField=[];this.cascade(function(c){if(c.isFormField&&c.canFocus()){firstField.push(c);return false}});if(firstField.length){firstField[0].focus()}}}},scope:this}])}});Ext.apply(Ext.form.BasicForm.prototype,{clearDirty:function(){this.items.each(function(f){f.clearDirty()});return this},clearData:function(){this.items.each(function(f){f.clearData()})},focusFirstButton:function(fp){if(fp){var buttons=fp.buttons;if(!buttons){fp.bubble(function(c){if(c.buttons){buttons=c.buttons;return false}})}for(var i=0;buttons&&i<buttons.length;i++){if(!buttons[i].disabled){buttons[i].focus();break}}}},focusPreviousField:function(f,e){var n=f.name||f.id;var sequence=-1,key=null;if(this.navigationSequences&&((sequence=this.navigationSequences.indexOf(n))>0)){key=this.navigationSequences[sequence-1]}else{this.items.each(function(field){sequence++;if(f.id==field.id||f.name==field.name){return false}});while(sequence>0){if(!this.items.get(sequence-1).canFocus()){sequence--}else{break}}if(sequence>0){key=this.items.get(sequence-1).id}}if(key){var field=this.findField(key);if(!field){var fp=f.findParentByType("form");if(fp){field=fp.findSomeThing(key)}}if(field){if(e){e.stopEvent()}field.focus()}}},focusNextField:function(f,e){var n=f.name||f.id;var sequence=-1,key=null;if(this.navigationSequences&&((sequence=this.navigationSequences.indexOf(n))>=0)){if(sequence>=this.navigationSequences.length-1){var fp=f.findParentByType("form");this.focusFirstButton(fp)}else{key=this.navigationSequences[sequence+1]}}else{this.items.each(function(field){sequence++;if(f.id==field.id||f.name==field.name){return false}});while(sequence<this.items.getCount()-1){if(!this.items.get(sequence+1).canFocus()){sequence++}else{break}}if(sequence>=this.items.getCount()-1){var fp=f.findParentByType("form");this.focusFirstButton(fp)}else{key=this.items.get(sequence+1).id}}if(key){var field=this.findField(key);if(!field){var fp=f.findParentByType("form");if(fp){field=fp.findSomeThing(key)}}if(field){try{field.focus()}catch(e){if(e){e.keyCode=9}}}}},handleNavigation:function(f,e){var k=e.getKey();if(k==e.ENTER&&this.enterNavigationKey){if(f.getValue()||f.allowBlank!==false){this.focusNextField(f,e)}}else{if(k==e.UP||(k==e.LEFT&&f.getCursorPosition()===0)){this.focusPreviousField(f,e)}}},add:function(){for(var i=0;i<arguments.length;i++){var f=arguments[i];f.on("specialkey",this.handleNavigation,this)}this.items.addAll(Array.prototype.slice.call(arguments,0));return this}});Ext.apply(Ext.form.FormPanel.prototype,{findField:function(id){return this.getForm().findField(id)}});Ext.override(Ext.grid.RowSelectionModel,{selectNext:function(keepExisting){if(this.hasNext()){this.selectRow(this.last+1,keepExisting);this.grid.getView().focusRow(this.last);return true}else{this.selectFirstRow(keepExisting);this.grid.getView().focusRow(0);return false}},selectPrevious:function(keepExisting){if(this.hasPrevious()){this.selectRow(this.last-1,keepExisting);this.grid.getView().focusRow(this.last);return true}else{this.selectLastRow(keepExisting);this.grid.getView().focusRow(this.grid.store.getCount()-1);return false}}});Ext.override(Ext.grid.CellSelectionModel,{tryEdit:function(row,col,required,step){this.tryDoEdit(null,row,col,step||1,this.acceptsNav,this,required!==false)},tryDoEdit:function(e,row,col,step,fn,scope,required){var g=this.grid;var newCol=step>0?col+1:col-1;var cell=g.walkCells(row,newCol,step,fn,scope);if(cell){g.startEditing(cell[0],cell[1],required);if(!g.editing){this.tryDoEdit(e,cell[0],cell[1],step,fn,scope,required)}else{if(e){e.stopEvent()}}}else{g.focus()}},onEditorKey:function(field,e){var k=e.getKey(),newCell,g=this.grid,s=this.selection,sm=g.getColumnModel();var cell={row:s.cell[0],col:s.cell[1]};var ed=sm.getCellEditor(cell.col,cell.row);if(k==e.TAB||(this.enterNavigation&&k==e.ENTER&&(!ed.field.disableEnterNavigation||e.shiftKey))){if(e.shiftKey){this.tryDoEdit(e,cell.row,cell.col,-1,this.acceptsNav,this,k==e.ENTER)}else{this.tryDoEdit(e,cell.row,cell.col,1,this.acceptsNav,this,k==e.ENTER)}}else{if(k==e.ENTER){e.stopEvent()}else{if(k==e.ESC){g.getView().focusCell(cell.row,cell.col);e.stopEvent()}else{if(k==e.LEFT&&ed.field.getCursorPosition()==0){this.tryDoEdit(e,cell.row,cell.col,-1,this.acceptsNav,this,false)}}}}}});Ext.override(Ext.grid.EditorGridPanel,{startEditing:function(row,col){this.stopEditing();if(this.colModel.isCellEditable(col,row)){this.view.ensureVisible(row,col,true);var r=this.store.getAt(row),field=this.colModel.getDataIndex(col),e={grid:this,record:r,field:field,value:r.data[field],row:row,column:col,cancel:false};if(this.fireEvent("beforeedit",e)!==false&&!e.cancel){this.editing=true;var ed=this.colModel.getCellEditor(col,row);if(!ed){return}if(!ed.rendered){ed.parentEl=this.view.getEditorParent(ed);ed.on({scope:this,render:{fn:function(c){c.field.focus(false,true)},single:true,scope:this},specialkey:function(field,e){this.getSelectionModel().onEditorKey(field,e)},complete:this.onEditComplete,canceledit:this.stopEditing.createDelegate(this,[true])})}Ext.apply(ed,{row:row,col:col,record:r});this.lastEdit={row:row,col:col};this.activeEditor=ed;ed.selectSameEditor=(this.activeEditor==this.lastActiveEditor);var v=this.preEditValue(r,field);ed.startEdit(this.view.getCell(row,col).firstChild,Ext.isDefined(v)?v:"");(function(){if(ed.field.onTriggerClick){(function(){ed.field.onTriggerClick();if(ed.field.list&&ed.field.list.alignTo){ed.field.list.alignTo(this.view.getCell(ed.row,ed.col),"tl-bl?")}}).defer(100,this)}else{if(ed.field.isFormField){ed.field.el.dom.select()}}delete ed.selectSameEditor}).defer(50,this)}}}});Ext.apply(Ext.grid.GridPanel.prototype,{getSelections:function(){return this.getSelectionModel().getSelections()}});Ext.override(Ext.grid.EditorGridPanel,{valPrefix:"item_",getFilterDataFn:null,getUpdateRecords:function(){return this.getStore().getModifiedRecords()},getUpdateRowsValues:function(){return Ext.arr2obj(this.getUpdateRecords(),this.valPrefix,this.getStore().fields.keys,this.getFilterDataFn)},getRowsValues:function(){return Ext.arr2obj(this.getStore().getRange(),this.valPrefix,this.getStore().fields.keys,this.getFilterDataFn)},preEditValue:function(r,field){var value=r.data[field];if(!Ext.isDefined(value)){value=""}return this.autoEncode&&Ext.isString(value)?Ext.util.Format.htmlDecode(value):value}});Ext.override(Ext.grid.CheckboxSelectionModel,{clearCheckerAll:function(){var a=this.grid.view;var b=Ext.fly(a.innerHd).child(".x-grid3-hd-checker");if(!b){return}if(this.getCount()!=0&&this.getCount()==a.getRows().length){b.addClass("x-grid3-hd-checker-on")}else{b.removeClass("x-grid3-hd-checker-on")}},init:function(grid){Ext.grid.CheckboxSelectionModel.superclass.init.call(this,grid);this.on("selectionchange",this.clearCheckerAll,this,{delay:100})}});Ext.override(Ext.data.Store,{load:function(options){options=Ext.apply({},options);options.params=options.params||{};this.storeOptions(options);var pn=this.paramNames;if(this.sortInfo&&this.remoteSort){options.params=Ext.apply({},options.params);options.params[pn.sort]=this.sortInfo.field;options.params[pn.dir]=this.sortInfo.direction}if((!options.params[pn.limit])&&this.pageSize){options.params[pn.limit]=this.pageSize}try{return this.execute("read",null,options)}catch(e){this.handleException(e);return false}}});Ext.apply(Ext.data.JsonReader.prototype,{readRecords:function(o){this.jsonData=o;if(o.metaData){delete this.ef;this.meta=o.metaData;this.recordType=Ext.data.Record.create(o.metaData.fields);this.onMetaChange(this.meta,this.recordType,o)}var s=this.meta,Record=this.recordType,f=Record.prototype.fields,fi=f.items,fl=f.length;if(!this.ef){if(s.totalProperty){this.getTotal=this.getJsonAccessor(s.totalProperty)}if(s.successProperty){this.getSuccess=this.getJsonAccessor(s.successProperty)}this.getRoot=s.root?this.getJsonAccessor(s.root):function(p){return p};if(s.id){var g=this.getJsonAccessor(s.id);this.getId=function(rec){var r=g(rec);return(r===undefined||r==="")?null:r}}else{this.getId=function(){return null}}this.ef=[];for(var i=0;i<fl;i++){f=fi[i];var map=(f.mapping!==undefined&&f.mapping!==null)?f.mapping:f.name;this.ef[i]=this.getJsonAccessor(map)}}var root=this.getRoot(o),c=root&&root.length?root.length:0,totalRecords=c,success=true;if(s.totalProperty){var v=parseInt(this.getTotal(o),10);if(!isNaN(v)){totalRecords=v}}if(s.successProperty){var v=this.getSuccess(o);if(v===false||v==="false"){success=false}}var records=[];for(var i=0;i<c;i++){var n=root[i];var values={};var id=this.getId(n);for(var j=0;j<fl;j++){f=fi[j];var v=this.ef[j](n);values[f.name]=f.convert((v!==undefined)?v:f.defaultValue,n)}var record=new Record(values,id);record.json=n;records[i]=record}return{success:success,records:records,totalRecords:totalRecords}},getJsonAccessor:function(){var re=/[\[\.]/;return function(expr){try{return(re.test(expr))?new Function("obj","try{return obj."+expr+";}catch(e){ return ''}"):function(obj){return obj[expr]}}catch(e){}return Ext.emptyFn}}()});Ext.override(Ext.tree.TreeLoader,{createNode:function(attr){if(this.baseAttrs){Ext.applyIf(attr,this.baseAttrs)}if(this.iconCls){Ext.applyIf(attr,{iconCls:this.iconCls})}if(this.applyLoader!==false&&!attr.loader){attr.loader=this}if(Ext.isString(attr.uiProvider)){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}if(attr.nodeType){return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)}else{return attr.leaf?new Ext.tree.TreeNode(attr):new Ext.tree.AsyncTreeNode(attr)}}});(function(){var actions={_exeRegxp:/^(?:hide|show|disable|enable)$/,execItemFn:function(exec,args){var arr=Array.prototype.slice.call(arguments,1);Ext.each(arr,function(key){if(Ext.isObject(key)&&key[exec]){key[exec]()}else{var item=this.get(key);if(item){item[exec]()}}},this)},getFnArguments:function(){var args=arguments.callee.caller.arguments;if(Ext.isArray(args[0])){return args[0]}else{return Array.prototype.slice.call(args,0)}},hides:function(args){var arr=this.getFnArguments();this.execItemFn.apply(this,["hide"].concat(arr));return this},shows:function(){var arr=this.getFnArguments();this.execItemFn.apply(this,["show"].concat(arr));return this},disables:function(){var arr=this.getFnArguments();this.execItemFn.apply(this,["disable"].concat(arr));return this},enables:function(){var arr=this.getFnArguments();this.execItemFn.apply(this,["enable"].concat(arr));return this}};Ext.apply(Ext.menu.Menu.prototype,actions);Ext.apply(Ext.Toolbar.prototype,actions)})();Ext.namespace("EasyJF.Ext.Util");Ext.apply(EasyJF.Ext.Util,{NormalClass:{},theStatus:[["启用",0],["停用",-1]],readOnlyGridCellColor:"#F2F2F2",successTag:"<font color=green>&#8730;</font>",failureTag:"<font color=red>X</font>",linkRenderer:function(v){if(!v){return""}else{return String.format("<a style=\"color:blue;font-weight:800;\" title=\"点击后将在新窗口中打开{0}\" href='{0}' target='_blank'>{0}</a>",v)}},booleanRender:function(value,p,record){return value?'<span style="color:green;">是</span>':'<span style="color:red;">否</span>'},dateRender:function(format){format=format||"Y-m-d G:i";return Ext.util.Format.dateRenderer(format)},imgRender:function(v){if(!v){return""}else{return String.format("<a style=\"color:green;font-weight:800\" title=\"点击后将在新窗口中打开{0}\" href='{0}' target='_blank'>查看</a>",v)}},moneyRender:function(v){if(v){if(v.toFixed){if(v<0){return"<font color=red>"+v.toFixed(2)+"<font>"}else{return v.toFixed(2)}}else{return v}}},objectRender:function(p,backgroundColor){return function(v,meta){if(backgroundColor){meta.attr='style="background-color:'+backgroundColor+';"'}var s="";try{s=v?eval("v."+p):""}catch(e){}return s}},comboxRender:function(v){if(v){return v.text||v.title||v}},typesRender:function(types){return function(v){for(var i=0;i<types.length;i++){try{if(types[i][1]===v){return types[i][0]}}catch(e){alert(types)}}return""}},readOnlyRender:function(innerRender){return function(v,meta){var d=v;if(innerRender){d=innerRender(d)}meta.attr='style="background-color:'+EasyJF.Ext.Util.readOnlyGridCellColor+';"';return d}},operaterTemplate:new Ext.Template("<a href='{2}' theid='{2}' op='{1}' onclick='return false'><font color='blue'>{0}</font></a>"),operaterRender:function(cmd,title){return function(v,p,r){if(r.get("id")){return EasyJF.Ext.Util.operaterTemplate.applyTemplate([title?title:(v?v:""),cmd,r.get("id")])}}},autoCloseMsg:function(){Ext.Msg.hide()},executeUrl:function(url,params,fn){return function(){Ext.Ajax.request({waitMsg:"正在执行操作，请稍候...",url:url,method:"POST",params:params,success:function(response){var r=Ext.decode(response.responseText);if(!r.success){Ext.Msg.alert("提示","操作失败，失败原因为：<br/>"+(r.errors.msg?r.errors.msg:"未知"))}else{Ext.Msg.alert("提示","操作成功",fn?fn:Ext.emptyFn,this)}},scope:this})}},submitForm:function(form,url,callback,scope,failure){form.submit({url:url,waitTitle:"请稍候",waitMsg:"正在保存，请稍候",success:function(form,action){if(callback){callback.call(scope||this,form,action)}},failure:function(form,action){if(failure){failure.call(scope||this,form,action)}else{var msg="";if(action.failureType==Ext.form.Action.SERVER_INVALID){if(form.notAlert){return""}for(var p in action.result.errors){msg+=action.result.errors[p]+"  "}}else{msg="数据录入不合法或不完整！"}Ext.MessageBox.alert("保存失败！",msg)}},scope:scope||this})},getEditGridData:function(editGrid,prefix,key,filter){function getV(v){if(v&&v.value!==undefined){v=v.value}else{if(v&&v.id!==undefined){v=v.id}}if(v&&typeof v=="object"&&v.clearTime){v=v.format("Y-m-d")}return v}var o={};var mc=editGrid.getColumnModel().getColumnCount();for(var i=0;i<mc;i++){var n=editGrid.getColumnModel().getDataIndex(i);if(n){o[(prefix?prefix:"")+n]=[]}}var store=editGrid.store;var j=0;var numbererField=editGrid.getColumnModel().getColumnById("numberer")?editGrid.getColumnModel().getColumnById("numberer").dataIndex:"";for(var i=0;i<store.getCount();i++){if(key){var v=store.getAt(i).get(key);v=getV(v);if(!v){continue}if(filter&&!filter(store.getAt(i))){continue}if(typeof v=="object"&&!String(v)){continue}}for(var n in o){var f=prefix?n.replace(prefix,""):n;if(f==numbererField){o[n][j]=j}else{var v=store.getAt(i).get(f);v=getV(v);o[n][j]=(v!==null?v:"")}}j++}return j>0?o:{}},getGridDataAsString:function(grid,key){var s=[],key=key||"id";grid.store.each(function(r){s.push(r.get(key))});return s.join(",")},appendGridRows:function(grid,storeMapping,rs,dataHandler,keepLastEmptyRow){if(rs.length==undefined){rs=[rs]}var selectRow=grid.getSelectionModel().getSelectedCell?grid.getSelectionModel().getSelectedCell():null;var lastSecondRow=grid.store.getCount()-(keepLastEmptyRow?2:1);var appendTo=lastSecondRow;if(selectRow){appendTo=selectRow[0]}if(appendTo<-1){appendTo=-1}if(appendTo==lastSecondRow+1){appendTo=lastSecondRow}for(var i=0;i<rs.length;i++){var r=rs[i];var obj=dataHandler(r);EasyJF.Ext.Util.addGridRow(grid,storeMapping,obj,appendTo+i)}},addEditorGridRow:function(grid,storeMapping,obj,appendTo){var row=appendTo;if(row==undefined){var selModel=grid.getSelectionModel();var record=selModel.getSelectedCell?selModel.getSelectedCell():null;row=grid.store.getCount()-1;if(record){row=record[0]}}var create=Ext.data.Record.create(storeMapping);var obj=new create(Ext.apply({},obj||{}));if(grid.stopEditing){grid.stopEditing()}grid.store.insert(row+1,obj);grid.getView().refresh()},removeEditorGridRow:function(grid,callback){var record=grid.getSelectionModel().getSelectedCell();if(record){var store=grid.store;Ext.MessageBox.confirm("请确认","确定要删除吗？",function(ret){if(ret=="yes"){var r=store.getAt(record[0]);if(callback){callback(r)}store.remove(r);grid.getView().refresh();if(store.getCount()>0){grid.getSelectionModel().select(record[0]-1<0?0:record[0]-1,record[1])}}})}else{Ext.MessageBox.alert("提示","请选择要删除的记录!")}},reloadGrid:function(grid){grid.getStore().removeAll();grid.getStore().reload()},removeGridRows:function(grid,callback){if(!grid.getSelectionModel().getSelections&&grid.getSelectionModel().getSelectedCell){EasyJF.Ext.Util.removeEditorGridRow(grid,callback)}else{var rs=grid.getSelectionModel().getSelections();if(rs&&rs.length>0){var store=grid.store;Ext.MessageBox.confirm("请确认","确定要删除吗？",function(ret){if(ret=="yes"){if(callback){callback(rs)}for(var i=0;i<rs.length;i++){store.remove(rs[i])}grid.getView().refresh()}})}}},setGridColumnHidden:function(fields,hidden,grid){if(grid!=null&&fields!=null&&fields.length){for(var i=0;i<fields.length;i++){var index=grid.getColumnModel().findColumnIndex(fields[i]);if(index>=0){grid.getColumnModel().config[index].hideable=!hidden;grid.getColumnModel().setHidden(index,hidden)}}}},buildColumnForm:function(auto,arg){var cw,defaultType="textfield",args=Array.prototype.slice.call(arguments,0);if(Ext.isBoolean(auto)||Ext.isNumber(auto)){args.shift();if(Ext.isBoolean(auto)&&auto){var arr=args[0]||args[1];if(!Ext.isArray(arr)){arr=args}cw=(1/arr.length).toFixed(5)}else{if(Ext.isNumber(auto)){if(auto>1){if(auto<50){cw=(1/auto).toFixed(5)}else{cw=auto}}else{cw=auto}}else{cw=0.5}}}else{cw=0.5}if(Ext.isString(args[0])){defaultType=args.shift()}if(Ext.isArray(args[0])){args=args.shift()}var config={items:[],anchor:"100%",layout:"column",xtype:"container"};Ext.each(args,function(field){var item={items:field,anchor:"100%",layout:"form",border:false,xtype:"container",defaultType:defaultType,defaults:{anchor:"-20"}};if(cw<50){item.columnWidth=cw}else{item.width=cw}if(field.panelCfg){Ext.apply(item,field.panelCfg);delete field.panelCfg}config.items.push(item)});return config},oneColumnPanelBuild:function(){var agrugments=arguments;EasyJF.Ext.Util.buildColumnForm.apply(true,agrugments)},columnPanelBuild:function(){var args=Array.prototype.slice.call(arguments,0);var formConfig={};if(args[0]){if(args[0].FC||args[0].formConfig){Ext.apply(formConfig,(args[0].FC||args[0].formConfig));args.shift()}}var obj={layout:"column",anchor:"100%",defaults:{border:false},items:[],xtype:"panel",border:false,bodyBorder:false};var defaultColumn=(1/args.length).toFixed(2);for(var i=0;i<args.length;i++){var o=args[i];var c={columnWidth:o.columnWidth||defaultColumn,layout:"form",defaultType:o.defaultType||"textfield",defaults:o.defaults||{anchor:"-20"},items:o.items};obj.items[i]=Ext.apply(c,formConfig)}return obj},columnBuild:function(){EasyJF.Ext.Util.twoColumnPanelBuild.apply(this,arguments)},twoColumnPanelBuild:function(){var args=Array.prototype.slice.call(arguments,0);var formConfig={};var obj={layout:"column",anchor:"100%",defaults:{border:false},items:[],xtype:"panel",border:false,bodyBorder:false};var max=2;if(typeof args[0]=="number"){max=args[0];args.shift()}if(args[0]){if(args[0].FC||args[0].formConfig){Ext.apply(formConfig,(args[0].FC||args[0].formConfig));args.shift()}}var cs=[];for(var i=0;i<max;i++){cs[i]=Ext.apply({columnWidth:1/max,layout:"form",defaultType:"textfield",defaults:{anchor:"-20"},items:[]},formConfig)}for(var i=0;i<args.length;){for(var j=0;j<max;j++,i++){cs[j].items[cs[j].items.length]=(i<args.length?args[i]:{xtype:"panel",border:false})}}obj.items=cs;return obj},TRANS_ID:0,load:function(appName){var transId=++EasyJF.Ext.Util.TRANS_ID;var head=document.getElementsByTagName("head")[0];var script=document.createElement("script");script.setAttribute("src",appName);script.setAttribute("type","text/javascript");script.setAttribute("id","lanyoScript_"+EasyJF.Ext.Util.TRANS_ID);head.appendChild(script)},loadJSON2Collection:function(varName,url,callback,shareCache,collectionType){Ext.Ajax.request({url:url,success:function(req){try{var ret=Ext.decode(req.responseText);var collection=shareCache||eval("new "+(collectionType||"Ext.util.MixedCollection")+"()");if(Ext.type(ret)=="array"){collection.addAll(ret);EasyJF.Ext.CachedRemoteObject.DATAS[varName]=collection}else{if(Ext.type(ret)=="object"&&Ext.type(ret.result)=="array"){collection.addAll(ret.result);EasyJF.Ext.CachedRemoteObject.DATAS[varName]=collection}}}catch(e){}if(callback){callback()}},scope:this})},loadJSONObject:function(varName,script,callback){Ext.Ajax.request({url:script,success:function(req){var ret=Ext.decode(req.responseText);if(varName){eval("("+varName+"=ret)")}if(callback){callback()}},scope:this})},loadScript:function(className,script,callback,scope,async){if(!window[className]){Ext.Ajax.request({url:script,success:function(req){window.eval(req.responseText);if(callback){callback.call(scope||window,window[className])}},scope:this,async:async})}else{if(callback){callback.call(scope||window,window[className])}}},loadClass:function(cfg,async){cfg=cfg||{};if(!Ext.isBoolean(cfg)&&Ext.isBoolean(async)){cfg.async=async}if(cfg.script){if(Ext.isEmpty(cfg.className)){var scriptUrl=cfg.script;var ji=scriptUrl.indexOf(".js");if(ji>=0){var scriptClassSub=scriptUrl.substring(0,ji);var lastIndex=scriptClassSub.lastIndexOf("/");if(lastIndex>=0){cfg.className=scriptUrl.substring(lastIndex+1,ji)}}}Ejf.Util.loadScript(cfg.className,cfg.script,cfg.callback,cfg.scope,cfg.async)}},asLoadScript:function(script,async){Ext.Ajax.request({url:script,async:async,success:function(req){eval(req.responseText)},scope:this})},loadJS:function(script){document.write("<script src='"+script+"'><\/script>")},addObject:function(crudClass,callback,script,otherScripts,winReadyAction){if(this.NormalClass[crudClass]){var clz=this.NormalClass[crudClass];var o=new clz();o.createObject(callback,winReadyAction)}else{var loadSuccess=function(req){eval(req.responseText);eval("this.NormalClass."+crudClass+"="+crudClass);var clz=this.NormalClass[crudClass];var o=new clz();o.createObject(callback,winReadyAction)};if(otherScripts){var s=otherScripts.split(";");var total=s.length,ld=0;for(var i=0;i<s.length;i++){Ext.Ajax.request({url:s[i],success:function(req){eval(req.responseText);ld++;if(ld>=total){Ext.Ajax.request({url:Lanyo_Ajax.script+script,success:loadSuccess,scope:this})}},scope:this})}}else{Ext.Ajax.request({url:Lanyo_Ajax.script+script,success:loadSuccess,scope:this})}}},listObject:function(crudClass,callback,script,otherScripts){if(this.NormalClass[crudClass]){var clz=this.NormalClass[crudClass];var o=new clz();if(o.list&&(typeof o.list=="function")){o=o.list()}if(callback){callback(o)}}else{if(otherScripts){var s=otherScripts.split(";");for(var i=0;i<s.length;i++){Ext.Ajax.request({url:s[i],success:function(req){eval(req.responseText)}})}}Ext.Ajax.request({url:"extApp.ejf?cmd=loadScript&script="+script,success:function(req){eval(req.responseText);eval("this.NormalClass."+crudClass+"="+crudClass);var clz=this.NormalClass[crudClass];var o=new clz();if(o.list&&(typeof o.list=="function")){o=o.list()}if(callback){callback(o)}},scope:this})}},editObject:function(crudClass,callback,script,otherScripts,id,winReadyAction){if(this.NormalClass[crudClass]){var clz=this.NormalClass[crudClass];var o=new clz();o.editObject(id,callback,winReadyAction)}else{if(otherScripts){var s=otherScripts.split(";");for(var i=0;i<s.length;i++){Ext.Ajax.request({url:s[i],success:function(req){eval(req.responseText)}})}}Ext.Ajax.request({url:Lanyo_Ajax.script+script,success:function(req){eval(req.responseText);eval("this.NormalClass."+crudClass+"="+crudClass);var clz=this.NormalClass[crudClass];var o=new clz();o.editObject(id,callback,winReadyAction)},scope:this})}},viewObject:function(crudClass,callback,script,otherScripts,id){if(this.NormalClass[crudClass]){var clz=this.NormalClass[crudClass];var o=new clz();o.viewObject(id,callback)}else{if(otherScripts){var s=otherScripts.split(";");for(var i=0;i<s.length;i++){Ext.Ajax.request({url:s[i],success:function(req){eval(req.responseText)}})}}Ext.Ajax.request({url:Lanyo_Ajax.script+script,success:function(req){eval(req.responseText);eval("this.NormalClass."+crudClass+"="+crudClass);var clz=this.NormalClass[crudClass];var o=new clz();o.viewObject(id,callback)},scope:this})}},removeObject:function(crudClass,callback,script,otherScripts,id){if(this.NormalClass[crudClass]){var clz=this.NormalClass[crudClass];var o=new clz();o.removeObject(id,callback)}else{if(otherScripts){var s=otherScripts.split(";");for(var i=0;i<s.length;i++){Ext.Ajax.request({url:s[i],success:function(req){eval(req.responseText)}})}}Ext.Ajax.request({url:Lanyo_Ajax.script+script,success:function(req){eval(req.responseText);eval("this.NormalClass."+crudClass+"="+crudClass);var clz=this.NormalClass[crudClass];var o=new clz();o.removeObject(id,callback)},scope:this})}},buildCombox:function(name,fieldLabel,data,defaultValue,allowBlank){var cfg={};if(Ext.isObject(name)){cfg=name;data=cfg.data;delete cfg.data}else{if(Ext.isArray(name)){data=name;name=null}else{cfg={name:name,hiddenName:name,fieldLabel:fieldLabel,value:defaultValue,allowBlank:allowBlank}}}var comboCfg=Ext.apply({xtype:"combo",displayField:"title",valueField:"value",store:new Ext.data.SimpleStore({fields:["title","value"],data:data}),editable:false,mode:"local",triggerAction:"all",emptyText:"请选择..."},cfg);return comboCfg},buildRemoteCombox:function(name,fl,url,fs,df,vf,ab,lsv){var comboConfig={xtype:"smartcombo",lazyRender:true,triggerAction:"all",typeAhead:true,editable:false};if(arguments.length==1&&Ext.isObject(name)){fields=name.fields;url=name.url||name.dataUrl;Ext.del(name,"fields","url","dataUrl");Ext.apply(comboConfig,name)}else{Ext.apply(comboConfig,{name:name,hiddenName:name,allowBlank:ab,fieldLabel:fl,displayField:df?df:"title",valueField:vf?vf:"id"})}var storeConfig={id:"id",url:url,root:"result",totalProperty:"rowCount",remoteSort:true,baseParams:{pageSize:"-1"},pageSize:"-1",fields:fs};if(!Ext.isString(lsv)){comboConfig.store=new Ext.data.JsonStore(storeConfig)}else{comboConfig.store=new EasyJF.Ext.CachedRemoteStore(Ext.apply({varName:lsv},storeConfig))}return comboConfig},printGrid:function(grid){var win=window.open("");win.document.write("<link rel='stylesheet' type='text/css' href='/stylesheet/print.css' />");win.document.write(grid.el.dom.innerHTML);win.document.close()},getSelectWin:function(winName,title,width,height,gridClz,config){if(!EasyJF.Ext.SelectWin){EasyJF.Ext.SelectWin={}}if(!EasyJF.Ext.SelectWin[winName]){config=config||{};var glist=config.grid;if(!glist&&gridClz){glist=eval("new "+gridClz+"(config)")}config=Ext.apply({},{title:title,width:width,height:height,grid:glist},config);EasyJF.Ext.SelectWin[winName]=new EasyJF.Ext.GridSelectWin(config)}return EasyJF.Ext.SelectWin[winName]},setDelayEditorContent:function(name,html){if(typeof FCKeditorAPI=="object"){var editor=FCKeditorAPI.GetInstance(name);if(editor){editor.SetHTML(html||"")}}},setFCKEditorContent:function(name,html){if(typeof FCKeditorAPI=="object"){var editor=FCKeditorAPI.GetInstance(name);if(editor){editor.SetHTML(html||"")}else{this.setDelayEditorContent.createCallback(name,html).defer(2000)}}else{this.setDelayEditorContent.createCallback(name,html).defer(2000)}},getFckById:function(id){var fckApi=window.FCKeditorAPI;if(!fckApi){return null}return fckApi.GetInstance(id)},getFCKEditorContent:function(name){if(typeof FCKeditorAPI=="object"){var editor=FCKeditorAPI.GetInstance(name);return editor.GetHTML()}else{return""}},autoFocusFirstRow:function(grid){grid.store.on("load",function(){if(grid.rendered){var sel=grid.getSelectionModel();if(!sel.hasSelection()&&grid.store.getCount()){grid.getView().focusRow(0)}else{if(sel.hasSelection()){grid.getView().focusRow(grid.store.indexOf(grid.getSelectionModel().getSelected()))}else{grid.focus()}}}else{grid.on("render",function(g){EasyJF.Ext.Util.autoFocusFirstRow(g)})}})},getExportForm:function(){var exportForm=Ext.getCmp("global_export_form");if(!exportForm){exportForm=new Ext.form.FormPanel({fileUpload:true,hidden:true,items:{}});var fe=document.createElement("div");document.body.appendChild(fe);exportForm.render(fe)}return exportForm},executePanelButtons:function(p,btn,scope){if(p.getFooterToolbar()){var bt=p.getFooterToolbar().get(btn);if(bt&&!(bt.disabled||bt.hidden)&&bt.handler){bt.handler.call(scope||bt.scope||window)}}},ajaxRequest:function(url,params,scope,success,failure,successOp){Ext.Ajax.request({url:url,params:params||{},scope:scope||this,success:success||function(response,options){var data=Ext.decode(response.responseText);if(data.success){if(successOp){successOp.call(this,data,options)}else{if(data.msg){EasyJF.Ext.Msg.alert(data.msg)}}}else{if(data.msg){Ext.Msg.errorMsg(null,data.msg)}}},failure:failure||function(response){var data=Ext.decode(response.responseText);Ext.Msg.errorMsg(null,data.msg?data.msg:(data.errors&&data.errors.msg?data.errors.msg:"未知错误原因!"))}})},applySkin:function(value){Ext.util.CSS.swapStyleSheet("extSkin",String.format("plugins/extjs/{0}/resources/css/{1}.css",Lanyo_Ajax.extVersion,value));if(Lanyo_Ajax.sysSkinPath){Ext.util.CSS.swapStyleSheet("sysSkin",Lanyo_Ajax.sysSkinPath+value+".css")}}});EasyJF.Ext.Util.easycolumn=EasyJF.Ext.Util.buildColumnForm;Ext.ns("EasyJF.Ext","EasyJF.Ext.Tree");EasyJF.Ext.GridPanelPlugin=Ext.extend(Ext.util.Observable,{init:function(a){this.grid=a;this.store=this.grid.store;this.grid.on("render",this.initEvents,this)},beforePage:function(c){var b=this.pageToolbar.getPageData();var d=b.activePage;var a=b.pages;switch(c){case"next":if(d===a){return false}break;case"prev":if(d==1){return false}break}},initEvents:function(){this.keyMap=this.grid.getKeyMap();this.pageToolbar=this.grid.getBottomToolbar();if(this.pageToolbar){this.keyMap.addBinding([{key:Ext.EventObject.RIGHT,fn:this.pageToolbar.onClick.createInterceptor(this.beforePage,this).createDelegate(this.pageToolbar,["next"]),shift:true,scope:this},{key:Ext.EventObject.LEFT,fn:this.pageToolbar.onClick.createInterceptor(this.beforePage,this).createDelegate(this.pageToolbar,["prev"]),shift:true,scope:this}])}new Ext.KeyMap(this.grid.getGridEl(),[{key:Ext.EventObject.A,stopEvent:true,ctrl:true,fn:function(a,b){this.grid.getSelectionModel().selectAll()},scope:this},{key:Ext.EventObject.X,stopEvent:true,ctrl:true,fn:function(){this.grid.getSelectionModel().clearSelections()},scope:this}])}});EasyJF.Ext.HelpIconPlugin=Ext.extend(Ext.util.Observable,{init:function(field){Ext.apply(field,{onRender:field.onRender.createSequence(function(ct,position){if(this.fieldLabel&&this.helpText){var label=this.el.findParent(".x-form-element",5,true)||this.el.findParent(".x-form-field-wrap",5,true);this.helpIcon=label.createChild({cls:(this.helpIconCls||"ux-helpicon-icon"),style:"width:16px; height:18px; position:absolute; left:0; top:0; display:block; background:transparent no-repeat scroll 0 2px;"});this.alignHelpIcon=function(){var el=this.wrap?this.wrap:this.el;this.helpIcon.alignTo(el,"tl-tr",[2,0])};if(this.alignErrorIcon){this.alignErrorIcon=function(){this.errorIcon.alignTo(this.helpIcon,"tl-tr",[2,0])}}this.on("resize",this.alignHelpIcon,this);Ext.QuickTips.register({target:this.helpIcon,title:(this.helpTitle||""),text:(this.helpText||"No help defined yet!"),enabled:true})}})})}});EasyJF.Ext.TabHistoryPlugin=Ext.extend(Object,{onTabChange:function(tp,tab){tp.focus();this.history.push(tab.id)},onTabBeforedestroy:function(t){Ext.del(this,"history","tabpanel");t.un("beforedestroy",this.onTabBeforedestroy,this)},onTabRender:function(){var tp=this.tabpanel;var km=tp.getKeyMap();tp.getEl().setStyle("outline","0 none");tp.getEl().dom.setAttribute("tabindex",0);km.addBinding([{scope:this,key:Ext.EventObject.BACKSPACE,fn:function(k,e){e.stopPropagation();this.onBack()}},{scope:this,key:Ext.EventObject.TAB,fn:function(k,e){var at=tp.getActiveTab();var items=tp.items,count=items.getCount(),index=0;if(at){index=items.indexOf(at);if(++index==count){index=0}}if(count){tp.setActiveTab(index)}}}])},onBack:function(){var tp=this.tabpanel;var history;if(this.history.length){var at=tp.getActiveTab();if(this.history.length==1){return}this.history.pop();while(history=this.history.pop()){var p=tp.getItem(history);if(p){tp.setActiveTab(p);break}}}},init:function(t){this.tabpanel=t;this.history=[];t.on("tabchange",this.onTabChange,this);t.on("beforedestroy",this.onTabBeforedestroy,this);t.on("render",this.onTabRender,this)}});Ext.preg("tabhistoryplugin",EasyJF.Ext.TabHistoryPlugin);Ext.ns("Ext.ux.grid");Ext.ux.grid.GridSummary=function(config){Ext.apply(this,config)};Ext.extend(Ext.ux.grid.GridSummary,Ext.util.Observable,{init:function(grid){this.grid=grid;this.cm=grid.getColumnModel();this.view=grid.getView();var v=this.view;v.onLayout=this.onLayout;v.afterMethod("render",this.refreshSummary,this);v.afterMethod("refresh",this.refreshSummary,this);v.afterMethod("syncScroll",this.syncSummaryScroll,this);v.afterMethod("onColumnWidthUpdated",this.doWidth,this);v.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);v.afterMethod("onColumnHiddenUpdated",this.doHidden,this);grid.store.on({add:this.refreshSummary,remove:this.refreshSummary,clear:this.refreshSummary,update:this.refreshSummary,scope:this});if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row x-grid3-gridsummary-row-offset">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<tbody><tr>{cells}</tr><tr style="display:{totalDisplay}">{tcells}</tr></tbody>',"</table>","</div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},calculate:function(rs,cm,isTotal){var data={},cfg=cm.config;for(var i=0,len=cfg.length;i<len;i++){var cf=cfg[i],cname=cf.dataIndex;data[cname+(isTotal?"_total":"")]=0;if(cf.summaryType){for(var j=0,jlen=rs.length;j<jlen;j++){var r=rs[j];if(isTotal){data[cname+"_total"]=Ext.ux.grid.GridSummary.Calculations[cf.summaryType](r[cname],r,cname+"_total",data,j)}else{data[cname]=Ext.ux.grid.GridSummary.Calculations[cf.summaryType](r.get(cname),r,cname,data,j)}}}}return data},onLayout:function(vw,vh){if(Ext.type(vh)!="number"){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(vh-this.summary.getHeight())}},syncSummaryScroll:function(){var mb=this.view.scroller.dom;this.view.summaryWrap.dom.scrollLeft=mb.scrollLeft;this.view.summaryWrap.dom.scrollLeft=mb.scrollLeft},doWidth:function(col,w,tw){var s=this.view.summary.dom;s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.width=w},doAllWidths:function(ws,tw){var s=this.view.summary.dom,wlen=ws.length;s.firstChild.style.width=tw;var cells=s.firstChild.rows[0].childNodes;for(var j=0;j<wlen;j++){cells[j].style.width=ws[j]}},doHidden:function(col,hidden,tw){var s=this.view.summary.dom,display=hidden?"none":"";s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.display=display},renderSummary:function(o,cs,cm){cs=cs||this.view.getColumnData();var cfg=cm.config,buf=[],tbuf=[],last=cs.length-1;for(var i=0,len=cs.length;i<len;i++){var c=cs[i],cf=cfg[i],p={};p.id=c.id;p.style=c.style;p.css=i==0?"x-grid3-cell-first ":(i==last?"x-grid3-cell-last ":"");var tp=Ext.apply({},p);if(cf.summaryType||cf.summaryRenderer){p.value=(cf.summaryRenderer||c.renderer)(o.data[c.name],p,o);tp.value=(cf.summaryTotalRenderer||cf.summaryRenderer||c.renderer)(o.data[c.name+"_total"],p,o)}else{p.value="";tp.value=""}if(p.value==undefined||p.value===""){p.value="&#160;"}if(tp.value==undefined||tp.value===""){tp.value="&#160;"}buf[buf.length]=this.cellTpl.apply(p);tbuf[tbuf.length]=this.cellTpl.apply(tp)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:buf.join(""),tcells:tbuf.join(""),totalDisplay:this.grid.store.refreshCache?"display":"none"})},refreshSummary:function(){var g=this.grid,ds=g.store,cs=this.view.getColumnData(),cm=this.cm,rs=ds.getRange();var data=this.calculate(rs,cm);if(ds.refreshCache){var total=this.calculate(ds.proxy.getData().getRange(),cm,true);Ext.apply(data,total)}var buf=this.renderSummary({data:data},cs,cm);if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}this.view.summary=this.view.summaryWrap.update(buf).first()},toggleSummary:function(visible){var el=this.grid.getGridEl();if(el){if(visible===undefined){visible=el.hasClass("x-grid-hide-gridsummary")}el[visible?"removeClass":"addClass"]("x-grid-hide-gridsummary");this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Ext.reg("gridsummary",Ext.ux.grid.GridSummary);Ext.ux.grid.GridSummary.Calculations={sum:function(v,record,colName,data,rowIdx){return data[colName]+Ext.num(v,0)},count:function(v,record,colName,data,rowIdx){return rowIdx+1},max:function(v,record,colName,data,rowIdx){return Math.max(Ext.num(v,0),data[colName])},min:function(v,record,colName,data,rowIdx){return Math.min(Ext.num(v,0),data[colName])},average:function(v,record,colName,data,rowIdx){var t=data[colName]+Ext.num(v,0),count=record.store.getCount();try{var result=rowIdx==count-1?(t/count):t;return result}catch(e){alert(e)}},last:function(v,record,colName,data,rowIdx){return v}};Ext.grid.GroupSummary=function(config){Ext.apply(this,config)};Ext.extend(Ext.grid.GroupSummary,Ext.util.Observable,{init:function(grid){this.grid=grid;this.cm=grid.getColumnModel();this.view=grid.getView();var v=this.view;v.doGroupEnd=this.doGroupEnd.createDelegate(this);v.afterMethod("onColumnWidthUpdated",this.doWidth,this);v.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);v.afterMethod("onColumnHiddenUpdated",this.doHidden,this);v.afterMethod("onUpdate",this.doUpdate,this);v.afterMethod("onRemove",this.doRemove,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},toggleSummaries:function(visible){var el=this.grid.getGridEl();if(el){if(visible===undefined){visible=el.hasClass("x-grid-hide-summary")}el[visible?"removeClass":"addClass"]("x-grid-hide-summary")}},renderSummary:function(o,cs){cs=cs||this.view.getColumnData();var cfg=this.cm.config;var buf=[],c,p={},cf,last=cs.length-1;for(var i=0,len=cs.length;i<len;i++){c=cs[i];cf=cfg[i];p.id=c.id;p.style=c.style;p.css=i==0?"x-grid3-cell-first ":(i==last?"x-grid3-cell-last ":"");if(cf.summaryType||cf.summaryRenderer){p.value=(cf.summaryRenderer||c.renderer)(o.data[c.name],p,o)}else{p.value=""}if(p.value==undefined||p.value===""){p.value="&#160;"}buf[buf.length]=this.cellTpl.apply(p)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:buf.join("")})},calculate:function(rs,cs){var data={},r,c,cfg=this.cm.config,cf;for(var j=0,jlen=rs.length;j<jlen;j++){r=rs[j];for(var i=0,len=cs.length;i<len;i++){c=cs[i];cf=cfg[i];if(cf.summaryType){data[c.name]=Ext.grid.GroupSummary.Calculations[cf.summaryType](data[c.name]||0,r,c.name,data)}}}return data},doGroupEnd:function(buf,g,cs,ds,colCount){var data=this.calculate(g.rs,cs);buf.push("</div>",this.renderSummary({data:data},cs),"</div>")},doWidth:function(col,w,tw){var gs=this.view.getGroups(),s;for(var i=0,len=gs.length;i<len;i++){s=gs[i].childNodes[2];s.style.width=tw;s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.width=w}},doAllWidths:function(ws,tw){var gs=this.view.getGroups(),s,cells,wlen=ws.length;for(var i=0,len=gs.length;i<len;i++){s=gs[i].childNodes[2];s.style.width=tw;s.firstChild.style.width=tw;cells=s.firstChild.rows[0].childNodes;for(var j=0;j<wlen;j++){cells[j].style.width=ws[j]}}},doHidden:function(col,hidden,tw){var gs=this.view.getGroups(),s,display=hidden?"none":"";for(var i=0,len=gs.length;i<len;i++){s=gs[i].childNodes[2];s.style.width=tw;s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.display=display}},refreshSummary:function(groupValue){return this.refreshSummaryById(this.view.getGroupId(groupValue))},getSummaryNode:function(gid){var g=Ext.fly(gid,"_gsummary");if(g){return g.down(".x-grid3-summary-row",true)}return null},refreshSummaryById:function(gid){var g=document.getElementById(gid);if(!g){return false}var rs=[];this.grid.store.each(function(r){if(r._groupId==gid){rs[rs.length]=r}});var cs=this.view.getColumnData();var data=this.calculate(rs,cs);var markup=this.renderSummary({data:data},cs);var existing=this.getSummaryNode(gid);if(existing){g.removeChild(existing)}Ext.DomHelper.append(g,markup);return true},doUpdate:function(ds,record){this.refreshSummaryById(record._groupId)},doRemove:function(ds,record,index,isUpdate){if(!isUpdate){this.refreshSummaryById(record._groupId)}},showSummaryMsg:function(groupValue,msg){var gid=this.view.getGroupId(groupValue);var node=this.getSummaryNode(gid);if(node){node.innerHTML='<div class="x-grid3-summary-msg">'+msg+"</div>"}}});Ext.grid.GroupSummary.Calculations={sum:function(v,record,field){return v+(record.data[field]||0)},count:function(v,record,field,data){return data[field+"count"]?++data[field+"count"]:(data[field+"count"]=1)},max:function(v,record,field,data){var v=record.data[field];var max=data[field+"max"]===undefined?(data[field+"max"]=v):data[field+"max"];return v>max?(data[field+"max"]=v):max},min:function(v,record,field,data){var v=record.data[field];var min=data[field+"min"]===undefined?(data[field+"min"]=v):data[field+"min"];return v<min?(data[field+"min"]=v):min},average:function(v,record,field,data){var c=data[field+"count"]?++data[field+"count"]:(data[field+"count"]=1);var t=(data[field+"total"]=((data[field+"total"]||0)+(record.data[field]||0)));return t===0?0:t/c},last:function(v,record,field,data){return v}};Ext.grid.HybridSummary=Ext.extend(Ext.grid.GroupSummary,{calculate:function(rs,cs){var gcol=this.view.getGroupField();var gvalue=rs[0].data[gcol];var gdata=this.getSummaryData(gvalue);return gdata||Ext.grid.HybridSummary.superclass.calculate.call(this,rs,cs)},updateSummaryData:function(groupValue,data,skipRefresh){var json=this.grid.store.reader.jsonData;if(!json.summaryData){json.summaryData={}}json.summaryData[groupValue]=data;if(!skipRefresh){this.refreshSummary(groupValue)}},getSummaryData:function(groupValue){var json=this.grid.store.reader.jsonData;if(json&&json.summaryData){return json.summaryData[groupValue]}return null}});Ext.ns("EasyJF.Ext.Tree");EasyJF.Ext.Tree.LocalPlugin=function(config){Ext.apply(this,config);EasyJF.Ext.Tree.LocalPlugin.superclass.constructor.call(this,config)};Ext.extend(EasyJF.Ext.Tree.LocalPlugin,Ext.util.Observable,{init:function(tree){this.tree=tree;this.loader=this.tree.loader;this.tree.on("render",this.initEvents,this);this.tree.on("beforedestroy",this.destroyCmp,this)},destroyCmp:function(){delete this.tree;delete this.loader;var shareCache=this.loader.shareCache;shareCache.un("addnode",this.addUINode,this);shareCache.un("updatenode",this.updateUINode,this);shareCache.un("removenode",this.removeUINode,this)},initEvents:function(){var shareCache=this.loader.shareCache;shareCache.on("addnode",this.addUINode,this);shareCache.on("updatenode",this.updateUINode,this);shareCache.on("removenode",this.removeUINode,this)},addUINode:function(node,parentNode){var parent=this.getNodeById(parentNode.id);if(parent){parent.leaf=false;parent.appendChild(node)}},updateUINode:function(upateNode){var node=this.getNodeById(upateNode.id);if(node){if(Ext.type(this.loader.transferNode)=="function"){upateNode=Ext.apply({},upateNode);this.loader.transferNode(upateNode)}node.setText(upateNode.text);Ext.copyToIf(node.attributes,upateNode,["children","cls","loader","parentNode"]);if(node.getUI() instanceof Ext.ux.tree.ColumnNodeUI){node.getUI().updateNode(upateNode)}if(!Ext.isEmpty(upateNode.qtip)){if(node.getUI().getTextEl().setAttributeNS){node.getUI().getTextEl().setAttributeNS("ext","qtip",upateNode.qtip)}else{node.getUI().getTextEl().setAttribute("ext:qtip",upateNode.qtip)}}}},removeUINode:function(node){var parentNode=node.parentNode;if(parentNode&&parentNode.children.length==0){var parentNode=this.getNodeById(parentNode.id);if(parentNode){parentNode.leaf=true;parentNode.getUI().updateExpandIcon()}}var node=this.getNodeById(node.id);if(node){node.remove()}},getNodeById:function(id){return this.tree.getNodeById(id)}});Ext.ns("EasyJF.Ext");EasyJF.Ext.TabPanelPlugin=function(b){Ext.apply(this,b);EasyJF.Ext.TabPanelPlugin.superclass.constructor.call(this)};Ext.extend(EasyJF.Ext.TabPanelPlugin,Ext.util.Observable,{init:function(b){this.tabPanel=b;this.initEvents()},initEvents:function(){this.tabPanel.on("contextmenu",this.showContextMenu,this);if(typeof(this.tabPanel.tabSize)=="number"){this.tabPanel.on("beforeadd",this.maxTabSize,this)}},maxTabSize:function(f,d,e){if(f.items.getCount()>this.tabPanel.tabSize){Ext.Msg.show({title:"\u6e29\u99a8\u63d0\u793a",msg:"\u9762\u677f\u8d85\u8fc7\u6700\u5927\u6570\uff0c\u8bf7\u5148\u5173\u95ed\uff01",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});return false}},createTabMenu:function(){return new Ext.menu.Menu({items:[{text:"\u5173\u95ed\u5f53\u524d\u9762\u677f",id:"closaCurrentTab",handler:this.closeTab,scope:this},{text:"\u5173\u95ed\u6240\u6709\u9762\u677f",handler:this.closeAllTab,id:"closaAllTab",scope:this},{text:"关闭其它页签",id:"closeOtherTab",handler:this.closeElsetTab,scope:this},{text:"\u5173\u95ed\u53f3\u8fb9\u9762\u677f",id:"closaRightTab",handler:this.closeRightTab,scope:this},{text:"\u5173\u95ed\u5de6\u8fb9\u9762\u677f",id:"closaLeftTab",handler:this.closeLeftTab,scope:this}]})},showContextMenu:function(f,e,d){if(!this.theMenu){this.theMenu=this.createTabMenu()}this.doAction(f,e,d);this.theMenu.currentTab=e;this.theMenu.showAt(d.getXY())},doAction:function(tabPanel,tab,e){!tab.closable?this.theMenu.items.get("closaCurrentTab").disable():this.theMenu.items.get("closaCurrentTab").enable();var isDisableAll=true;var isDisableRight=true;var isDisableLeft=true;tabPanel.items.each(function(tab){if(tab.closable){isDisableAll=false}},this);var closableTabs=tabPanel.items.filter("closable",true);if(isDisableAll){this.theMenu.items.get("closeOtherTab").setDisabled(true)}else{this.theMenu.items.get("closeOtherTab").setDisabled((closableTabs.getCount()==1&&closableTabs.itemAt(0)==tab))}isDisableAll?this.theMenu.items.get("closaAllTab").disable():this.theMenu.items.get("closaAllTab").enable();!tab.closable?this.theMenu.items.get("closaCurrentTab").disable():this.theMenu.items.get("closaCurrentTab").enable();var currentIndex=tabPanel.items.indexOf(tab);if(currentIndex==this.tabPanel.items.getCount()-1){this.theMenu.items.get("closaRightTab").disable()}else{this.theMenu.items.get("closaRightTab").enable()}for(var i=currentIndex;i<tabPanel.items.getCount()-1;i++){if(tabPanel.items.itemAt(i).closable){isDisableRight=false}}isDisableRight?this.theMenu.items.get("closaRightTab").disable():this.theMenu.items.get("closaRightTab").enable();for(var i=currentIndex-1;i>0;i--){if(tabPanel.items.itemAt(i).closable){isDisableLeft=false}}isDisableLeft?this.theMenu.items.get("closaLeftTab").disable():this.theMenu.items.get("closaLeftTab").enable()},closeAllTab:function(d,f){var e=d.parentMenu.currentTab;this.tabPanel.items.each(function(a){if(a.closable&&a!=f){this.tabPanel.remove(a)}},this)},closeTab:function(c){var d=c.parentMenu.currentTab;if(d.closable){this.tabPanel.remove(d)}},closeElsetTab:function(c){var d=c.parentMenu.currentTab;this.closeAllTab(c,d)},closeLeftTab:function(g){var h=g.parentMenu.currentTab;var f=this.tabPanel.items.indexOf(h)-1;if(f<=0){return}var e=this.tabPanel.items.getRange(1,f);Ext.each(e,function(a){if(a&&a.closable){this.tabPanel.remove(a)}},this)},closeRightTab:function(f){var d=f.parentMenu.currentTab;var e=this.tabPanel.items.getRange(this.tabPanel.items.indexOf(d)+1,this.tabPanel.items.getCount());Ext.each(e,function(a){if(!a||a==d||!a.closable){return}this.tabPanel.remove(a)},this)}});Lanyo_Ajax={version:"1.0",title:"蓝源Ajax快速开发框架",permissionCheck:true,permissionCheckAction:"permissionCheck.ejf",extVersion:"ext-3.2",script:"extApp.ejf?cmd=loadScript&script=",PersonalityUrl:"manage.ejf",sysSkinPath:null,getCfg:function(cfg){return Ext.getObjVal(window.Global.Config,cfg)},setCfg:function(key,value){var cfg=Lanyo_Ajax.getCfg();if(cfg){cfg[key]=value}},formatUrl:function(baseUrl,cmd){return Ext.urlAppend(baseUrl,Ext.urlEncode({cmd:cmd}))}};Ext.form.Field.prototype.msgTarget="side";Ext.chart.Chart.CHART_URL=String.format("plugins/extjs/{0}/resources/charts.swf",Lanyo_Ajax.extVersion);Ext.QuickTips.init();Ext.namespace("EasyJF.Ext","Ejf.Ext","EasyJF.Ext.Msg");EasyJF.Ext=EasyJF.Ext;EasyJF.Ext.Msg=EasyJF.Ext.Msg;Ext.apply(EasyJF.Ext.Msg,{alert:function(msg,title,fn,scope,type){var obj={title:title||"操作提示",msg:msg,scope:scope||window,fn:fn,icon:type||Ext.Msg.INFO,buttons:Ext.Msg.OK};if(typeof msg=="object"){Ext.apply(obj,msg)}Ext.Msg.show(obj)},error:function(msg,title,fn,scope){var expargs=EasyJF.Ext.Msg.error.length;var args=Array.prototype.slice.call(arguments,0,expargs);if(expargs!=args.length){if(args.length<expargs){var i=args.length;for(i;i<expargs;i++){args.push(null)}args.push(Ext.Msg.ERROR)}}else{args.push(Ext.Msg.ERROR)}EasyJF.Ext.Msg.alert.apply(this,args)}});EasyJF.Ext.Window=function(){var components=new Ext.util.MixedCollection();components.on("add",function(length,o,key){if(length>50){components.removeAt(0)}},this);var all=new Ext.util.MixedCollection();var buttonText={ok:"确定",cancel:"重置",yes:"确定",no:"取消"};var buttonHandler=function(button,btn){var win=button.ownerCt.ownerCt;Ext.callback(win.handler,win.scope||win,[btn,win,win.getComponent(0)]);if(win.autoHide){win.hide()}};return{defaultConfig:{maxWin:5,width:500,height:300,modal:true,layout:"fit",single:true,constrain:true,resizable:false,buttonAlign:"center",closeAction:"hide"},components:components,autoDestroyWin:function(win){if(this.all.getCount()>this.defaultConfig.maxWin){win.destroy();this.autoRemoveProperty.call(win);this.all.remove(win)}},autoRemoveProperty:function(){delete this.handler;delete this.scope;delete this.autoHide},destroyComp:function(){var args=Array.prototype.slice.call(arguments,0);Ext.each(args,function(c){if(Ext.type(c.destroy)=="function"){c.destroy()}components.remove(c)},this)},show:function(obj){var config=Ext.apply({},obj,this.defaultConfig);var win=this.getFreeWin(config);win.on("beforehide",this.autoDestroyWin,this,{single:true});win.on("hide",function(win){if(config.single){win.remove(0,true);components.remove(win.getComponent(0));this.autoRemoveProperty.call(win)}else{var cmp=win.remove(0,false);cmp.hide();cmp.getEl().appendTo(Ext.getBody())}},this,{single:true});win.show();win.setTitle(config.title);win.setWidth(config.width);if(config.height=="auto"){win.autoHeight=true;win.syncSize.defer(1000,win)}else{win.autoHeight=false;win.setHeight(config.height)}win.center()},buildComponent:function(cmp,compId){if(components.get(compId)){return components.get(compId)}else{if(Ext.type(cmp)=="object"){var component=null;if(cmp.constructor.prototype.ctype=="Ext.Component"){component=cmp}else{if(cmp.constructor==Object){component=Ext.ComponentMgr.create(cmp,"panel")}else{component=cmp}}if(compId){components.add(compId,component)}return component}}},updateButtons:function(win,buttons){if(Ext.isArray(buttons)&&buttons.length){Ext.each(win.buttons,function(btn){if(buttons.indexOf(btn.id)>=0){btn.show()}else{btn.hide()}},win)}else{Ext.each(win.buttons,function(btn){btn.hide()},win)}},getFreeWin:function(config){var win=null;all.each(function(o){if(o.hidden){win=o;return false}},this);var cmp=config.items;var buttons=config.buttons;var handler=config.handler;var scope=config.scope;var autoHide=config.autoHide;Ext.del(config,"buttons","items","handler","autoHide","scope");cmp=this.buildComponent(cmp,config.compId);var win=win||this.getWin(Ext.apply(config,{buttons:this.getButtons.call(this)}));win.autoHide=autoHide;win.handler=handler;win.scope=scope;this.updateButtons(win,buttons);if(win.items&&win.items.getCount()>0){win.remove(0,false)}if(cmp.hidden){cmp.show()}win.add(cmp);return win},all:all,getWin:function(config){var win=new Ext.Window(Ext.apply(config,{manager:this.group}));all.add(win);return win},YESNO:["yes","no"],YESNOCANCEL:["yes","cancel","no"],YES:["yes"],getButtons:(function(){return[{text:buttonText.yes,id:"yes",handler:buttonHandler.createDelegate(this,["yes"],1),scope:this},{text:buttonText.cancel,id:"cancel",handler:buttonHandler.createDelegate(this,["cancel"],1),scope:this},{text:buttonText.no,id:"no",handler:buttonHandler.createDelegate(this,["no"],1),scope:this}]})}}();Ext.form.LabelField=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"div"},fieldClass:"x-form-item-label",style:"padding-top:3px",onRender:function(ct,position){Ext.form.LabelField.superclass.onRender.call(this,ct,position);this.el.dom.name=this.initialConfig.name;this.el.dom.value=""},setValue:function(v){Ext.form.LabelField.superclass.setValue.call(this,v);var t=v;if(this.renderer){t=this.renderer(v)}if(typeof t==window.undefined){t=""}if(this.el){this.el.update(t)}},markInvalid:Ext.emptyFn,clearInvalid:Ext.emptyFn});Ext.reg("labelfield",Ext.form.LabelField);Ext.form.LabelFieldReadonly=Ext.extend(Ext.form.LabelField,{getValue:Ext.emptyFn});Ext.reg("labelfieldreadonly",Ext.form.LabelField);Ext.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{onSearch:function(){this.hasSearch=true},onClear:function(){if(this.hasSearch){this.hasSearch=false;this.el.dom.value="";this.triggers[0].hide();this.focus()}},initComponent:function(){Ext.form.SearchField.superclass.initComponent.call(this);this.addEvents("search","clear");this.on("specialkey",function(f,e){if(e.getKey()==e.ENTER&&!(e.shiftKey||e.ctrlKey||e.altKey)){this.onSearch(this,this.getValue(),e)}},this);this.on({scope:this,clear:this.onClear,search:this.onSearch})},validationEvent:false,validateOnBlur:false,hideTrigger1:true,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",width:180,hasSearch:false,paramName:"query",onTrigger1Click:function(e){this.fireEvent("clear",this,this.getValue(),e)},onTrigger2Click:function(e){this.fireEvent("search",this,this.getValue(),e)}});EasyJF.Ext.SearchField=Ext.extend(Ext.form.SearchField,{validationEvent:false,validateOnBlur:false,emptyText:"内容关键字......",onClear:function(){if(this.hasSearch){EasyJF.Ext.SearchField.superclass.onClear.call(this);var s=this.store;delete s.baseParams[this.paramName];s.load()}},onSearch:function(){var v=this.getRawValue();if(v.length<1){return this.onTrigger1Click()}this.store.baseParams={};this.store.baseParams[this.paramName]=v;var o={start:0,searchType:"simple"};this.store.reload({params:o,callback:function(rs){if(!rs||rs.length<1){Ext.Msg.alert("提示","没有找到符合条件的记录！")}}});this.hasSearch=true;this.triggers[0].show();this.focus()},initComponent:function(){if(!this.store.baseParams){this.store.baseParams={}}EasyJF.Ext.SearchField.superclass.initComponent.call(this)}});Ext.reg("searchfield",EasyJF.Ext.SearchField);EasyJF.Ext.CkEditor=Ext.extend(Ext.form.TextArea,{editorCfg:{},onResize:function(t,w,h){var ed;if(ed=this.getEditor()){ed.resize("100%",h-5)}},editDataReadyHanlder:function(){this.fireEvent("editdataready",this,this.getEditor(),this.getEditor().getData())},setValue:function(v,callback){EasyJF.Ext.CkEditor.superclass.setValue.call(this,v);var ed;if(ed=this.getEditor()){var fn=this.editDataReadyHanlder;if(Ext.isFunction(callback)){callback.createSequence(fn,this)}else{callback=fn.createDelegate(this)}ed.setData.defer(1,ed,[v,callback])}else{}},getValue:function(){var ed;if(ed=this.getEditor()){return ed.getData()}else{return EasyJF.Ext.CkEditor.superclass.getValue.call(this)}},getEditor:function(){if(this.el){var id=this.el.id,ed=null;if(window.CKEDITOR&&CKEDITOR.instances&&(ed=CKEDITOR.instances[id])){return ed}}},createEditor:function(){var id=this.el.id;var size=this.el.getSize();var h=Math.max(size.height,this.height);var editor=CKEDITOR.replace(id,Ext.apply({height:h},this.editorCfg));var em=this;editor.on("instanceReady",function(){em.fireEvent.call(em,"instanceReady");editor.resize("100%",h-5)})},afterRender:function(){this.addEvents("editdataready","instanceReady");EasyJF.Ext.CkEditor.superclass.afterRender.call(this);this.on("resize",this.onResize,this);this.createEditor.defer(1,this)}});Ext.reg("ckeditor",EasyJF.Ext.CkEditor);EasyJF.Ext.FormWindow=Ext.extend(Ext.Window,{confirmSave:false,checkFormDirty:function(){var fp=this.getComponent(0);if(fp&&fp.form){return fp.form.isDirty()}else{return false}},hide:function(animateTarget,cb,scope){if(this.hidden||this.fireEvent("beforehide",this)===false){return}if(this.confirmSave&&this.checkFormDirty()){Ext.MessageBox.show({title:"是否要保存录入的数据?",msg:"您所编辑的表单中含有末保存的数据,是否要保存修改后的内容?",buttons:Ext.Msg.YESNOCANCEL,fn:function(btn){if(btn=="no"){EasyJF.Ext.FormWindow.superclass.hide.call(this,animateTarget,cb,scope)}else{if(btn=="yes"){if(this.crudService){this.crudService.save(EasyJF.Ext.FormWindow.superclass.hide.createDelegate(this,[animateTarget,cb,scope]),this.autoClose)}else{if(Ext.isFunction(this.saveFunction)){this.saveFunction(this.getComponent(0))}}}else{if(btn=="cancel"){}}}},icon:Ext.MessageBox.QUESTION,scope:this})}else{EasyJF.Ext.FormWindow.superclass.hide.call(this,animateTarget,cb,scope)}}});EasyJF.Ext.CascadeForm=Ext.extend(Ext.FormPanel,{layout:"border",formElements:["west","north","east","south"],buildWestForm:function(){},buildNorthForm:function(){},buildEastForm:function(){},buildSouthForm:function(){},buildContentForm:function(){},getEditCmps:function(){return this.editCmps=this.editCmps||[]},addEditCmps:function(cmp){Ext.each(arguments,function(cmp){if(Ext.isArray(cmp)){this.addEditCmps(cmp);return true}if(!this.containsEditCmp(cmp)){this.getEditCmps().push(cmp)}},this)},containsEditCmp:function(cmp){return this.getEditCmps().indexOf(cmp)>=0},getEditorCmpValues:function(){var values={};Ext.each(this.getEditCmps(),function(cmp){var rvs=cmp.getRowsValues();if(rvs){Ext.apply(values,rvs)}},this);return values},getValues:function(){var values=this.getForm().getValues();var cmpValues=this.getEditorCmpValues();Ext.apply(values,cmpValues);return values},setValues:function(values){this.getForm().setValues(values)},onBeforeSubmit:function(){var values=this.getEditorCmpValues();this.getForm().baseParams=values},submit:function(options){if(this.onBeforeSubmit()!==false){this.getForm().submit(options)}},beforeDestroy:function(){this.editCmps=null;EasyJF.Ext.CascadeForm.superclass.beforeDestroy.call(this)},createContent:function(){var cf=this.buildContentForm();this.addEditCmps(cf);return cf},initComponent:function(){this.items=[{layout:"fit",region:"center",border:false,items:this.createContent()}];for(var i=0;i<this.formElements.length;i++){var en=this.formElements[i],cmp;var eName=en.substring(0,1).toUpperCase()+en.substring(1);if(cmp=this[String.format("build{0}Form",eName)]()){cmp.region=en;this.items.push(cmp)}}EasyJF.Ext.CascadeForm.superclass.initComponent.call(this)}});EasyJF.Ext.TreeCascadePanel=Ext.extend(Ext.Panel,{treeCfg:{},layout:"hbox",border:false,layoutConfig:{align:"stretch"},queryParam:"type",defaultstreeCfg:{width:200,dataUrl:"",rootText:"root",rootId:"root",loader:null,rootVisible:true},getPanel:function(){return this.panel},getTree:function(){return this.tree},getGrid:function(){if(this.panel instanceof Ext.grid.GridPanel){return this.panel}else{if(this.panel instanceof EasyJF.Ext.CrudPanel){return this.panel.grid}else{if(this.panel&&this.panel.grid){return this.panel.grid}}}},createTree:function(){var cfg=Ext.apply({},this.treeCfg,this.defaultstreeCfg);var rootId=cfg.rootId;var rootText=cfg.rootText;var dataUrl=cfg.dataUrl;var treeLoader=cfg.loader;var iconCls=cfg.rootIconCls;delete cfg.rootId,delete cfg.rootText,delete cfg.dataUrl,delete cfg.loader,cfg.rootIconCls;var tree=new Ext.tree.TreePanel(Ext.apply({tools:[{id:"refresh",handler:function(){this.tree.root.reload()},scope:this}],style:"padding-right:1px;padding-top:1px;",root:new Ext.tree.AsyncTreeNode({id:rootId,iconCls:iconCls,text:rootText}),loader:treeLoader||new Ext.tree.TreeLoader({dataUrl:dataUrl})},cfg));tree.on({scope:this,click:this.onTreeClick});return tree},reloadGrid:function(id,node){var g=this.getGrid();if(g){g.getStore().baseParams[this.queryParam]=(id=="root")?null:id;g.getStore().load()}},onTreeClick:function(node,eventObject){this.reloadGrid(node.id,node)},beforeDestroy:function(){Ext.destroy(this.panel,this.tree);delete this.panel;delete this.tree;EasyJF.Ext.TreeCascadePanel.superclass.beforeDestroy.call(this)},initComponent:function(){this.tree=this.createTree();this.items=[this.tree,Ext.apply(this.getPanel(),{flex:1})];EasyJF.Ext.TreeCascadePanel.superclass.initComponent.call(this)}});EasyJF.Ext.CrudFunction={exportData:false,importData:false,printData:false,clearData:false,allowSearch:true,showMenu:true,showAdd:true,showEdit:true,showRemove:true,showView:true,showRefresh:true,showSearchField:true,batchRemoveMode:false,autoLoadGridData:true,columnLock:false,summaryGrid:false,dirtyFormCheck:true,operatorButtonStyle:1,customizeQueryObject:false,queryObjectName:null,winWidth:500,winHeight:400,winTitle:"数据管理",pageSize:10,pagingToolbar:true,defaultCmd:true,viewSave:Ext.emptyFn,initComponent:Ext.emptyFn,linkRender:EasyJF.Ext.Util.linkRenderer,imgRender:EasyJF.Ext.Util.imgRender,booleanRender:EasyJF.Ext.Util.booleanRender,dateRender:EasyJF.Ext.Util.dateRender,objectRender:EasyJF.Ext.Util.objectRender,typesRender:EasyJF.Ext.Util.typesRender,readOnlyRender:EasyJF.Ext.Util.readOnlyRender,operaterRender:EasyJF.Ext.Util.operaterRender,singleWindowMode:false,gridSelModel:"row",gridRowNumberer:false,booleans:[["是",true],["否",false]],crud_operators:[{name:"btn_add",text:"添加(<u>A</u>)",iconCls:"add",method:"create",cmd:"save",noneSelectRow:true,hidden:true},{name:"btn_edit",text:"编辑(<u>E</u>)",iconCls:"edit",disabled:true,method:"edit",cmd:"update",hidden:true},{name:"btn_view",text:"查看(<u>V</u>)",iconCls:"view",method:"view",disabled:true,hidden:true},{name:"btn_remove",text:"删除(<u>D</u>)",iconCls:"delete",disabled:false,method:"removeData",cmd:"remove",hidden:true},{name:"btn_refresh",itemId:"btn_refresh",text:"刷新",iconCls:"refresh",method:"refresh",noneSelectRow:true},{name:"btn_advancedSearch",text:"高级查询(<u>S</u>)",iconCls:"srsearch",method:"advancedSearch",cmd:"list",hidden:true,noneSelectRow:true,clientOperator:true},{name:"btn_clearSearch",text:"显示全部",cls:"x-btn-text-icon",iconCls:"search",noneSelectRow:true,method:"clearSearch",hidden:true},{name:"btn_print",text:"打印(<u>P</u>)",iconCls:"print-icon",disabled:true,method:"printRecord",hidden:true},{name:"btn_export",text:"导出Excel(<u>O</u>)",iconCls:"export-icon",method:"exportExcel",noneSelectRow:true,hidden:true},{name:"btn_import",text:"导入数据(<u>I</u>)",iconCls:"import-icon",method:"importExcel",noneSelectRow:true,hidden:true},"->",{type:"searchfield",name:"searchField",width:100,noneSelectRow:true,paramName:"searchKey",clientOperator:true}],objectAutoRender:function(v){if(v&&v.id){for(var d in v){if(d!="id"&&v[d]){return v[d]}}return v.id}else{return v}},search:function(){Ext.apply(this.store.baseParams,{searchKey:this.searchField?this.searchField.getValue():""});if(this.store.lastOptions&&this.store.lastOptions.params){this.store.lastOptions.params.start=0;this.store.lastOptions.params.pageSize=this.store.baseParams.pageSize||this.pageSize}this.refresh(false)},formatUrl:function(cmd){return Lanyo_Ajax.formatUrl(this.baseUrl,cmd)},importExcel:function(){if(!EasyJF.Ext.ImportPanel){EasyJF.Ext.ImportPanel=new Ext.form.FormPanel({id:"crudExportPanel",fileUpload:true,items:[{xtype:"fieldset",title:"选择数据文件",autoHeight:true,items:{xtype:"textfield",hideLabel:true,inputType:"file",name:"file",anchor:"100%"}},{xtype:"fieldset",title:"导入说明",html:this.importExplain||"",height:60}]})}var win=this.createGlobalWin("CrudExportWindow",300,210,"导入数据",EasyJF.Ext.ImportPanel,function(){var form=EasyJF.Ext.ImportPanel.form;if(form.findField("file").getValue().length<2){Ext.Msg.alert("提示","你没有选择要导入的文件！");return}EasyJF.Ext.ImportPanel.form.submit({url:this.baseUrl,params:{cmd:"import"},waitMsg:"请稍候，正在导入数据",success:function(){Ext.Msg.alert("提示","数据导入成功!",function(){form.findField("file").reset();win.hide();this.store.reload()},this)},failure:function(form,action){this.alert((action.result.errors.msg||"数据导入出错，请检测所选择的文件格式是否正确?"),"提示信息")},scope:this})})},getExportForm:EasyJF.Ext.Util.getExportForm,exportExcel:function(){var params=this.store.baseParams;Ext.apply(params,{searchKey:this.searchField?this.searchField.getValue():""});var exportForm=this.getExportForm();exportForm.form.submit({url:this.baseUrl,params:Ext.apply({cmd:"export"},this.store.baseParams)})},printList:function(cmd){return function(){var params=Ext.apply(this.store.baseParams,{cmd:(cmd?cmd:"printList")});var s=Ext.urlEncode(params);window.open(this.baseUrl+"?"+s)}},printRecord:function(){var record=this.grid.getSelectionModel().getSelected();if(!record){this.alert("请先选择要操作的数据！","提示信息");return false}window.open(this.baseUrl+"?cmd=print&id="+record.get("id"))},clearSearch:function(){this.store.baseParams={};this.store.removeAll();this.store.load({params:{start:0,pageSize:this.pageSize}})},refresh:function(reload){this.store.removeAll();var callback=function(rs){if(rs&&rs.length<1){this.alert("没有符合条件的数据！","提示信息");EasyJF.Ext.Util.autoCloseMsg.defer(2000)}};var cfg={callback:callback,scope:this};this.store[reload!==false?"reload":"load"](cfg);this.disableOperaterItem("btn_remove","btn_edit","btn_view","btn_print");this.focus()},initWin:function(width,height,title,callback,autoClose,resizable,maximizable){this.winWidth=width;this.winHeight=height;this.winTitle=title;var winName=autoClose?"CrudEditNewWindow":"CrudEditWindow";if(this.singleWindowMode){winName=winName+this.id}var win=this.createGlobalWin(winName,width,height,title,this.fp,null,"fp",[{itemId:"btnSave",text:"保存(<u>K</u>)",handler:function(){EasyJF.Ext[winName].crudService.save(callback,autoClose)},iconCls:"save",scope:this},{itemId:"btnReset",text:"重置(<u>R</u>)",iconCls:"clean",handler:function(){EasyJF.Ext[winName].crudService.reset()},scope:this},{itemId:"btnClose",text:"取消(<u>X</u>)",iconCls:"delete",handler:function(){EasyJF.Ext[winName].crudService.closeWin(autoClose)},scope:this}],autoClose,resizable?true:false,maximizable?true:false);win.confirmSave=this.dirtyFormCheck;return win},getViewWin:function(autoClose){var viewWin=Ext.isFunction(this.viewWin)?this.viewWin():this.viewWin;var width=viewWin.width;var height=viewWin.height;var title=viewWin.title;return this.createGlobalWin("CrudViewWindow",width,height,title,this.viewPanel,function(){var w=EasyJF.Ext.CrudViewWindow;if(w.crudService){w.crudService.viewSave(this.viewPanel)}w.hide()},"viewPanel",null,autoClose)},doSomeWork:function(width,height,title,panel,createPanel,cmd,workWinName,url,autoClose){var record=this.grid.getSelectionModel().getSelected();if(!record){this.alert("请先选择要操作的数据！","提示信息");return false}if(!this[panel]){this[panel]=this[createPanel]()}var win=this.getWorkWin(width,height,title,this[panel],function(){if(!this[panel].form.isValid()){return false}this[panel].form.submit({url:url?url:this.baseUrl,waitMsg:"正在执行操作，请稍候",params:{cmd:cmd},success:function(){win.hide();this.refresh()},failure:function(form,action){var msg="";if(action.failureType==Ext.form.Action.SERVER_INVALID){for(var p in action.result.errors){msg+=action.result.errors[p]+"&nbsp;"}}else{msg="数据录入不合法或不完整！"}EasyJF.Ext.Msg.alert(msg,"保存失败!")},scope:this})},panel,workWinName,autoClose);return win},getWorkWin:function(width,height,title,workPanel,save,pname,winName,autoClose){var record=this.grid.getSelectionModel().getSelected();if(!record){this.alert("请先选择要操作的数据！","提示信息");return false}var id=record.get("id");var win=this.createGlobalWin(winName?winName:"CrudWorkWindow",width,height,title,workPanel,save,pname,null,autoClose);for(var n in record.data){var c=win.getComponent(0).findSomeThing(n);if(c){var v=record.get(n);if(c.isFormField){c.setValue(v);c.clearDirty()}else{if(c.renderer){v=c.renderer(v)}if(c.setText){c.setText(v)}else{if(c.getXType&&c.getXType()=="panel"){c.body.update(v)}}}}}return win},alert:function(msg,title){EasyJF.Ext.Msg.alert(msg,title||"提示",function(){this.focus()},this)},confirm:function(title,msg,callback){Ext.Msg.confirm(title,msg,function(btn){if(btn=="yes"){callback()}else{this.focus()}},this)},focusFirstField:function(fp,win){fp=fp||this.fp;win=win||this.win;fp=win.findBy(function(cmp){if(cmp instanceof Ext.FormPanel){return true}},this);win.currentFocus=false;if(fp&&fp[0].form.items){fp[0].form.items.each(function(o){if(o.canFocus()){o.focus("",10);win.currentFocus=o;return false}})}if(!win.currentFocus){if(win.buttons&&win.buttons.length){win.buttons[0].focus("",10);win.currentFocus=win.buttons[0]}}},createGlobalWin:function(winName,width,height,title,workPanel,save,pname,buttons,autoClose,resizable,maximizable){var win=EasyJF.Ext[winName];if(!win){this[pname?pname:workPanel.id]=workPanel;var tools=[];tools.push({id:"help",handler:this.help});EasyJF.Ext[winName]=new EasyJF.Ext.FormWindow({width:width,layout:"fit",border:false,resizable:resizable,height:height,buttonAlign:"center",title:title,modal:true,defaultButton:0,shadow:true,maximized:false,maximizable:maximizable,tools:tools,closeAction:autoClose||this.singleWindowMode?"close":"hide",autoClose:autoClose||this.singleWindowMode,listeners:{close:function(win){if(win.crudService.store&&win.crudService.closeSaveWin===false&&winName!="CrudSearchWindow"){win.crudService.store.reload()}win.crudService.focusCrudGrid();delete EasyJF.Ext[winName]},maximize:function(win){if(win.maximizable){win.doLayout();win.maximized=true}},restore:function(win){if(win.maximizable){win.doLayout();win.maximized=false}},show:function(win){if(win.maximizable){win.tools[win.maximized?"maximize":"restore"].setVisible(win.crudService.maximizable===true)}win.tools.help.setVisible(win.crudService.showHelp!=undefined);var fp=win.findByType(Ext.FormPanel);win.crudService.focusFirstField(fp,win)},hide:function(win){if(win.crudService.store&&win.crudService.closeSaveWin===false&&winName!="CrudSearchWindow"){win.crudService.store.reload()}win.crudService.focus()}},items:[workPanel],buttons:buttons?buttons:[{itemId:"btnSave",text:"确定(<u>K</u>)",handler:function(){var w=EasyJF.Ext[winName];var h=true;if(save){h=save.call(w.crudService,autoClose)}if(h){if(autoClose){w.close()}else{w.hide()}}},iconCls:"save",scope:this},{itemId:"btnClose",text:"退出(<u>X</u>)",iconCls:"delete",handler:function(){if(autoClose||this.singleWindowMode){EasyJF.Ext[winName].close()}else{EasyJF.Ext[winName].hide()}},scope:this}],keys:[{key:"k",alt:true,stopEvent:true,fn:function(){EasyJF.Ext.Util.executePanelButtons(win,"btnSave")}},{key:"x",stopEvent:true,alt:true,fn:function(){EasyJF.Ext.Util.executePanelButtons(win,"btnClose")}},{key:"r",stopEvent:true,alt:true,fn:function(){EasyJF.Ext.Util.executePanelButtons(win,"btnReset")}}]});win=EasyJF.Ext[winName]}else{if(workPanel){if(win.crudService!=this){}win.setTitle(title);win.setWidth(width);win.setHeight(height);if(win.getComponent(0)!=workPanel){var p=win.remove(0);delete win.crudService[pname?pname:p.id];win.add(workPanel);this[pname?pname:workPanel.id]=workPanel;win.doLayout()}}}win.crudService=this;this[winName]=win;win.show((typeof main!="undefined")&&Lanyo_Ajax.getCfg("enableAnimate")?Ext.getBody():false,function(){win.center()},this);if(height=="auto"){win.autoHeight=true;win.syncSize.defer(1000,win)}else{win.autoHeight=false}return win},showWin:function(){if(!this.fp){if(!this.createViewPanel&&this.viewPanel){this.fp=this.viewPanel}else{this.fp=this.createForm()}}this.win=this.createWin();this.win.on("close",function(){delete this.win;delete this.fp},this);this.win.show((typeof main!="undefined")&&window.Global.Config.enableAnimate?Ext.getBody():false,function(){this.win.center()},this)},onCreate:function(){},create:function(){this.showWin();this.fp.form.clearData();this.reset();this.fp.form.isValid();this.onCreate();this.beingCreate=true;this.formFocus.defer(500,this)},createObject:function(callback,winReadyAction){this.fp=this.createForm();this.win=this.createWin(callback,true);this.win.on("close",function(){delete this.win;delete this.fp},this);this.win.show((typeof main!="undefined")&&Lanyo_Ajax.getCfg("enableAnimate")?Ext.getBody():false,function(){this.win.center()},this);this.reset();if(winReadyAction){winReadyAction(this.win,this)}this.fp.form.isValid();this.onCreate();this.beingCreate=true;this.formFocus.defer(500,this)},onEdit:function(ret,data){},editObject:function(id,callback,winReadyAction){this.fp=this.createForm();this.beingCreate=true;this.win=this.createWin(callback,true);this.win.on("close",function(){delete this.win;delete this.fp},this);this.win.show((typeof main!="undefined")&&Lanyo_Ajax.getCfg("enableAnimate")?Ext.getBody():false,function(){this.win.center()},this);var viewCmd=this.viewCmd||"view";Ext.Ajax.request({url:this.baseUrl+"?cmd="+viewCmd,params:{id:id},waitMsg:"正在加载数据,请稍侯...",callback:function(options,success,response){var r=Ext.decode(response.responseText);this.fp.form.setValues(r);if(winReadyAction){winReadyAction(this.win,r,this)}this.onEdit(true,r);this.fp.form.isValid();this.formFocus.defer(500,this);this.fp.form.clearDirty()},scope:this})},edit:function(e){if(e&&e.getTarget&&e.getTarget("div.x-grid3-row-checker")){return false}if(this.btn_edit&&this.btn_edit.disabled){this.view();return false}var record=this.grid.getSelectionModel().getSelected();if(!record){this.alert("请先选择要操作的数据！","提示信息");return false}var id=record.get("id");this.beingCreate=false;this.showWin();this.fp.form.reset();this.fp.form.loadRecord(record);this.onEdit(id,record.data);this.fp.form.clearDirty();this.formFocus.defer(500,this);return true},removeObject:function(id,callback){this.confirm("删除确认","确定要删除吗？",function(ret){Ext.Ajax.request({url:this.baseUrl+"?cmd=remove",params:{id:id},method:"POST",success:function(response){var r=Ext.decode(response.responseText);if(!r.success){this.alert("操作失败，失败原因为：<br/>"+(r.errors.msg?r.errors.msg:"未知"),"提示信息")}else{this.alert("删除成功","提示信息");if(callback){callback()}}},scope:this})}.createDelegate(this),this)},formFocus:function(){var field=this.fp.form.items.get(1);if(!field||field.disabled){this.items.each(function(f){if(!f.disabled){field=f;return false}})}if(field&&!field.disabled){field.focus("",100)}},validateForm:function(form){if(!form.isValid()){this.alert("表单数据不合法,请注意必填项及录入的数据格式!","提示",function(){this.formFocus()},this);return false}return true},beforeSave:function(){return true},onSave:function(form,action){},save:function(callback,autoClose,ignoreBeforeSave){if(!this.validateForm(this.fp.form)){return false}if(ignoreBeforeSave!==true){if(this.beforeSave&&this.beforeSave()===false){return false}}var id=this.fp.form.findField("id").getValue();var url=this.baseUrl;if(this.fp.form.fileUpload){var cmd=this.fp.form.findField("cmd");if(cmd==null){cmd=new Ext.form.Hidden({name:"cmd"});this.fp.add(cmd);this.fp.doLayout()}cmd.setvalue((this.beingCreate?"save":(id?"update":"save")))}else{url=this.formatUrl((this.beingCreate?"save":(id?"update":"save")))}EasyJF.Ext.Util.submitForm(this.fp.form,url,function(form,action){this.fp.form.clearDirty();if(this.closeSaveWin!==false){this.closeWin(autoClose)}if(this.store&&this.closeSaveWin!==false){this.store.reload()}if(callback){callback()}this.fireEvent("saveobject",this,form,action);this.onSave(form,action)},this)},preview:function(callback,autoClose){if(!this.validateForm(this.fp.form)){return false}var id=this.fp.form.findField("id").getValue();var url=this.baseUrl;if(this.fp.form.fileUpload){var cmd=this.fp.form.findField("cmd");if(cmd==null){cmd=new Ext.form.Hidden({name:"cmd"});this.fp.add(cmd);this.fp.doLayout()}cmd.setValue("preview")}else{url+="?cmd=preview"}var tempHiddens=[];var ps=this.fp.form.baseParams;if(ps&&typeof ps=="string"){ps=Ext.urlDecode(bp)}var form=this.fp.form.el.dom;function addHiddenKey(key,value){var hd=document.createElement("input");hd.type="hidden";hd.name=key;hd.value=value;form.appendChild(hd);tempHiddens.push(hd)}for(var k in ps){if(Ext.isArray(ps[k])){for(var i=0;i<ps[k].length;i++){addHiddenKey(k,ps[k][i]?ps[k][i]:"")}}else{if(ps.hasOwnProperty(k)){addHiddenKey(k,ps[k]?ps[k]:"")}}}this.fp.form.el.dom.action=url;this.fp.form.el.dom.target="_blank";this.fp.form.el.dom.submit();if(tempHiddens){for(var i=0,len=tempHiddens.length;i<len;i++){Ext.removeNode(tempHiddens[i])}}},reset:function(){if(this.win&&this.fp){this.fp.form.reset()}},closeWin:function(autoClose){if(this.beforeClose){this.beforeClose(function(){if(this.win){if(autoClose){this.win.close()}else{this.win.hide()}}if(this.store&&this.closeSaveWin===false){}})}else{if(this.win){if(autoClose){this.win.close()}else{this.win.hide()}}if(this.store&&this.closeSaveWin===false){}}},removeData:function(){if(this.btn_remove.disabled){return false}var record=this.grid.getSelectionModel().getSelected();if(!record){this.alert("请先选择要操作的数据！","提示信息");return false}var mulitId="";if(this.batchRemoveMode){var rs=this.grid.getSelectionModel().getSelections();for(var i=0;i<rs.length;i++){mulitId+=rs[i].get("id")+","}}var m=this.confirm("删除确认","确定要删除吗？",function(ret){Ext.Ajax.request({url:this.formatUrl("remove"),params:{id:record.get("id"),mulitId:mulitId},method:"POST",success:function(response,options){var r=Ext.decode(response.responseText);if(r&&!r.success){EasyJF.Ext.Msg.error("失败原因为：<br/>"+(r.errors.msg?r.errors.msg:"未知"))}else{Ext.Msg.alert("提示","删除成功",function(){this.store.removeAll();this.store.reload();this.focus()},this)}this.fireEvent("removeobject",this,r,options)},scope:this})}.createDelegate(this),this);return true},executeUrl:EasyJF.Ext.Util.executeUrl,executeCmd:function(cmd,allowBlank){return function(c){var sel=this.grid.getSelectionModel();var record=sel.getSelectedCell?(sel.getSelectedCell()?this.grid.store.getAt(sel.getSelectedCell()[0]):null):sel.getSelected();if(!c.noneSelectRow){if(!record&&!allowBlank){this.alert("请先选择要操作的数据！");return}}var id=record?record.get("id"):"";Ext.Ajax.request({waitMsg:"正在执行操作，请稍候...",url:this.formatUrl(cmd),params:{id:id},method:"POST",success:function(response){var r=Ext.decode(response.responseText);if(!r.success){this.alert("操作失败，失败原因为：<br/>"+(r.errors.msg?r.errors.msg:"未知"))}else{Ext.Msg.alert("提示",r.data?r.data:"操作成功",function(){this.store.reload();this.focus()},this)}},scope:this})}},executeMulitCmd:function(cmd){return function(){var record=this.grid.getSelectionModel().getSelections();if(!record||record.length<1){this.alert("请先选择要操作的数据！");return}var mulitId="";for(var i=0;i<record.length;i++){if(record[i].get("id")){mulitId+=record[i].get("id")+","}}Ext.Ajax.request({waitMsg:"正在执行操作，请稍候...",url:this.formatUrl(cmd),params:{mulitId:mulitId},method:"POST",success:function(response){var r=Ext.decode(response.responseText);if(!r.success){this.alert("操作失败，失败原因为：<br/>"+(r.errors.msg?r.errors.msg:"未知"))}else{Ext.Msg.alert("提示",r.data?r.data:"操作成功",function(){this.store.reload();this.focus()},this)}},scope:this})}},onView:function(){},view:function(){if(this.readInfo){return this.readInfo()}var record=this.grid.getSelectionModel().getSelected();if(!record){this.alert("请先选择要操作的数据！");return false}var id=record.get("id");var win=this.showViewWin();for(var n in record.data){var c=win.getComponent(0).findSomeThing(n);if(c){var v=record.get(n);if(c.isFormField){c.setValue(v);c.clearDirty()}else{if(c.renderer){v=c.renderer(v)}if(c.setText){c.setText(v)}else{if(c.getXType&&c.getXType()=="panel"){c.body.update(v)}}}}}this.onView(win,record.data);return win},viewObject:function(id,callback){var win=this.showViewWin(true);var viewCmd=this.viewCmd||"view";Ext.Ajax.request({url:this.formatUrl(viewCmd),params:{id:id},waitMsg:"正在加载数据,请稍侯...",callback:function(options,success,response){var r=Ext.decode(response.responseText);for(var n in r){var c=win.getComponent(0).findSomeThing(n);if(c){var v=r[n];if(c.isFormField){c.setValue(v);c.clearDirty()}else{if(c.renderer){v=c.renderer(v)}if(c.setText){c.setText(v)}else{if(c.getXType&&c.getXType()=="panel"){c.body.update(v)}}}}}if(callback){callback(win,r)}this.onView(win,r)},scope:this})},showViewWin:function(autoClose){if(!this.viewPanel){if(this.createViewPanel){this.viewPanel=this.createViewPanel()}else{if(this.fp){this.viewPanel=this.fp}else{this.viewPanel=this.createForm()}}}var win=this.getViewWin(autoClose);return win},doSearch:function(){var win=EasyJF.Ext.CrudSearchWindow;var o=win.getComponent(0).form.getValues(false);var service=win.crudService;service.store.baseParams=Ext.apply(o,{searchType:"advancedSearch",pageSize:service.store.baseParams.pageSize||service.pageSize});win.hide();if(service.searchField&&service.cleanQuickSearch){service.searchField.reset()}service.search()},advancedSearch:function(){return this.superSearchWin(this.searchWin.width,this.searchWin.height,this.searchWin.title)},superSearchWin:function(width,height,title){var isNew=!EasyJF.Ext.CrudSearchWindow;if(!this.searchPanel){if(this.searchFP||this.searchFormPanel){this.searchPanel=this.searchFP?this.searchFP():this.searchFormPanel()}}if(!this.searchPanel){return null}var win=this.createGlobalWin("CrudSearchWindow",width,height,title,this.searchPanel,null,"searchPanel",[{id:"tb_search",text:"查询",handler:this.doSearch,iconCls:"search",scope:this},{text:"重置",iconCls:"clean",handler:function(){EasyJF.Ext.CrudSearchWindow.getComponent(0).form.reset()}},{text:"关闭",iconCls:"delete",handler:function(){EasyJF.Ext.CrudSearchWindow.hide()}}]);if(isNew){}return win},toggleDetails:function(obj){var view=this.grid.getView();if(view.showPreview){view.showPreview=false}else{view.showPreview=true}view.refresh()},swapSequence:function(down,inform){return function(){var record=this.grid.getSelectionModel().getSelected();if(!record){this.alert("请先选择要操作的数据！","提示");return}var id=record.get("id");Ext.Ajax.request({url:this.formatUrl("swapSequence"),params:{id:record.get("id"),down:down?down:"",parentId:this.parentId,sq:this.grid.store.find("id",id)+1},method:"POST",success:function(response){var r=Ext.decode(response.responseText);if(!r.success){this.alert("操作失败，失败原因：<br/>"+(r.errors.msg?r.errors.msg:"未知"),"提示信息")}else{if(inform){Ext.Msg.alert("提示","操作成功",function(){this.store.reload();this.focus()},this)}else{this.store.reload()}}},scope:this})}},insertGridButton:function(){this.gridButtons.splice(10,0,arguments)},showContextMenu:function(g,i,e){if(this.menu){var evn=e?e:g;evn.preventDefault();if(i>=0){this.grid.getSelectionModel().selectRow(i,false)}this.menu.showAt(evn.getPoint())}},doOperate:function(grid,rowIndex,columnIndex,e){var tag=e.getTarget("A",3);if(tag){var id=tag.getAttribute("theid");var cmd=tag.getAttribute("op");var cf=tag.getAttribute("cf");if(id&&cmd){this.operate(cmd,id,cf,grid,rowIndex,columnIndex,e)}}},operate:function(cmd,id,cf,grid,rowIndex,columnIndex,e){if(cmd=="edit"){this.edit()}else{if(cmd=="view"){this.view()}else{if(cmd=="remove"){this.removeData()}else{if(!cf){this.executeUrl(this.baseUrl,{cmd:cmd,id:id},this.refresh.createDelegate(this))()}else{Ext.Msg.confirm("提示","确认要执行该操作吗?",function(btn){if(btn=="yes"){this.executeUrl(this.baseUrl,{cmd:cmd,id:id},this.refresh.createDelegate(this))()}else{this.focus()}},this)}}}}},findOperatorBy:function(callback){var objs=[];this.operators.each(function(o){if(typeof o!="string"){if(callback&&callback(o)){objs.push(o)}}});return objs},findOperatorByProperty:function(name,value){return this.findOperatorBy(function(o){if(o[name]==value){return true}})},toggleSingleRowOperator:function(enable){var ids=this.findOperatorByProperty("singleRow",true);var args=[];if(ids&&ids.length){for(var i=0;i<ids.length;i++){args.push(ids[i].name||ids[i].id)}}if(enable){this.enableOperaterItem(args)}else{this.disableOperaterItem(args)}},toggleAllOperator:function(enable){var args=[];this.operators.each(function(o){if(typeof o!="string"){args.push(o.name||o.id)}});if(enable){this.enableOperaterItem(args)}else{this.disableOperaterItem(args)}},onRowSelection:function(record,index,sel){var sel=this.grid.getSelections();var ids=this.findOperatorByProperty("batch",true);var selected=true;if(sel.length==1){this.toggleSingleRowOperator(true)}else{if(sel.length>1){this.toggleSingleRowOperator(false)}else{selected=false;this.toggleSingleRowOperator(false)}}var args=[];if(ids&&ids.length){Ext.each(ids,function(obj){args.push(obj.name||obj.id)})}this[(selected?"enable":"disable")+"OperaterItem"](args)},changeOperaterItem:function(args,callback){if(args.length==1&&Ext.isArray(args[0])){args=args[0]}if(this.grid.getTopToolbar()&&this.grid.getTopToolbar().items){for(var i=0;i<args.length;i++){if(this.menu&&this.menu.items){var o=this.menu.items.find(function(c){var n1=c.name||c.id;if(n1==args[i]){return true}});if(o){callback(o)}}o=this.grid.getTopToolbar().items.find(function(c){var n1=c.name||c.id;if(n1==args[i]){return true}});if(o){callback(o)}}}else{this.grid.on("render",function(){for(var i=0;i<args.length;i++){var o=this.grid.getTopToolbar().items.find(function(c){var n1=c.name||c.id;if(n1==args[i]){return true}});if(o){callback(o)}}},this)}},enableOperaterItem:function(){var args=arguments;this.changeOperaterItem(args,function(o){if(o.enable){o.enable()}})},disableOperaterItem:function(){var args=arguments;this.changeOperaterItem(args,function(o){if(o.disable){o.disable()}})},showOperaterItem:function(){var args=arguments;this.changeOperaterItem(args,function(o){if(o.show){o.show()}})},hideOperaterItem:function(){var args=arguments;this.changeOperaterItem(args,function(o){if(o.hide){o.hide()}})},operatorConfig2Component:function(o,isMenu){var co=Ext.apply({},o);if(!co.handler){if(co.method&&this[co.method]){co.handler=this[co.method]}else{if(co.cmd){co.handler=co.batch?this.executeMulitCmd(co.cmd):this.executeCmd(co.cmd)}}}if(co.handler&&!co.scope){co.scope=this}if(!isMenu){if(this.operatorButtonStyle==2){if(co.icon){co.cls="x-btn-icon";co.text=""}}else{if(this.operatorButtonStyle==3){co.icon="";co.cls=""}}}var key=co.name||co.id;if(key=="searchField"){co.store=this.store}else{if(key=="btn_advancedSearch"){co.hidden=!((this.searchFormPanel||this.searchFP)&&this.allowSearch)}else{if(key=="btn_remove"){o.batch=this.batchRemoveMode}}}return co},buildCrudOperator:function(){if(!this.operators){this.initOperator()}var bs=[];this.operators.each(function(c){if(typeof c=="string"){bs.push(c)}else{if(!c.showInMenuOnly){var co=this.operatorConfig2Component(c);var key=co.name||co.id;try{if(Ext.isString(co.type)){this[key]=Ext.create(co,co.type)}else{this[key]=new Ext.Toolbar.Button(co)}bs.push(this[key])}catch(e){alert(key+":"+e)}}}},this);if(!this.menu){var ms=[];this.operators.each(function(c){if(typeof c=="string"){if(c=="-"){ms.push(c)}}else{if(!c.showInToolbarOnly){var co=this.operatorConfig2Component(c,true);if(!co.type){ms.push(co)}}}},this);ms.push({name:"btn_help",text:"帮助",handler:this.help,scope:this});this.menu=new Ext.menu.Menu({items:ms})}return bs},initOperator:function(){this.initDisableOperators();this.operators=new Ext.util.MixedCollection();for(var i=0;i<this.crud_operators.length;i++){var co=this.crud_operators[i];if(typeof co=="object"){co=Ext.apply({},co);if(!co.batch&&!co.noneSelectRow){co.singleRow=true}}var key=co.name||co.id;if(key&&this.disable_operators.indexOf(key)>=0){continue}this.operators.add(co)}if(this.customizeQueryObject){this.operators.add({showInToolbarOnly:true,name:"btn_customizeQuery",cls:"x-btn-icon",icon:"images/icon-png/srsearch.gif",tooltip:"自定义查询",text:"",menu:["-",{text:"保存当前查询条件",handler:this.createQueryObject,scope:this},{text:"管理自定义查询",handler:this.manageQueryObject,scope:this}]})}if(this.gridButtons){var bi=(this.disable_operators.indexOf("searchField")>=0?this.operators.getCount()-1:this.operators.getCount()-2);this.insertOperator(bi,this.gridButtons)}},insertOperator:function(index,items){if(!this.operators){this.initOperator()}if(!Ext.isArray(items)){items=[items]}if(this.operators.getCount()<index){index=this.operators.getCount()}var haveRender=this.grid&&this.grid.getTopToolbar&&this.grid.getTopToolbar()&&this.grid.getTopToolbar().items;for(var i=0;i<items.length;i++){var co=items[i];if(typeof co=="object"){co=Ext.apply({},co);if(!co.batch&&!co.noneSelectRow){co.singleRow=true}}this.operators.insert(index+i,co);if(haveRender){if(!co.showInMenuOnly){var bo=this.operatorConfig2Component(Ext.apply({},co));this.grid.getTopToolbar().insert(index+i,bo)}if(!co.showInToolbarOnly){var mo=this.operatorConfig2Component(co,true);if(this.menu){this.menu.insert(index+i,new Ext.menu.Item(mo))}}}}},initDisableOperators:function(){if(!this.disable_operators){this.disable_operators=[]}if(!this.exportData){this.disable_operators.push("btn_export")}if(!this.importData){this.disable_operators.push("btn_import")}if(!this.printData){this.disable_operators.push("btn_print")}if(!this.clearData){this.disable_operators.push("btn_clearSearch")}if(!this.allowSearch){this.disable_operators.push("btn_advancedSearch")}if(!this.showAdd){this.disable_operators.push("btn_add")}if(!this.showEdit){this.disable_operators.push("btn_edit")}if(!this.showRemove){this.disable_operators.push("btn_remove")}if(!this.showView){this.disable_operators.push("btn_view")}if(!this.showRefresh){this.disable_operators.push("btn_refresh")}if(!this.showSearchField){this.disable_operators.push("searchField")}},manageQueryObject:function(){var win=new UserQueryObjectWin({crudService:this,objName:this.queryObjectName});win.show()},createQueryObject:function(){if(!this.searchQueryObjectPanel){if(this.searchFP||this.searchFormPanel){this.searchQueryObjectPanel=this.searchFP?this.searchFP():this.searchFormPanel();this.searchQueryObjectPanel.insert(0,{fieldLabel:"查询器名称",xtype:"textfield",name:"queryObjectName",anchor:"-20",allowBlank:false});this.searchQueryObjectPanel.insert(1,{fieldLabel:"关键字",xtype:"textfield",name:"searchKey",anchor:"-20"})}}if(!this.searchQueryObjectPanel){return null}var win=this.createGlobalWin("CrudQueryObjectWindow",this.searchWin.width,this.searchWin.height+60,"保存查询条件",this.searchQueryObjectPanel,null,"searchQueryObjectPanel",[{id:"tb_search",text:"保存",handler:this.saveQueryObject,iconCls:"search"},{text:"取消",iconCls:"delete",handler:function(){EasyJF.Ext.CrudQueryObjectWindow.hide()}}]);win.getComponent(0).form.setValues(this.store.baseParams||{});win.getComponent(0).form.findField("queryObjectName").setValue("")},saveQueryObject:function(){var win=EasyJF.Ext.CrudQueryObjectWindow;if(!win.getComponent(0).form.isValid()){Ext.Msg.alert("提示","必填项必须填写!");return}var o=win.getComponent(0).form.getValues(false);var title=o.queryObjectName;delete o.queryObjectName;var service=win.crudService;var params={title:title,content:Ext.urlEncode(o),objName:service.queryObjectName};Ext.Ajax.request({url:"userQueryObject.ejf?cmd=save",params:params,success:function(response){var ret=Ext.decode(response.responseText);if(ret.success){this.addQueryObjectOperator([params]);Ext.Msg.alert("提示","操作成功!",this.focus,this);win.hide()}else{Ext.Msg.alert("无法保存",ret.errors.msg,function(){win.getComponent(0).form.findField("searchKey").focus()})}},scope:service})},searchByQueryObject:function(c){if(c.content){var params=Ext.urlDecode(c.content);if(this.searchField){this.searchField.setValue(params.searchField||"")}this.store.baseParams=params;if(this.store.lastOptions&&this.store.lastOptions.params){this.store.lastOptions.params.start=0}}this.refresh()},addQueryObjectOperator:function(objs){if(objs&&objs.length){var o=this.operators.find(function(c){var n1=c.name||c.id;if(n1=="btn_customizeQuery"){return true}});if(!o){return}var haveRender=this.grid&&this.grid.getTopToolbar&&this.grid.getTopToolbar()&&this.grid.getTopToolbar().items;var btn_customizeQuery=this["btn_customizeQuery"];for(var i=0;i<objs.length;i++){var co=objs[i];co.scope=this;co.text=co.title;co.name="query_menu"+co.title;co.handler=this.searchByQueryObject;o.menu.splice(0,0,co);if(btn_customizeQuery){btn_customizeQuery.menu.insert(0,new Ext.menu.Item(co))}}}},removeQueryObjectOperator:function(name){var btn_customizeQuery=this["btn_customizeQuery"];if(btn_customizeQuery){var item=btn_customizeQuery.menu.items.find(function(c){var n1=c.name||c.id;if(n1=="query_menu"+name){return true}});if(item){btn_customizeQuery.menu.remove(item)}}},useOperatorsPermission:function(args){var ret=args||this.permissions;var args=[];for(var i=0;i<ret.length;i++){args.push(ret[i]);var o=this.operators.find(function(c){var n1=c.name||c.id;if(n1==args[i]){return true}});if(o){o.hidden=false}}this.showOperaterItem(args);this.fireEvent("usepermission",this)},loadOperatorsPermission:function(){var args={},names=[],actions=[],cmds=[];var baseUrl=this.baseUrl;this.operators.each(function(o){if(typeof o!="string"){if(!o.clientOperator&&(o.cmd||o.method)){actions.push(o.action||baseUrl);cmds.push(o.cmd||o.method||"");names.push(o.name||o.id||"")}}});if(!this.permissions){var objs={names:names,actions:actions,cmds:cmds};if(this.customizeQueryObject&&this.queryObjectName){objs.queryObjectName=this.queryObjectName}if(Lanyo_Ajax.permissionCheck){Ext.Ajax.request({url:(Lanyo_Ajax.permissionCheckAction||"permissionCheck.ejf"),params:objs,callback:function(options,success,response){var ret=Ext.decode(response.responseText);if(ret&&ret.permissions&&ret.permissions.length){this.permissions=ret.permissions;this.useOperatorsPermission()}if(ret&&ret.queryObjects){this.addQueryObjectOperator(ret.queryObjects)}},scope:this})}else{this.permissions=["btn_add","btn_edit","btn_view","btn_remove","btn_refresh"];this.useOperatorsPermission()}}else{this.useOperatorsPermission()}},checkAdnLoadColumnField:function(){if(!this.storeMapping){var url=this.baseUrl+"?cmd=loadColumnField";if(this.entityClzName){url="extApp.ejf?cmd=loadColumnField&entityClzName="+this.entityClzName}var ajax=Ext.lib.Ajax.syncRequest("POST",url,"");var ret=Ext.decode(ajax.conn.responseText);if(ret&&ret.fields){this.storeMapping=ret.fields;if(ret.columnMap&&!this.columns&&!this.cm){this.columns=[];for(var index in ret.columnMap){var c=ret.columnMap[index];c.dataIndex=c.name;if(!c.header){c.header=c.name}var d=[];if(this.autoDisplayFields&&this.autoDisplayFields.indexOf(c.name)<0){c.hidden=true}if(this.autoHideFields&&this.autoHideFields.indexOf(c.name)>=0){c.hidden=true}if(this.disableHideableFields&&this.disableHideableFields.indexOf(c.name)>=0){c.hideable=false}if(c.sortable===undefined){if(c.type!="object"){c.sortable=true}}if(!c.renderer){if(c.type=="date"){c.renderer=this.dateRender("Y-m-d")}else{if(c.type=="object"||c.type=="map"){c.renderer=this.objectAutoRender}}}else{try{c.renderer=Ext.decode(c.renderer)}catch(e){}}this.columns.push(c)}}}}},haveOperatorRights:function(btn){return this[btn]&&(!(this[btn].disabled||this[btn].hidden))},handleCrudKey:function(e){if(!(e.isSpecialKey()||e.altKey||e.getKey()==e.DELETE)){return}if(e.getKey()==Ext.EventObject.ENTER&&!e.ctrlKey){e.stopEvent();this.edit()}else{if(e.altKey&&e.getKey()=="c".charCodeAt(0)&&this.haveOperatorRights("btn_edit")&&this.copy){e.stopEvent();this.copy()}else{if(e.altKey&&e.getKey()=="a".charCodeAt(0)&&this.haveOperatorRights("btn_add")){e.stopEvent();this.create()}else{if(e.altKey&&e.getKey()=="e".charCodeAt(0)&&this.haveOperatorRights("btn_edit")){e.stopEvent();this.edit()}else{if(e.altKey&&e.getKey()=="v".charCodeAt(0)&&this.haveOperatorRights("btn_view")){e.stopEvent();this.view()}else{if((e.getKey()==e.DELETE||(e.altKey&&e.getKey()=="d".charCodeAt(0)))&&this.haveOperatorRights("btn_remove")){e.stopEvent();this.removeData()}else{if(e.altKey&&e.getKey()=="s".charCodeAt(0)){e.stopEvent();this.advancedSearch()}else{if((e.getKey()==e.PRINT_SCREEN||(e.altKey&&e.getKey()=="p".charCodeAt(0)))&&this.haveOperatorRights("btn_print")){e.stopEvent();this.printRecord()}else{if(e.altKey&&e.getKey()=="o".charCodeAt(0)&&this.haveOperatorRights("btn_export")){e.stopEvent();this.exportExcel()}else{if(e.altKey&&e.getKey()=="i".charCodeAt(0)&&this.haveOperatorRights("btn_import")){e.stopEvent();this.importExcel()}}}}}}}}}}},initCrudEventHandler:function(){this.grid.on("celldblclick",this.edit,this);this.grid.on("cellclick",this.doOperate,this);this.grid.on("keypress",this.handleCrudKey,this);var rowSelFn=function(g,index,r){this.onRowSelection(r,index,g)};this.grid.getSelectionModel().on({scope:this,rowselect:rowSelFn,rowdeselect:rowSelFn});if(this.showMenu){this.grid.on("rowcontextmenu",this.showContextMenu,this)}EasyJF.Ext.Util.autoFocusFirstRow(this.grid)},focus:function(){this.focusCrudGrid()},focusCrudGrid:function(grid){var g=grid||this.grid;if(g&&g.rendered){var sel=g.getSelectionModel();if(sel&&sel.hasSelection()){g.getView().focusRow(g.store.indexOf(g.getSelectionModel().getSelected()))}else{if(g.store.getCount()){g.getView().focusRow(0)}else{g.focus()}}}},help:function(){Ext.Msg.show({title:"系统帮助",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,msg:"欢迎使用本系统!"})}};EasyJF.Ext.CrudPanel=Ext.extend(Ext.Panel,{border:false,layout:"fit",closable:true,autoScroll:true,gridForceFit:true,importExplain:"",viewWin:{width:650,height:410,title:"详情查看"},searchWin:{width:630,height:300,title:"高级查询"},gridViewConfig:{},gridConfig:{},baseQueryParameter:{},localStoreVar:window.undefined,bulidGridStore:function(){var storeConfig={id:this.storeId?this.storeId:"id",url:this.defaultCmd?(this.formatUrl("list")):this.baseUrl,root:"result",autoDestroy:true,totalProperty:"rowCount",pageSize:this.pageSize,remoteSort:true,fields:this.storeMapping};if(Ext.isEmpty(this.localStoreVar,false)){this.store=new Ext.data.JsonStore(storeConfig)}else{this.store=new EasyJF.Ext.CachedRemoteStore(Ext.apply({varName:this.localStoreVar,pageSize:Ext.num(this.pageSize,20)},storeConfig))}this.store.baseParams=Ext.apply({},{limit:this.pageSize||""},this.initQueryParameter||{});if(Ext.objPcount(this.baseQueryParameter)){this.store.on("beforeload",function(store,options){Ext.apply(store.baseParams,this.baseQueryParameter)},this)}this.store.paramNames.sort="orderBy";this.store.paramNames.dir="orderType";return this.store},initComponent:function(){this.checkAdnLoadColumnField();this.store=this.bulidGridStore();this.addEvents("saveobject","removeobject");EasyJF.Ext.CrudPanel.superclass.initComponent.call(this);var buttons=this.buildCrudOperator();var viewConfig=Ext.apply({forceFit:this.gridForceFit},this.gridViewConfig);var gridConfig=Ext.apply(this.gridConfig,{store:this.store,stripeRows:true,trackMouseOver:false,loadMask:true,viewConfig:viewConfig,tbar:buttons,border:false,bbar:this.gridBbar||(this.pagingToolbar?new Ext.ux.PagingComBo({rowComboSelect:true,pageSize:this.pageSize,store:this.store,displayInfo:true}):null)});if(this.summaryGrid){if(gridConfig.plugins){if(typeof gridConfig.plugins=="object"){gridConfig.plugins=[gridConfig.plugins]}}else{gridConfig.plugins=[]}gridConfig.plugins[gridConfig.plugins.length]=new Ext.ux.grid.GridSummary()}var columns=this.columns,cfg={};columns=columns||this.cm.config;delete gridConfig.cm;columns=[].concat(columns);if(this.gridRowNumberer){columns.unshift(new Ext.grid.RowNumberer({header:"序号",width:36}))}if((!gridConfig.sm&&!gridConfig.selModel)&&this.gridSelModel=="checkbox"){cfg.sm=new Ext.grid.CheckboxSelectionModel();if(columns[0] instanceof Ext.grid.RowNumberer){columns.splice(1,0,cfg.sm)}else{columns.unshift(cfg.sm)}}cfg.columns=columns;gridConfig=Ext.applyIf(cfg,gridConfig);if(this.columnLock&&Ext.grid.LockingGridPanel){this.grid=new Ext.grid.LockingGridPanel(gridConfig)}else{this.grid=new Ext.grid.GridPanel(gridConfig)}this.loadOperatorsPermission();this.initCrudEventHandler();this.add(this.grid);if(this.autoLoadGridData){this.store.load()}}});Ext.applyIf(EasyJF.Ext.CrudPanel.prototype,EasyJF.Ext.CrudFunction);ExtAppBasePanel=Ext.extend(Ext.Panel,{appClass:"",script:"",otherScripts:"",border:false,layout:"fit",closable:true,initComponent:function(){ExtAppBasePanel.superclass.initComponent.call(this);this.on("resize",function(c){if(!c.framePanel){var h="<iframe width='100%' height='"+c.body.getHeight(true)+"px' frameborder='0' scrolling='auto' src='extApp.ejf?appClass="+this.appClass+"&script="+this.script+"&otherScripts="+this.otherScripts+"&params="+this.params+"'></iframe>";c.body.update(h);c.framePanel=c.body.dom.firstChild}else{c.framePanel.height=c.body.getHeight(true)}},this)}});EasyJF.Ext.TreeComboField=Ext.extend(Ext.form.TriggerField,{valueField:"id",displayField:"name",minListWidth:70,haveShow:false,editable:false,returnObject:false,leafOnly:false,clicksFinishEdit:1,readOnly:false,hiddenNodes:[],initEvents:function(){EasyJF.Ext.TreeComboField.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{up:function(e){this.inKeyMode=true;this.selectPrevious()},down:function(e){if(!this.isExpanded()){this.onTriggerClick()}else{this.inKeyMode=true;this.selectNext()}},enter:function(e){var sm=this.tree.getSelectionModel();if(sm.getSelectedNode()){var node=sm.getSelectedNode();this.choice(node);sm.clearSelections();return}},esc:function(e){this.collapse()},scope:this});this.queryDelay=Math.max(this.queryDelay||10,this.mode=="local"?10:250);this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);if(this.typeAhead){this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this)}if(this.editable!==false){this.el.on("keyup",this.onKeyUp,this)}if(this.forceSelection){this.on("blur",this.doForce,this)}},selectPrevious:function(){var sm=this.tree.getSelectionModel();if(!sm.selectPrevious()){var root=this.tree.getRootNode();sm.select(root);this.el.focus()}else{this.el.focus()}},selectNext:function(){var sm=this.tree.getSelectionModel();if(!sm.selectNext()){var root=this.tree.getRootNode();sm.select(root);this.el.focus()}else{this.el.focus()}},onTriggerClick:function(){if(this.readOnly||this.disabled){return false}else{if(!this.tree.rendered||!this.list){this.treeId=Ext.id();this.list=new Ext.Layer({id:this.treeId,cls:"x-combo-list",constrain:false});if(!this.innerDom){this.innerDom=Ext.getBody().dom}if(this.tree.rendered){this.list.appendChild(this.tree.el)}else{this.tree.render(this.treeId);var lw=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.tree.setWidth(lw);this.tree.on("expandnode",this.restrictHeight,this);this.tree.on("collapsenode",this.restrictHeight,this)}}else{this.restrictHeight()}}this.expand()},restrictHeight:function(){if(!this.list){return}var inner=this.innerDom;var h=inner.clientHeight-this.wrap.getBottom();if(this.tree.el.dom.offsetHeight>=h){this.tree.setHeight(h)}else{this.tree.setHeight("auto")}},filterTree:function(e){if(!this.isExpanded()){this.expand()}var text=e.target.value;Ext.each(this.hiddenNodes,function(n){n.ui.show()});if(!text){this.filter.clear();return}this.tree.expandAll();this.restrictHeight();this.filter.filterBy(function(n){return(!n.attributes.leaf||n.text.indexOf(text)>=0)});this.hiddenNodes=[];this.tree.root.cascade(function(n){if(!n.attributes.leaf&&n.ui.ctNode.offsetHeight<3){n.ui.hide();this.hiddenNodes.push(n)}},this)},expand:function(){if(this.list){Ext.getDoc().on("mousedown",this.hideIf,this);this.list.show();this.list.alignTo(this.getEl(),"tl-bl?")}else{this.onTriggerClick()}},collapse:function(){if(this.list){this.list.hide();Ext.getDoc().un("mousedown",this.hideIf,this)}},onEnable:function(){EasyJF.Ext.TreeComboField.superclass.onEnable.apply(this,arguments);if(this.hiddenField){this.hiddenField.disabled=false}},onDisable:function(){EasyJF.Ext.TreeComboField.superclass.onDisable.apply(this,arguments);if(this.hiddenField){this.hiddenField.disabled=true}Ext.getDoc().un("mousedown",this.hideIf,this)},hideIf:function(e){if(!e.within(this.wrap)&&!e.within(this.list)){this.collapse()}},initComponent:function(){EasyJF.Ext.TreeComboField.superclass.initComponent.call(this);this.addEvents("beforeSetValue");this.filter=new Ext.tree.TreeFilter(this.tree,{clearBlank:true,autoClear:true})},onRender:function(ct,position){EasyJF.Ext.TreeComboField.superclass.onRender.call(this,ct,position);if(this.clicksFinishEdit>1){this.tree.on("dblclick",this.choice,this)}else{this.tree.on("click",this.choice,this)}if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.hiddenName,id:(this.hiddenId||this.hiddenName)},"before",true);this.hiddenField.value=this.hiddenValue!==undefined?this.hiddenValue:this.value!==undefined?this.value:"";this.el.dom.removeAttribute("name")}if(!this.editable){this.editable=true;this.setEditable(false)}else{this.el.on("keydown",this.filterTree,this,{buffer:350})}},getValue:function(returnObject){if((returnObject===true)||this.returnObject){return typeof this.value!="undefined"?{value:this.value,text:this.text,toString:function(){return this.text}}:""}return typeof this.value!="undefined"?this.value:""},clearValue:function(){if(this.hiddenField){this.hiddenField.value=""}this.setRawValue("");this.lastSelectionText="";this.applyEmptyText();this.value=""},validate:function(){if(this.disabled||this.validateValue(this.processValue(this.getValue()))){this.clearInvalid();return true}return false},isValid:function(preventMark){if(this.disabled){return true}var restore=this.preventMark;this.preventMark=preventMark===true;var v=this.validateValue(this.processValue(this.getValue()));this.preventMark=restore;return v},validateValue:function(value){if(value.length<1||value===null){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(value.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(value.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}if(this.vtype){var vt=Ext.form.VTypes;if(!vt[this.vtype](value,this)){this.markInvalid(this.vtypeText||vt[this.vtype+"Text"]);return false}}if(typeof this.validator=="function"){var msg=this.validator(value);if(msg!==true){this.markInvalid(msg);return false}}if(this.regex&&!this.regex.test(value)){this.markInvalid(this.regexText);return false}return true},readPropertyValue:function(obj,p){var v=null;for(var o in obj){if(o==p){return true}}return v},setValue:function(obj){if(!obj){this.clearValue();return}if(this.fireEvent("beforeSetValue",this,obj)===false){return}var v=obj;var text=v;var value=this.valueField||this.displayField;if(typeof v=="object"&&this.readPropertyValue(obj,value)){text=obj[this.displayField||this.valueField];v=obj[value]}var node=this.tree.getNodeById(v);if(node){text=node.text}else{if(this.valueNotFoundText!==undefined){text=this.valueNotFoundText}}this.lastSelectionText=text;if(this.hiddenField){this.hiddenField.value=v}EasyJF.Ext.TreeComboField.superclass.setValue.call(this,text);this.value=v;this.text=text},setEditable:function(value){if(value==this.editable){return}this.editable=value;if(!value){this.el.dom.setAttribute("readOnly",true);this.el.on("mousedown",this.onTriggerClick,this);this.el.addClass("x-combo-noedit")}else{this.el.dom.setAttribute("readOnly",false);this.el.un("mousedown",this.onTriggerClick,this);this.el.removeClass("x-combo-noedit")}},choice:function(node,eventObject){if((!this.leafOnly||node.isLeaf())){if(node.id!="root"){this.setValue(node.id)}else{this.clearValue();this.el.dom.value=node.text}this.fireEvent("select",this,node);this.collapse();this.fireEvent("collapse",this)}else{if(node.id=="root"){this.clearValue();this.el.dom.value=node.text;this.fireEvent("select",this,node);this.collapse();this.fireEvent("collapse",this)}}},validateBlur:function(){return !this.list||!this.list.isVisible()},isExpanded:function(){return this.list&&this.list.isVisible()},canFocus:function(){return !this.disabled},onDestroy:function(){if(this.tree.rendered&&this.list){this.list.hide();this.list.destroy();delete this.list}EasyJF.Ext.TreeComboField.superclass.onDestroy.call(this)}});Ext.reg("treecombo",EasyJF.Ext.TreeComboField);EasyJF.Ext.CheckTreeComboField=Ext.extend(EasyJF.Ext.TreeComboField,{leafOnly:false,editable:true,onTriggerClick:function(){if(this.disabled){return}if(!this.listPanel.rendered||!this.list){this.treeId=Ext.id();this.list=new Ext.Layer({id:this.treeId,cls:"x-combo-list",constrain:false});if(!this.innerDom){this.innerDom=Ext.getBody().dom}if(this.listPanel.rendered){this.list.appendChild(this.listPanel.el)}else{this.listPanel.render(this.treeId);var lw=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.listPanel.setWidth(lw);this.tree.on("expandnode",this.restrictHeight,this);this.tree.on("collapsenode",this.restrictHeight,this)}if(this.value){this.setCheckdNode(this.value)}}else{this.restrictHeight()}this.expand()},restrictHeight:function(){if(!this.list){return}var inner=this.innerDom;var h=inner.clientHeight-this.wrap.getBottom();if(this.listPanel.el.dom.offsetHeight>=h){this.listPanel.setHeight(h)}else{this.listPanel.setHeight("auto");this.tree.setHeight("auto")}},initComponent:function(){EasyJF.Ext.CheckTreeComboField.superclass.initComponent.call(this);this.listPanel=new Ext.Panel({border:false,bodyBorder:false,buttonAlign:"center",layout:"fit",items:this.tree,bbar:[{text:"确定选择",handler:this.choice,scope:this},{text:"清空",handler:this.cleanChoice,scope:this},{text:"取消",handler:this.cancelChoice,scope:this}]})},onRender:function(ct,position){EasyJF.Ext.CheckTreeComboField.superclass.onRender.call(this,ct,position);this.tree.on("checkchange",this.checkNode,this)},setCheckdNode:function(v){this.cleanCheckNode(this.tree.root);var vs=v.split(",");for(var i=0;i<vs.length;i++){var node=null;var valueField=this.valueField;this.tree.root.cascade(function(n){if(n.attributes[valueField]==vs[i]){node=n;return false}});if(node){this.checkNode(node,true)}}},cleanCheckNode:function(node){var checked=false;node.cascade(function(n){if(n.ui.checkbox){n.attributes.checked=n.ui.checkbox.checked=checked;n.attributes.selectAll=checked;if(checked){n.ui.addClass("x-tree-selected")}else{n.ui.removeClass("x-tree-selected")}}},this)},checkNode:function(node,checked){node.cascade(function(n){if(n.ui.checkbox){n.attributes.checked=n.ui.checkbox.checked=checked;n.attributes.selectAll=checked;if(checked){n.ui.addClass("x-tree-selected")}else{n.ui.removeClass("x-tree-selected")}}},this);node.bubble(function(n){if(n!=node){if(!checked){n.attributes.selectAll=checked;if(n.attributes.checked){n.ui.removeClass("x-tree-selected")}}else{if(!n.attributes.checked){n.attributes.checked=n.ui.checkbox.checked=checked}}}})},getValue:function(){return typeof this.value!="undefined"?this.value:""},clearValue:function(){if(this.hiddenField){this.hiddenField.value=""}this.setRawValue("");this.lastSelectionText="";this.applyEmptyText();if(this.list){this.cleanCheckNode(this.tree.root)}},getNodeValue:function(node){if(node.attributes.selectAll&&(!this.leafOnly||node.attributes.leaf)){if(this.t!=""){this.t+=","}if(this.v!=""){this.v+=","}var text=node.attributes[this.displayField||this.valueField];if(text===undefined){text=node.text}var value=node.attributes[this.valueField];if(value===undefined){value=node.id}this.t+=text;this.v+=value}else{if(node.attributes.checked){node.eachChild(this.getNodeValue,this)}}},setValue:function(obj){if(!obj){this.clearValue();return}var v=obj;var text=v;var value=this.valueField||this.displayField;if(typeof v=="object"&&this.readPropertyValue(obj,value)){text=obj[this.displayField||this.valueField];v=obj[value];if(this.list){this.setCheckdNode(v)}}else{var root=this.tree.root;this.t="";this.v="";if(root.attributes.selectAll){this.t=root.text}else{root.eachChild(this.getNodeValue,this)}text=this.t;v=this.v}this.lastSelectionText=text;if(this.hiddenField){this.hiddenField.value=v}EasyJF.Ext.TreeComboField.superclass.setValue.call(this,text);this.value=v;this.text=text},choice:function(notClean){if(notClean){this.setValue(true)}else{this.clearValue()}this.list.hide()},cleanChoice:function(){this.clearValue();this.list.hide()},cancelChoice:function(){this.list.hide()},onDestroy:function(){if(this.listPanel.rendered&&this.list){this.list.hide();this.list.remove()}EasyJF.Ext.CheckTreeComboField.superclass.onDestroy.call(this)}});Ext.reg("checktreecombo",EasyJF.Ext.CheckTreeComboField);EasyJF.Ext.SmartCombox=Ext.extend(Ext.form.ComboBox,{returnObject:false,objectCreator:null,createWinReady:function(win){if(this.fieldLabel){win.setTitle("新建"+this.fieldLabel)}},newObject:function(){this.collapse();var title=this.fieldLabel;EasyJF.Ext.Util.addObject(this.objectCreator.appClass,this.reload.createDelegate(this),this.objectCreator.script,this.objectCreator.otherScripts,this.createWinReady.createDelegate(this))},synchObject:function(){this.store.reload()},initComponent:function(){if(this.objectCreator&&!this.disableCreateObject){this.operatorButtons=[{text:"新建",iconCls:"add",handler:this.newObject,scope:this},{text:"同步",iconCls:"f5",handler:this.synchObject,scope:this}]}EasyJF.Ext.SmartCombox.superclass.initComponent.call(this)},initList:function(){if(!this.list){EasyJF.Ext.SmartCombox.superclass.initList.call(this);if(this.operatorButtons){if(this.pageTb){this.pageTb.insert(0,this.operatorButtons)}else{this.bottomBar=this.list.createChild({cls:"x-combo-list-ft"});this.bottomToolbar=new Ext.Toolbar(this.operatorButtons);this.bottomToolbar.render(this.bottomBar);this.assetHeight+=this.bottomBar.getHeight()}}}},getValueObject:function(field){var val="";if(this.returnObject){val=this.getValue().value}else{val=this.getValue()}if(val){var index=this.store.find(field||"id",val);if(index>=0){var record=this.store.getAt(index);return record}return null}return null},getValue:function(){if(this.returnObject){var value=this.value;if(this.el.dom.value==this.PleaseSelectedValue||this.el.dom.value==this.nullText){return null}if(this.selectedIndex>=0){var record=this.store.getAt(this.selectedIndex);if(record&&record.data){var t=record.data[this.displayField||this.valueField];if(t!=this.el.dom.value){value=null}}}return{value:value,text:this.el.dom.value,toString:function(){return this.text}}}else{return EasyJF.Ext.SmartCombox.superclass.getValue.call(this)}},setValue:function(v){if(v&&typeof v=="object"&&eval("v."+this.valueField)){var value=eval("v."+this.valueField);var text=eval("v."+this.displayField)?eval("v."+this.displayField):this.valueNotFoundText;this.lastSelectionText=text;if(this.hiddenField){this.hiddenField.value=value}Ext.form.ComboBox.superclass.setValue.call(this,text);this.value=value;if(this.store.find(this.valueField,value)<0){var o={};o[this.valueField]=value;o[this.displayField]=text;if(this.store&&this.store.insert){this.store.insert(0,new Ext.data.Record(o))}}}else{if(v===null){EasyJF.Ext.SmartCombox.superclass.setValue.call(this,"")}else{EasyJF.Ext.SmartCombox.superclass.setValue.call(this,v)}}},onSelect:function(record,index){if(this.fireEvent("beforeselect",this,record,index)!==false){this.setValue(record.data[this.valueField||this.displayField]);this.collapse();this.fireEvent("select",this,record,index)}}});Ext.reg("smartcombo",EasyJF.Ext.SmartCombox);EasyJF.Ext.PopupWindowField=Ext.extend(Ext.form.TriggerField,{win:null,valueField:"id",displayField:"name",haveShow:false,editable:false,callback:Ext.emptyFn,returnObject:false,choiceOnly:false,getValue:function(){if(this.choiceOnly){return this.value}if(this.returnObject){return typeof this.value!="undefined"?{value:this.value,text:this.text,toString:function(){return this.text?this.text:this.value}}:""}return typeof this.value!="undefined"?this.value:""},setValue:function(v){if(this.choiceOnly){return this.value=v}if(v&&typeof v=="object"&&eval("v."+this.valueField)){var value=eval("v."+this.valueField);var text=eval("v."+this.displayField)?eval("v."+this.displayField):this.valueNotFoundText;this.lastSelectionText=text;if(this.hiddenField){this.hiddenField.value=value}EasyJF.Ext.PopupWindowField.superclass.setValue.call(this,text);this.value=value;this.text=text}else{if(v===null){EasyJF.Ext.PopupWindowField.superclass.setValue.call(this,"")}else{EasyJF.Ext.PopupWindowField.superclass.setValue.call(this,v)}}},onTriggerClick:function(){if(this.win){this.win.show()}},onRender:function(ct,position){EasyJF.Ext.PopupWindowField.superclass.onRender.call(this,ct,position);if(this.win){this.win.on("select",this.choice,this)}if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.hiddenName,id:(this.hiddenId||this.hiddenName)},"before",true);this.hiddenField.value=this.hiddenValue!==undefined?this.hiddenValue:this.value!==undefined?this.value:"";this.el.dom.removeAttribute("name")}if(!this.editable){this.editable=true;this.setEditable(false)}if(this.choiceOnly){this.el.hide()}},choice:function(data,win){this.setValue(data);this.fireEvent("select",data,win)},initComponent:function(){EasyJF.Ext.PopupWindowField.superclass.initComponent.call(this);this.addEvents("select")},validateBlur:function(){return !this.win||!this.win.isVisible()},onDestroy:function(){if(this.win&&this.win.isVisible()){this.win.hide()}EasyJF.Ext.PopupWindowField.superclass.onDestroy.call(this)},setEditable:function(value){if(value==this.editable){return}this.editable=value;if(!value){this.el.dom.setAttribute("readOnly",true);this.el.on("dblclick",this.onTriggerClick,this);this.el.on("click",this.onTriggerClick,this);this.el.addClass("x-combo-noedit")}else{this.el.dom.setAttribute("readOnly",false);this.el.un("mousedown",this.onTriggerClick,this);this.el.removeClass("x-combo-noedit")}}});Ext.reg("popupwinfield",EasyJF.Ext.PopupWindowField);EasyJF.Ext.GridSelectWin=Ext.extend(Ext.Window,{title:"选择数据",width:540,height:400,layout:"fit",buttonAlign:"center",closeAction:"hide",grid:null,modal:true,callback:Ext.emptyFn,choice:function(){var grid=this.grid.grid||this.grid;var records=grid.getSelectionModel().getSelections();if(!records||records.length<1){Ext.Msg.alert("$!{lang.get('Prompt')}","$!{lang.get('Select first')}");return false}var datas=[];for(var i=0;i<records.length;i++){datas[i]=records[i].data}this.hide();this.fireEvent("select",datas,this)},initComponent:function(){this.buttons=[{text:"确定",handler:this.choice,scope:this},{text:"取消",handler:function(){this.hide()},scope:this}];EasyJF.Ext.GridSelectWin.superclass.initComponent.call(this);if(this.grid){var grid=this.grid.grid||this.grid;grid.on("rowdblclick",this.choice,this);this.add(this.grid)}this.addEvents("select")}});EasyJF.Ext.TreeNodeUtil={};Ext.apply(EasyJF.Ext.TreeNodeUtil,{cloneTreeNode:function(nodes){var ns=[];for(var i=0;i<nodes.length;i++){var o=Ext.apply({},nodes[i]);if(nodes[i].children&&nodes[i].children.length){o.children=this.cloneTreeNode(nodes[i].children)}else{o.children=[]}ns.push(o)}return ns},cascadeNode:function(node,fn,scope,args){if(fn.apply(scope||this,args||[node])!==false){if(node.children&&node.children.length){for(var i=0,cs=node.children;i<cs.length;i++){cs[i].parentNode=node;this.cascadeNode(cs[i],fn,scope,args)}}}},deepFindNode:function(id,node){var ret=null;this.cascadeNode(node,function(n){if(n.id==id){ret=n;return false}});return ret},getNodeById:function(id,objs){var ret=this.deepFindNode(id,{id:"root",children:objs});return ret||null},findNode:function(id,objs){if(id=="root"){return objs}else{var ret=this.deepFindNode(id,{id:"root",children:objs});return ret&&ret.children?ret.children:null}},localRemove:function(id,cache){var obj=Ext.type(cache)=="string"?EasyJF.Cache.get(cache):cache;if(obj){var objs=obj.items;var node=this.getNodeById(id,objs);if(node){if(node.parentNode&&node.parentNode.children){node.parentNode.children.remove(node)}else{objs.remove(node)}if(obj.fireEvent){obj.fireEvent("removenode",node,obj)}}}},localAdd:function(node,parentId,cache){var obj=Ext.type(cache)=="string"?EasyJF.Cache.get(cache):cache;if(obj){var objs=obj.items;if(parentId){var parentNode=this.getNodeById(parentId,objs);if(parentNode){parentNode.children=parentNode.children||[];if(parentNode.children&&parentNode.children.length==0){parentNode.leaf=false;parentNode.children=[node]}else{if(parentNode.children){parentNode.children.push(node)}}if(obj.fireEvent){obj.fireEvent("addnode",node,parentNode,obj)}}}else{objs.push(node);if(obj.fireEvent){obj.fireEvent("addnode",node,null,obj)}}}},localChange:function(node,cache){var obj=Ext.type(cache)=="string"?EasyJF.Cache.get(cache):cache;if(obj){var objs=obj.items;var no=this.getNodeById(node.id,objs);if(no){Ext.copyToIf(no,node,["children","cls","loader","parentNode"]);if(obj.fireEvent){obj.fireEvent("updatenode",no,obj)}}}},localMove:function(node,parentId,cache){this.localRemove(node.id,cache);this.localAdd(node,parentId,cache)}});EasyJF.Ext.TreeCollection=Ext.extend(Ext.util.MixedCollection,{removeNode:function(id){EasyJF.Ext.TreeNodeUtil.localRemove(id,this);this.unregisterNode(id)},addNode:function(node,parentId){var n=null;if(n=this.getNodeById(node.id)){EasyJF.Ext.TreeNodeUtil.localChange(node,this);return}EasyJF.Ext.TreeNodeUtil.localAdd(node,parentId,this);this.registerNode(node)},changeNode:function(node,cache){EasyJF.Ext.TreeNodeUtil.localChange(node,this)},moveNode:function(node,parentId,cache){EasyJF.Ext.TreeNodeUtil.localMove(node,parentId,this)},unregisterNode:function(id){delete this.nodeHash[id]},registerNode:function(node){if(node.id){this.nodeHash[node.id]=node}var children=node.children||(node.attributes&&node.attributes.children);if(children&&children.length){Ext.each(children,this.registerNode,this)}},getAllNode:function(){return this.nodeHash||{}},getNodeById:function(id){return this.nodeHash[id]},addAll:function(objs){EasyJF.Ext.TreeCollection.superclass.addAll.call(this,objs);this.nodeHash={};if(objs){var obj={id:"root",children:objs};this.registerNode(obj)}},clear:function(){this.nodeHash={};EasyJF.Ext.TreeCollection.superclass.clear.call(this)}});EasyJF.Ext.CachedRemoteProxy=function(c,store){this.enableCache=(c.enableCache==window.undefined?true:c.enableCache);this.store=store;EasyJF.Ext.CachedRemoteProxy.superclass.constructor.call(this,{url:c.url});Ext.apply(this,c)};EasyJF.Ext.CachedRemoteProxy.DATAS={};EasyJF.Ext.CacheFilter=new Ext.util.MixedCollection();EasyJF.Ext.CacheFilter.firstSearch=function(val,regexp){if(typeof regexp!="regexp"){regexp=new RegExp("^"+regexp)}return regexp.test(val)};Ext.extend(EasyJF.Ext.CachedRemoteProxy,Ext.data.HttpProxy,{quickSearch:function(params,datas){if(!datas.getCount()){return datas}var objs=datas;var o=datas.items[0];if(!this.disableClientFilter){for(var n in params){if(n&&o[n]!==undefined){objs=objs.filter(n,params[n])}}}objs=this.cacheFilter(params,objs);return objs},cacheFilter:function(params,objs){var filter=EasyJF.Ext.CacheFilter.key(this.varName);if(filter&&params){if(typeof filter=="function"){return filter.call(this,objs,params)}}return objs},getData:function(){return EasyJF.Ext.CachedRemoteProxy.DATAS[this.varName]},loadFromCache:function(params,reader,callback,scope,arg){var datas=this.quickSearch(params,this.getData());var o={rowCount:datas.getCount(),result:[]};var start=0,limit=-1;if(params.start){start=Ext.num(parseInt(params.start),0)}if(params.limit){limit=Ext.num(parseInt(params.limit),-1)}var max=datas.getCount();if(limit>0){max=start+limit}if(max>datas.getCount()){max=datas.getCount()}if(max<0){max=this.pageSize}o.result=datas.getRange(start,max-1);var result;try{result=reader.readRecords(o)}catch(e){this.fireEvent("loadexception",this,o,response,e);callback.call(scope,null,params,false);return}this.fireEvent("load",this,o,arg);callback.call(scope,result,arg,true)},request:function(action,rs,params,reader,callback,scope,options){params=params||{};if(this.fireEvent("beforeload",this,params)!==false){if(this.getData().getCount()){this.loadFromCache(params,reader,callback,scope,options)}else{EasyJF.Ext.CachedRemoteProxy.superclass.request.apply(this,arguments)}}},onRead:function(action,o,response){if(this.enableCache){try{var json=response.responseText;var obj=eval("("+json+")");if(obj&&(obj.enableCache===false||obj.enableCache===true)){this.enableCache=obj.enableCache}if(this.enableCache){this.getData().clear();this.getData().addAll(Ext.isArray(obj)?obj:obj.result);o.params.limit=this.pageSize?this.pageSize:10;this.loadFromCache(o.params,o.reader,o.request.callback,o.request.scope,o.request.arg)}else{var result;try{result=o.reader.read(response)}catch(e){this.fireEvent("loadexception",this,o,response,e);o.request.callback.call(o.request.scope,null,o.request.arg,false);return}this.fireEvent("load",this,o,o.request.arg);o.request.callback.call(o.request.scope,result,o.request.arg,true)}}catch(e){this.fireEvent("loadexception",this,o,response,e);o.request.callback.call(o.request.scope,null,o.request.arg,false);return}}else{var result;try{result=o.reader.read(response)}catch(e){this.fireEvent("loadexception",this,o,response,e);o.request.callback.call(o.request.scope,null,o.request.arg,false);return}this.fireEvent("load",this,o,o.request.arg);o.request.callback.call(o.request.scope,result,o.request.arg,true)}},add:function(key,obj){this.getData().add(key,obj)},remove:function(obj){this.getData().remove(obj)},removeKey:function(key){this.getData().removeKey(key)},addOrUpdate:function(id,obj){this.getData().replace(id,obj)},update:function(id,obj){this.getData().replace(id,obj)}});EasyJF.Ext.CachedRemoteStore=function(c){EasyJF.Ext.CachedRemoteStore.superclass.constructor.call(this,Ext.apply(c,{proxy:c.proxy||(!c.data?new EasyJF.Ext.CachedRemoteProxy(c):undefined),reader:new Ext.data.JsonReader(c,c.fields)}));if(!EasyJF.Ext.CachedRemoteProxy.DATAS[this.varName]){EasyJF.Ext.CachedRemoteProxy.DATAS[this.varName]=new Ext.util.MixedCollection(true)}};Ext.extend(EasyJF.Ext.CachedRemoteStore,Ext.data.Store,{refreshCache:function(){this.proxy.getData().clear();this.reload()},enableCache:function(b){this.proxy.enableCache=b===window.undefined?true:!!!b},isCache:function(){return this.proxy.enableCache},sortFn:function(a,b){if(!a||b||!a.toUpperCase||!b.toUpperCase){var v1=a,v2=b;return v1>v2?1:(v1<v2?-1:0)}var i=a.toUpperCase()==b.toUpperCase();if(!i){return a.toUpperCase()<b.toUpperCase()?-1:1}else{var ret=0;for(var i=0;i<a.length;i++){if(a[i]!==b[i]){return a[i]<b[i]?1:-1}}return ret}},sortData:function(f,direction){direction=direction||"ASC";var st=this.fields.get(f).sortType;var fn=this.sortFn;this.data.sort(direction,fn);if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(direction,fn)}},sort:function(fieldName,dir){if(this.isCache===false){EasyJF.Ext.CachedRemoteStore.superclass.sort.call(this,fieldName,dir);return}var f=this.fields.get(fieldName);if(!f){return false}if(!dir){if(this.sortInfo&&this.sortInfo.field==f.name){dir=(this.sortToggle[f.name]||"ASC").toggle("ASC","DESC")}else{dir=f.sortDir}}var st=(this.sortToggle)?this.sortToggle[f.name]:null;var si=(this.sortInfo)?this.sortInfo:null;this.sortToggle[f.name]=dir;this.sortInfo={field:f.name,direction:dir};if(!this.remoteSort){this.applySort();this.fireEvent("datachanged",this)}else{var direction=dir||"ASC";var st2=this.fields.get(f.name).sortType;var sortFn=this.sortFn;var fn=function(r1,r2){var v1=st2(r1[f.name]),v2=st2(r2[f.name]);return sortFn(v1,v2)};this.proxy.getData().sort(direction,fn);if(!this.load(this.lastOptions)){if(st){this.sortToggle[f.name]=st}if(si){this.sortInfo=si}}}}});EasyJF.Ext.CachedRemoteObject=function(varName,url,collectionType,shareCache){this.varName=varName;this.url=url;this.collectionType=collectionType;this.addEvents("load");if(shareCache){if(!EasyJF.Ext.CachedRemoteObject.shareCaches[varName]){EasyJF.Ext.CachedRemoteObject.shareCaches[varName]=eval("new "+(collectionType||"Ext.util.MixedCollection")+"()")}}EasyJF.Ext.CachedRemoteObject.superclass.constructor.call(this)};EasyJF.Cache=EasyJF.Ext.CachedRemoteObject.DATAS={};EasyJF.shareCaches=EasyJF.Ext.CachedRemoteObject.shareCaches={};Ext.extend(EasyJF.Ext.CachedRemoteObject,Ext.util.Observable,{varName:null,url:null,getData:function(){var obj=EasyJF.Ext.CachedRemoteObject.DATAS[this.varName];return obj},onload:function(callback){this.fireEvent("load",this,EasyJF.Ext.CachedRemoteObject.DATAS[this.varName]);if(callback){callback()}},clearData:function(){var obj=EasyJF.Ext.CachedRemoteObject.DATAS[this.varName];if(obj.clear){obj.clear()}else{obj=null}},load:function(callback,params){if(EasyJF.Ext.CachedRemoteObject.DATAS[this.varName]){this.onload.call(this,callback,params);return}if(this.varName&&this.url){EasyJF.Ext.Util.loadJSON2Collection("EasyJF.Ext.CachedRemoteObject.DATAS['"+this.varName+"']",this.url,this.onload.createDelegate(this,[callback]),EasyJF.shareCaches[this.varName],this.collectionType)}}});CachedRemoteObject=EasyJF.Ext.CachedRemoteObject;EasyJF.Ext.MemoryTreeLoader=function(config){EasyJF.Ext.MemoryTreeLoader.superclass.constructor.call(this,config);if(this.varName&&(this.dataUrl||this.url)){this.remoteObject=new EasyJF.Ext.CachedRemoteObject(this.varName,(this.url||this.dataUrl),"EasyJF.Ext.TreeCollection",true);if(!this.lazyLoad){this.remoteObject.load()}}this.shareCache=EasyJF.Ext.CachedRemoteObject.shareCaches[this.varName]};Ext.extend(EasyJF.Ext.MemoryTreeLoader,Ext.tree.TreeLoader,{varName:null,remoteObject:null,dataProxy:false,autoLeaf:true,remoteDataProxy:null,transferNode:window.undefined,cascadeNode:function(node,fn,scope,args){if(fn.apply(scope||this,args||[node])!==false){if(node.children&&node.children.length){for(var i=0,cs=node.children;i<cs.length;i++){this.cascadeNode(cs[i],fn,scope,args)}}}},deepFindNode:function(id,node){var ret=null;this.cascadeNode(node,function(n){if(n.id==id){ret=n;return false}});return ret},findNode:function(id,objs){if(id=="root"){return Ext.isArray(objs)?objs:objs.items}else{var ret=this.deepFindNode(id,{id:"root",children:(Ext.isArray(objs)?objs:objs.items)});return ret&&ret.children?ret.children:null}},load:function(node,callback){if(this.clearOnLoad){while(node.firstChild){node.removeChild(node.firstChild)}}var objs=this.remoteObject.getData();if(objs&&objs.length){node.attributes.children=this.findNode(node.id,objs)}if(this.doPreload(node)){if(typeof callback=="function"){callback()}}else{if(this.dataUrl||this.url){this.requestData(node,callback)}}},doPreload:function(node){if(node.attributes.children&&node.attributes.children.length){if(node.childNodes.length<1){var cs=node.attributes.children;node.beginUpdate();for(var i=0,len=cs.length;i<len;i++){var o=Ext.apply({},cs[i]);var cn=this.createNode(o);if(cn===false){continue}var cn=node.appendChild(this.createNode(o));if(this.preloadChildren){this.doPreload(cn)}}node.endUpdate()}return true}else{return false}},createNode:function(attr){attr=Ext.apply({},attr);if(this.baseAttrs){Ext.applyIf(attr,this.baseAttrs)}if(this.transferNode!=window.undefined){if(typeof this.transferNode=="function"){attr=this.transferNode(attr)}else{if(typeof this.transferNode=="object"){for(var o in this.transferNode){if(this.transferNode.hasOwnProperty(o)&&Ext.isEmpty(attr[o])){attr[o]=attr[this.transferNode[o]]}}}}}if(this.autoLeaf===true){if(!attr.children||!attr.children.length){attr.leaf=true}}return EasyJF.Ext.MemoryTreeLoader.superclass.createNode.call(this,attr)},processResponse:function(response,parentNode,callback){var json=response.responseText;try{var o=eval("("+json+")");var collection=EasyJF.Ext.CachedRemoteObject.shareCaches[this.varName];collection.clear();collection.addAll(o);EasyJF.Ext.CachedRemoteObject.DATAS[this.varName]=collection;o=collection.items;parentNode.beginUpdate();collection.each(function(node){var n=this.createNode(node);if(n){parentNode.appendChild(n)}},this);parentNode.endUpdate();if(typeof callback=="function"){callback(this,parentNode)}}catch(e){this.handleFailure(response)}}});Ext.ns("EasyJF.Ext.Tree");BaseGridList=Ext.extend(Ext.Panel,{layout:"fit",loadData:false,pageSize:10,closable:true,autoScroll:true,pagingToolbar:true,gridForceFit:true,gridViewConfig:{},gridConfig:{},showMenu:true,menu_refresh:false,linkRenderer:EasyJF.Ext.Util.linkRenderer,linkRender:EasyJF.Ext.Util.linkRenderer,imgRender:EasyJF.Ext.Util.imgRender,booleanRender:EasyJF.Ext.Util.booleanRender,dateRender:EasyJF.Ext.Util.dateRender,userRender:EasyJF.Ext.Util.userRender,objectRender:EasyJF.Ext.Util.objectRender,typesRender:EasyJF.Ext.Util.typesRender,operaterRender:EasyJF.Ext.Util.operaterRender,storeType:Ext.data.JsonStore,storeConfig:{},emailRender:function(v){return v?v.email:"未知"},refresh:function(){this.store.removeAll();this.store.reload({callback:function(rs){if(rs&&rs.length<1){Ext.Msg.alert("提示","没有符合条件的数据！");EasyJF.Ext.Util.autoCloseMsg.defer(2000)}}})},showContextMenu:function(g,i,e){var evn=e?e:g;evn.preventDefault();if(i){this.grid.getSelectionModel().selectRow(i,false)}this.menu.showAt(evn.getPoint())},doOperate:function(grid,rowIndex,columnIndex,e){var tag=e.getTarget("A",3);if(tag){var id=tag.getAttribute("theid");var cmd=tag.getAttribute("op");var cf=tag.getAttribute("cf");if(id&&cmd&&this.operate){this.operate(cmd,id,cf,grid,rowIndex,columnIndex,e)}}},initComponent:function(){BaseGridList.superclass.initComponent.call(this);if(!this.store){this.store=new this.storeType(Ext.apply({id:"id",url:this.url,root:"result",totalProperty:"rowCount",remoteSort:true,fields:this.storeMapping},this.storeConfig))}this.store.paramNames.sort="orderBy";this.store.paramNames.dir="orderType";this.cm.defaultSortable=true;var viewConfig=Ext.apply({forceFit:this.gridForceFit},this.gridViewConfig);var gridConfig=Ext.apply({},{store:this.store,cm:this.cm,trackMouseOver:false,loadMask:true,viewConfig:viewConfig,bbar:(Ext.isFunction(this.buildGridBbar)?this.buildGridBbar():false)||(this.pagingToolbar?new Ext.ux.PagingComBo({pageSize:this.pageSize,store:this.store}):null)});Ext.apply(gridConfig,this.gridConfig);this.menus=this.menus||[];if(this.menu_refresh){this.menus[this.menus.length]={id:"menu_refresh",cls:"x-btn-text-icon",icon:"images/icons/arrow_refresh.png",text:"刷新",handler:this.refresh,scope:this}}this.menu=new Ext.menu.Menu({items:this.menus});if(this.gridTbar){gridConfig.tbar=this.gridTbar}if(this.gridBorder===false||this.gridBorder){gridConfig.border=this.gridBorder}if(this.columnLock&&Ext.grid.LockingGridPanel){if(!gridConfig.columns&&gridConfig.cm){gridConfig.columns=gridConfig.cm.config;delete gridConfig.cm}this.grid=new Ext.grid.LockingGridPanel(gridConfig)}else{this.grid=new Ext.grid.GridPanel(gridConfig)}this.grid.on("rowcontextmenu",function(g,n,e){if(!this.showMenu){return false}if(g.getSelectionModel().selectRow){g.getSelectionModel().selectRow(n)}this.menu.showAt(e.getPoint());e.preventDefault()},this);this.add(this.grid);if(this.loadData){this.store.load()}}});HTMLEditor=Ext.extend(Ext.form.HtmlEditor,{codeStyle:'<br/><pre style="border-right: #999999 1px dotted; padding-right: 5px; border-top: #999999 1px dotted; padding-left: 5px; font-size: 12px; padding-bottom: 5px; margin-left: 10px; border-left: #999999 1px dotted; margin-right: 10px; padding-top: 5px; border-bottom: #999999 1px dotted; background-color: #eeeeee">{0}</pre><br/>',onRender:function(ct,position){HTMLEditor.superclass.onRender.call(this,ct,position);if(this.keys){if(!this.keys.length){this.keyMap=new Ext.KeyMap(this.getEditorBody(),this.keys)}else{this.keyMap=new Ext.KeyMap(this.getEditorBody(),this.keys[0]);for(var i=1;i<this.keys.length;i++){this.keyMap.addBinding(this.keys[i])}}this.keyMap.stopEvent=true}},showEmoteSelect:function(){emoteSelectWin.editor=this;emoteSelectWin.show()},addImage:function(){function insertImage(){var editor=this;win.upload(function(ret){if(ret){var s="<br/><img src="+ret.path;if(ret.width){s+=" width="+ret.width}if(ret.height){s+=" height="+ret.height}s+=" /><br/>";editor.insertAtCursor(s);win.close()}})}var win=new UploadImageWindow({modal:true,iconCls:"icon-img",buttons:[{text:"确定",handler:insertImage,scope:this},{text:"取消",handler:function(){win.close()}}]});win.show()},addCode:function(){function insertCode(){var value=win.getComponent("codes").getValue();this.insertAtCursor(String.format(this.codeStyle,value));win.close()}var win=new Ext.Window({title:"添加代码",width:500,height:300,modal:true,iconCls:"icon-code",layout:"fit",items:{xtype:"textarea",id:"codes"},buttons:[{text:"确定",handler:insertCode,scope:this},{text:"取消",handler:function(){win.close()}}]});win.show()},createToolbar:function(editor){HTMLEditor.superclass.createToolbar.call(this,editor);this.tb.insertButton(16,{cls:"x-btn-icon",icon:"images/qq/img.gif",handler:this.addImage,scope:this});this.tb.insertButton(17,{cls:"x-btn-icon",icon:"images/qq/code.gif",handler:this.addCode,scope:this});this.tb.insertButton(18,{cls:"x-btn-icon",icon:"images/emote/main.png",handler:this.showEmoteSelect,scope:this})},validateValue:function(value){if(value.length>this.maxLength){var s=String.format(this.maxLengthText,this.maxLength);this.markInvalid(s);return false}return true}});Ext.reg("myhtmleditor",HTMLEditor);IFrames={};EasyJF.Ext.CrudListPanel=function(config){var c=config||{};Ext.apply(this,c);this.addEvents("saveobject","removeobject");EasyJF.Ext.CrudListPanel.superclass.constructor.call(this)};Ext.extend(EasyJF.Ext.CrudListPanel,Ext.util.Observable,{layout:"fit",border:false,closable:true,autoScroll:true,importExplain:"",gridForceFit:true,viewWin:{width:650,height:410,title:"详情查看"},searchWin:{width:630,height:300,title:"高级查询"},gridViewConfig:{},gridConfig:{},baseQueryParameter:{}});Ext.apply(EasyJF.Ext.CrudListPanel.prototype,EasyJF.Ext.CrudFunction,{afterList:Ext.emptyFn,list:function(){this.initComponent();this.checkAdnLoadColumnField();this.store=new Ext.data.JsonStore({id:this.storeId?this.storeId:"id",url:this.formatUrl("list"),root:"result",totalProperty:"rowCount",remoteSort:true,autoDestroy:true,fields:this.storeMapping});if(Ext.objPcount(this.baseQueryParameter)){this.store.on("beforeload",function(store,options){Ext.apply(store.baseParams,this.baseQueryParameter)},this)}this.store.baseParams=Ext.apply({},{limit:this.pageSize||""},this.initQueryParameter||{});this.store.paramNames.sort="orderBy";this.store.paramNames.dir="orderType";var buttons=this.buildCrudOperator();var viewConfig=Ext.apply({forceFit:this.gridForceFit},this.gridViewConfig);var gridConfig=Ext.apply(this.gridConfig,{store:this.store,stripeRows:true,trackMouseOver:false,loadMask:true,viewConfig:viewConfig,tbar:buttons,border:false,bbar:this.pagingToolbar?new Ext.ux.PagingComBo({rowComboSelect:true,pageSize:this.pageSize,store:this.store,displayInfo:true}):null});if(this.summaryGrid){if(gridConfig.plugins){if(typeof gridConfig.plugins=="object"){gridConfig.plugins=[gridConfig.plugins]}}else{gridConfig.plugins=[]}gridConfig.plugins[gridConfig.plugins.length]=new Ext.ux.grid.GridSummary()}var columns=this.columns,cfg={};columns=columns||this.cm.config;delete gridConfig.cm;columns=columns.copy();if(this.gridRowNumberer){columns.unshift(new Ext.grid.RowNumberer({header:"序号",width:36}))}if((!gridConfig.sm&&!gridConfig.selModel)&&this.gridSelModel=="checkbox"){cfg.sm=new Ext.grid.CheckboxSelectionModel();if(columns[0] instanceof Ext.grid.RowNumberer){columns.splice(1,0,cfg.sm)}else{columns.unshift(cfg.sm)}}cfg.columns=columns;gridConfig=Ext.applyIf(cfg,gridConfig);if(this.columnLock&&Ext.grid.LockingGridPanel){this.grid=new Ext.grid.LockingGridPanel(gridConfig)}else{this.grid=new Ext.grid.GridPanel(gridConfig)}this.grid.colModel.defaultSortable=true;this.panel=new Ext.Panel({id:this.id,title:this.title,closable:this.closable,autoScroll:this.autoScroll,layout:this.layout,border:this.border,listeners:{close:function(){delete this.panel},scope:this}});this.panel.add(this.grid);this.loadOperatorsPermission();this.initCrudEventHandler();this.afterList();if(this.autoLoadGridData){this.store.load()}this.panel.service=this;return this.panel}});Ext.namespace("Ext.ux.panel");Ext.ux.panel.DDTabPanel=Ext.extend(Ext.TabPanel,{arrowOffsetX:-9,arrowOffsetY:-8,border:false,enableTabScroll:true,layoutOnTabChange:true,autoScroll:true,resizeTabs:true,tabWidth:136,minTabWidth:136,titleLength:100,initComponent:function(){Ext.ux.panel.DDTabPanel.superclass.initComponent.call(this);if(!this.ddGroupId){this.ddGroupId="dd-tabpanel-group-"+Ext.ux.panel.DDTabPanel.superclass.getId.call(this)}},afterRender:function(){Ext.ux.panel.DDTabPanel.superclass.afterRender.call(this);this.arrow=Ext.DomHelper.append(Ext.getBody(),'<div class="dd-arrow-down"></div>',true);this.arrow.hide();var a=this.ddGroupId;this.dd=new Ext.ux.panel.DDTabPanel.DropTarget(this,{ddGroup:a})},initTab:function(b,a){Ext.ux.panel.DDTabPanel.superclass.initTab.call(this,b,a);var c=this.id+"__"+b.id;var id=this.stripWrap.id;Ext.applyIf(b,{allowDrag:true});Ext.apply(b,{position:(a+1)*2,ds:new Ext.dd.DragSource(c,{ddGroup:this.ddGroupId,dropEl:b,dropElHeader:Ext.get(c,true),scroll:false,onStartDrag:function(){this.constrainTo(id);this.getProxy().ghost.dom.innerHTML=String.format("<div style='width:100px;overflow:hidden;'>{0}</div>",this.dropEl.title);if(this.dropEl.iconCls){this.getProxy().getGhost().select(".x-tab-strip-text").applyStyles({paddingLeft:"1px"})}},onMouseDown:function(d){if(!this.dropEl.isVisible()){this.dropEl.show()}}}),enableDrag:function(){this.allowDrag=true;return this.ds.unlock()},disableDrag:function(){this.allowDrag=false;return this.ds.lock()}});if(b.allowDrag){b.enableDrag()}else{b.disableDrag()}},onDestroy:function(){Ext.destroy(this.dd,this.arrow);Ext.ux.panel.DDTabPanel.superclass.onDestroy.call(this)}});Ext.ux.panel.DDTabPanel.DropTarget=Ext.extend(Ext.dd.DropTarget,{constructor:function(b,a){this.tabpanel=b;Ext.ux.panel.DDTabPanel.DropTarget.superclass.constructor.call(this,b.stripWrap,a)},notifyOver:function(q,l,j){var m=this.tabpanel.items;var p=m.length;if(!l.within(this.getEl())){return"x-dd-drop-nodrop"}var r=this.tabpanel.arrow;var o=this.el.getY();var f;var k=l.getPageX();for(var h=0;h<p;h++){var d=m.itemAt(h);var c=d.ds.dropElHeader;var n=c.getX();var a=n+c.dom.clientWidth/2;if(k<=a){f=n;break}}if(typeof f=="undefined"){var b=m.itemAt(p-1);if(b){var g=b.ds.dropElHeader.dom;f=(new Ext.Element(g).getX()+g.clientWidth)+3}}r.setTop(o+this.tabpanel.arrowOffsetY).setLeft(f+this.tabpanel.arrowOffsetX).show();return this.dropAllowed},notifyDrop:function(p,k,f){this.tabpanel.arrow.hide();var m=this.tabpanel.items;var o=m.length;var h=k.getPageX();var l=o;p.dropEl.position=o*2+1;var j=this.tabpanel.items.indexOf(p.dropEl);for(var d=0;d<o;d++){var c=m.itemAt(d);var b=c.ds.dropElHeader;var n=b.getX();var a=n+b.dom.clientWidth/2;if(h<=a){if(j<d){d-=1}break}}p.proxy.hide();var g=p.dropEl.ownerCt.remove(p.dropEl,false);var c=this.tabpanel.getComponent(d);if(c&&c.tabFixed){d=this.getLastTabFixed()}if(this.tabpanel.items.getCount()<d){d=this.tabpanel.items.getCount()}this.tabpanel.insert(d,g);this.tabpanel.activate(g);return true},getLastTabFixed:function(){var a=this.tabpanel.items.filter("tabFixed",true);return a.getCount()},notifyOut:function(a,c,b){this.tabpanel.arrow.hide()}});Ext.reg("ddtabpanel",Ext.ux.panel.DDTabPanel);ChartTools={createFusionChart:function(url,swf,chartId,width,height,options){options=options||{};var myChart=new FusionCharts(swf,chartId,width,height,"0","0");url=url||options.url;if(url){if(url.indexOf("?")<1){url+="?"}if(options.params){url+=Ext.urlEncode(options.params)}myChart.setDataURL(url)}if(options.renderTo&&url){myChart.render(options.renderTo)}return myChart},createChart:function(url,swf,config){config=config||{};var myChart=this.createFusionChart(url,swf,config.id,config.width,config.height,config);return myChart},createColumn2D:function(url,config){return this.createChart(url,"FusionCharts/chart/Column2D.swf",config)},createColumn3D:function(url,config){return this.createChart(url,"FusionCharts/chart/Column3D.swf",config)},createGroupColumn2D:function(url,config){return this.createChart(url,"FusionCharts/chart/MSColumn2D.swf",config)},createGroupColumn3D:function(url,config){return this.createChart(url,"FusionCharts/chart/MSColumn3D.swf",config)},createPie2D:function(url,config){return this.createChart(url,"FusionCharts/chart/Pie2D.swf",config)},createPie3D:function(url,config){return this.createChart(url,"FusionCharts/chart/Pie3D.swf",config)},createBar2D:function(url,config){return this.createChart(url,"FusionCharts/chart/Bar2D.swf",config)},createGroupBar2D:function(url,config){return this.createChart(url,"FusionCharts/chart/MSBar2D.swf",config)},createGroupBar3D:function(url,config){return this.createChart(url,"FusionCharts/chart/MSBar3D.swf",config)},createLine:function(url,config){return this.createChart(url,"FusionCharts/chart/Line.swf",config)},createGroupLine:function(url,config){return this.createChart(url,"FusionCharts/chart/MSLine.swf",config)}};ChartWindow=Ext.extend(Ext.Window,{max:20,store:null,datas:null,columnModel:null,url:"",params:null,grid:null,layout:"border",closeAction:"hide",buttonAlign:"center",tpl:new Ext.XTemplate('<chart caption="{title}"> ','<tpl for="list">','<set label="{name}" value="{value}" />',"</tpl></chart>"),initParams:function(){if(this.grid){this.store=this.grid.store;if(!this.columnModel){this.columnModel=this.grid.getColumnModel()}}if(this.columnModel){var fields=[];if(this.columnModel.getColumnCount&&this.columnModel.getDataIndex){for(var i=0;i<this.columnModel.getColumnCount();i++){fields.push({id:this.columnModel.getDataIndex(i),title:this.columnModel.getColumnHeader(i)})}}else{fields=this.columnModel}this.leftTree.root.attributes.children=[];for(var i=0;i<fields.length;i++){this.leftTree.root.attributes.children.push({text:fields[i].title,id:fields[i].id,leaf:true})}this.leftTree.root.reload();this.btn_field.store.loadData(fields);this.btn_field.setValue(this.field||"")}this.btn_max.setValue(this.max);this.setTitle(this.title)},loadChart:function(){this.initParams();var objs={title:this.title,list:[],order:false};var orderBy="";if(this.btn_orderASC.getValue()){orderBy="ASC"}else{if(this.btn_orderDESC.getValue()){orderBy="DESC"}}if(this.datas&&this.datas.length){objs.list=this.datas}else{if(this.store){if(orderBy){this.store.sort(this.field,orderBy)}for(var i=0;i<this.store.getCount()&&i<this.max;i++){var r=this.store.getAt(i).data;var obj={name:r[this.label||"sn"],value:r[this.field]};objs.list.push(obj)}objs.order=true}}var xml="";if(!objs.list.length&&this.url){var response=Ext.lib.Ajax.syncRequest("POST",this.url,Ext.apply(this.params,{sort:orderBy}));xml=response.conn.responseText}else{if(!objs.order&&orderBy){var f="value";var dsc=orderBy.toUpperCase()=="DESC"?-1:1;objs.list.sort(function(a,b){if(a[f]==b[f]){return 0}else{return a[f]>b[f]?1*dsc:-1*dsc}})}xml=this.tpl.applyTemplate(objs)}var createChart=ChartTools.createColumn3D;if(this.btn_pie.getValue()){createChart=ChartTools.createPie3D}else{if(this.btn_pie2d.getValue()){createChart=ChartTools.createPie2D}else{if(this.btn_bar2d.getValue()){createChart=ChartTools.createColumn2D}}}var chartPanel=this.chartPanel;var b=chartPanel.body.getBox();try{this.chart=createChart.call(ChartTools,null,{width:b.width-20,height:b.height-10})}catch(e){alert(e)}this.chart.setDataXML(xml);this.chart.render(chartPanel.body.dom)},refreshChart:function(){this.max=this.btn_max.getValue();this.loadChart()},clickDeptNode:function(node){this.params=Ext.apply({},{field:node.attributes.id},this.params);this.field=node.attributes.id;this.title=node.attributes.text;if(this.store){this.datas=null}this.refreshChart()},initComponent:function(){this.btn_field=new EasyJF.Ext.SmartCombox({name:"colorInput",hiddenName:"colorInput",fieldLabel:"colorInput",displayField:"title",valueField:"id",allowBlank:false,width:100,store:new Ext.data.JsonStore({fields:["id","title"]}),editable:false,mode:"local",triggerAction:"all",emptyText:"请选择..."});this.btn_max=new Ext.form.NumberField({name:"max",xtype:"numberfield",width:30});this.btn_orderType=new Ext.form.ComboBox(Ext.apply({},{width:80},EasyJF.Ext.Util.buildCombox("type","是否",[["由低到高","ASC"],["由高到低","DESC"]],"DESC",true)));this.btn_orderASC=new Ext.form.Radio({boxLabel:"由低到高",name:"orderTypes",handler:this.refreshChart,scope:this});this.btn_orderDESC=new Ext.form.Radio({boxLabel:"由高到低",name:"orderTypes",handler:this.refreshChart,scope:this});this.btn_bar=new Ext.form.Radio({boxLabel:"柱状图",cls:"x-btn-text-icon",name:"types",handler:this.refreshChart,scope:this,checked:true});this.btn_pie=new Ext.form.Radio({boxLabel:"饼状图",cls:"x-btn-text-icon",name:"types",handler:this.refreshChart,scope:this});this.btn_bar2d=new Ext.form.Radio({boxLabel:"柱状图2D",cls:"x-btn-text-icon",name:"types",handler:this.refreshChart,scope:this});this.btn_pie2d=new Ext.form.Radio({boxLabel:"饼状图2D",cls:"x-btn-text-icon",name:"types",handler:this.refreshChart,scope:this});this.btn_vdate1=new Ext.form.DateField({format:"Y-m-d"});this.btn_vdate2=new Ext.form.DateField({format:"Y-m-d"});Ext.apply(this,{width:Ext.getBody().getViewSize().width-50,height:Ext.getBody().getViewSize().height-20});ChartWindow.superclass.initComponent.call(this);this.leftTree=new Ext.tree.TreePanel({xtype:"treepanel",title:"分析项目",border:false,rootVisible:false,root:new Ext.tree.AsyncTreeNode({id:"root",text:"所有部门",expanded:true,children:[],loader:new Ext.tree.TreeLoader()}),listeners:{scope:this,click:this.clickDeptNode}});this.chartPanel=new Ext.Panel({html:"正在生成统计图..."});this.add({region:"west",width:150,items:[this.leftTree]});this.add({region:"center",layout:"fit",items:this.chartPanel,tbar:["最多分析数",this.btn_max,"排序方式:",this.btn_orderASC,this.btn_orderDESC,"-","展示方式:",this.btn_bar,this.btn_pie,this.btn_bar2d,this.btn_pie2d,"    ","-",{text:"开始分析",cls:"x-btn-text-icon",handler:this.refreshChart,scope:this,icon:"images/icons/application_side_expand.png"}]});this.on("show",this.loadChart,this)}});ChartWindow.showChart=function(config,callback){if(!ChartWindow.win){ChartWindow.win=new ChartWindow()}Ext.apply(ChartWindow.win,Ext.apply({store:null,datas:null,columnModel:null,url:"",params:null,grid:null},config||{}));ChartWindow.win.show();if(callback){callback.call(ChartWindow.win)}};SearchResultStatisticsWin=Ext.extend(Ext.Window,{title:"查询结果预览",width:300,height:300,layout:"fit",closeAction:"hide",initGrid:function(){var rs=[];if(this.data){for(var name in this.data){var o={name:name,value:this.data[name]};rs.push(o)}}this.grid.store.removeAll();this.grid.store.loadData(rs);if(this.title){this.setTitle(this.title)}},initComponent:function(){this.grid=new Ext.grid.GridPanel({viewConfig:{forceFit:true},store:new Ext.data.JsonStore({fields:["name","value"]}),cm:new Ext.grid.ColumnModel([{header:"项目名称",width:100,sortable:false,dataIndex:"name",id:"name",menuDisabled:true},{header:"值",width:100,resizable:false,dataIndex:"value",id:"value",menuDisabled:true}])});SearchResultStatisticsWin.superclass.initComponent.call(this);this.on("show",this.initGrid,this);this.add(this.grid)}});SearchResultStatisticsWin.showWin=function(config){if(!SearchResultStatisticsWin.win){SearchResultStatisticsWin.win=new SearchResultStatisticsWin()}Ext.apply(SearchResultStatisticsWin.win,config);SearchResultStatisticsWin.win.show();return SearchResultStatisticsWin.win};EasyJF.Ext.MainAppService={IFrameClass:{},NormalClass:{},getSingleTabMode:function(){return window.Global.Config.singleTabMode},openTab:function(panel,id){var o=(typeof panel=="string"?panel:id||panel.id);var tab=this.getComponent(o);if(tab){this.setActiveTab(tab)}else{if(typeof panel!="string"){if(!this.tabsCheck()){return}panel.id=o;var p=this.add(panel);if(this.getSingleTabMode()){this.closeAll(p)}this.setActiveTab(p)}}},tabsCheck:function(){if(this.items.getCount()>this.maxTabs){Ext.Msg.alert("提示","系统允许同时打开的面板数已经达到极限，请先关闭其它一打开的面板再重新进入");return false}return true},openAppInWin:function(panel){panel.elements=panel.elements.replace(",header","");panel.inWinConfig=panel.inWinConfig||{};if(!this.appWin){this.appWin=new Ext.Window(Ext.apply({width:Ext.getBody().dom.offsetWidth-20,height:Ext.getBody().dom.offsetHeight-20,closeAction:"hide",layout:"fit",modal:true,maximizable:true,title:panel.title,items:panel,listeners:{maximize:function(win){win.doLayout()},restore:function(win){win.doLayout()}}},panel.inWinConfig));Ext.del(panel,"inWinConfig")}else{this.appWin.remove(0);this.appWin.add(panel);this.appWin.setSize(panel.inWinConfig.width||(Ext.getBody().dom.offsetWidth-20),panel.inWinConfig.height||(Ext.getBody().dom.offsetHeight-20));this.appWin.doLayout();this.appWin.setTitle(panel.title)}this.appWin.show((typeof main!="undefined")&&Lanyo_Ajax.getCfg("enableAnimate")?Ext.getBody():false,function(win){win.center()})},openExtAppNode:function(node,e){if((!node.attributes.listeners||!node.attributes.listeners.click)&&node.attributes.appClass){var pck=node.attributes["package"]?node.attributes["package"]:this["package"];if(!pck){pck=""}else{pck.replace(".","/")}var script=(node.attributes.script?node.attributes.script:this.script);var appClass=node.attributes.appClass;if(!script){script=appClass+".js"}script=pck+"/"+script;var title=node.attributes.title?node.attributes.title:node.text;if(Global.Config.iframe&&!node.attributes.frameDisable){main.openExtApp(appClass,script,title,null,node.attributes.otherScripts,node.attributes.callback,node.attributes.inWin,node.attributes.params)}else{main.openClassApp(appClass,script,title,appClass,node.attributes.otherScripts,node.attributes.callback,node.attributes.inWin,node.attributes.params)}}},openExtApp:function(id,script,title,appClass,otherScripts,callback,inWin,params){appClass=appClass||id;title=title||id;otherScripts=otherScripts||"";var tab=this.getComponent(id);if(tab){this.setActiveTab(tab)}else{if(!this.tabsCheck()){return}var theParameter=params||{};if(params&&(typeof params=="string")){theParameter=Ext.urlDecode(params)}if(!this.IFrameClass[appClass]){eval("this.IFrameClass."+appClass+"=Ext.extend(ExtAppBasePanel,{id:'"+id+"',title:'"+title+"',appClass:'"+appClass+"',script:'"+script+"',otherScripts:'"+otherScripts+"',params:'"+(Ext.encode(theParameter))+"'});")}if(inWin){this.openAppInWin(new this.IFrameClass[appClass]())}else{eval("var p = this.add(new this.IFrameClass."+appClass+"());");p.on("destroy",new Function("delete IFrames."+appClass));if(this.getSingleTabMode()){this.closeAll(p)}this.setActiveTab(p);if(p){p.doLayout()}}}if(callback){callback()}},openClassApp:function(id,script,title,appClass,otherScripts,callback,inWin,params){appClass=appClass||id;title=title||id;var tab=this.getComponent(id);if(tab){this.setActiveTab(tab);if(callback){callback()}}else{if(!this.tabsCheck()){return}var theParameter=params||{};if(params&&(typeof params=="string")){theParameter=Ext.urlDecode(params)}if(this.NormalClass[appClass]){if(this.NormalClass[appClass].superclass.onWindowResize){eval("var p = new this.NormalClass."+appClass+"(theParameter)");p.show()}else{eval("var tempP = new "+appClass+"(theParameter);if(tempP.list && (typeof tempP.list=='function'))tempP=tempP.list();");if(inWin){var inWinConfig=tempP.inWinConfig||{};Ext.del(tempP,"inWinConfig");this.openAppInWin(new this.NormalClass[appClass](Ext.apply({items:tempP},{inWinConfig:inWinConfig})))}else{eval("var p = this.add(new this.NormalClass."+appClass+"({items:tempP}));");if(this.getSingleTabMode()){this.closeAll(p)}this.setActiveTab(p)}}}else{var successLoad=function(req){eval(req.responseText);if(typeof(window[appClass])=="undefined"){return}if(eval(appClass+".superclass.onWindowResize")){eval("this.NormalClass."+appClass+"="+appClass);eval("var p=new "+appClass+"(theParameter);");p.show()}else{eval("this.NormalClass."+appClass+"=Ext.extend(Ext.Panel,{id:'"+id+"',title:'"+title+"',border:false,layout:'fit',closable:true});");eval("var tempP = new "+appClass+"(theParameter);if(tempP.list && (typeof tempP.list=='function'))tempP=tempP.list();");if(inWin){var inWinConfig=tempP.inWinConfig||{};Ext.del(tempP,"inWinConfig");this.openAppInWin(new this.NormalClass[appClass](Ext.apply({items:tempP},{inWinConfig:inWinConfig})))}else{eval("var p = this.add(new this.NormalClass."+appClass+"({items:tempP}));");if(this.getSingleTabMode()){this.closeAll(p)}this.setActiveTab(p);if(p){p.doLayout()}}}};if(otherScripts){var s=otherScripts.split(";");var total=s.length,ld=0;for(var i=0;i<s.length;i++){Ext.Ajax.request({url:s[i],success:function(req){eval(req.responseText);ld++;if(ld>=total){Ext.Ajax.request({waitMsg:"正在加载程序，请稍候。。。",url:Lanyo_Ajax.script+script,success:successLoad,scope:this})}},scope:this})}}else{Ext.Ajax.request({waitMsg:"正在加载程序，请稍候。。。",url:Lanyo_Ajax.script+script,success:successLoad,scope:this})}}if(callback){callback()}}},closeTab:function(panel,id){var o=(typeof panel=="string"?panel:id||panel.id);var tab=this.getComponent(o);if(tab){this.remove(tab)}},closeAll:function(excep){this.items.each(function(p){if(p.closable&&p!=excep){this.closeTab(p)}},this)},savePersonality:function(callback,hideMsg){var result=[];var s="",colCfg=[];var portal=this.getComponent("homePage");if(portal&&portal.items&&portal.getXType()=="ux.portal"){var items=portal.items;for(var i=0;i<items.getCount();i++){var c=items.get(i);var ps="";for(var j=0;j<c.items.getCount();j++){var it=c.items.get(j);ps="id:"+it.getId()+",col:"+i+",row:"+j;colCfg.push({id:it.getId(),col:i,row:j});if(it.customizeUrl){ps+=",url:"+it.customizeUrl}if(it.customizeHtml){ps+=",html:"+it.customizeHtml}if(it.customizeUrl||it.customizeHtml){ps+=",title:"+it.title}s+=ps+"@@"}}}var params={portalMode:Lanyo_Ajax.getCfg("portalMode"),maxTabs:Lanyo_Ajax.getCfg("maxTabs"),iframe:Lanyo_Ajax.getCfg("iframe"),singleTabMode:Lanyo_Ajax.getCfg("singleTabMode"),enableAnimate:Lanyo_Ajax.getCfg("enableAnimate"),commonFunction:Lanyo_Ajax.getCfg("commonFunction"),style:Lanyo_Ajax.getCfg("style"),homePage:Lanyo_Ajax.getCfg("homePage"),lang:Lanyo_Ajax.getCfg("lang"),portals:s};if(Lanyo_Ajax.PersonalityUrl){Ext.Ajax.request({url:Lanyo_Ajax.formatUrl(Lanyo_Ajax.PersonalityUrl,"savePersonality"),params:params,waitMsg:hideMsg?"":"正在保存数据,请稍候...",success:function(res){Lanyo_Ajax.setCfg("portalConfig",colCfg);if(!hideMsg){EasyJF.Ext.Msg.alert("您的个性化配置信息已经成功保存！","提示",function(){if(callback){callback()}},this)}else{if(callback){callback()}}}})}return result},cleanPortlet:function(){var portal=this.getComponent("homePage");if(portal&&portal.items&&portal.getXType()=="portal"){for(var i=0;i<portal.items.getCount();i++){var ps=portal.items.get(i);ps.items.each(function(c){ps.remove(c)})}}},loadPersonality:function(){if(Lanyo_Ajax.PersonalityUrl){Ext.Ajax.request({url:Lanyo_Ajax.formatUrl(Lanyo_Ajax.PersonalityUrl,"loadPersonality"),success:function(res){this.cleanPortlet();var res=Ext.decode(res.responseText);if(res){var config={maxTabs:res.maxTabs,singleTabMode:res.singleTabMode,enableAnimate:res.enableAnimate,style:res.style,homeMenu:res.homePage,commonFunction:res.commonFunctions};res.commonFunction=res.commonFunctions;Ext.apply(this,config);for(var p in res){if(Ext.isDefined(res[p])){Lanyo_Ajax.setCfg(p,res[p])}}if(Ext.isString(this.commonFunction)&&!Ext.isEmpty(this.commonFunction)){this.commonFunction=this.commonFunction.split(/[,;\s]/);config.commonFunction=this.commonFunction}this.fireEvent("loadSystemConfig",config)}var p=Ext.getCmp("homePage");if(p&&p.getXType()=="ux.portal"){p.updatePortalModeHandler()}},scope:this})}},resetPersonality:function(){Ext.Msg.confirm("提示","是否真的要还原桌面设置?",function(btn){if(btn=="yes"){Ext.Ajax.request({url:"manage.ejf?cmd=resetPersonality",success:function(res){Ext.Msg.alert("提示","成功还原默认桌面设置!",function(){this.loadPersonality()},this)},scope:this})}})},resetDesktop:function(){Ext.Msg.confirm("提示","是否真的要还原桌面设置?",function(btn){if(btn=="yes"){Ext.Ajax.request({url:"manage.ejf?cmd=resetDesktop",success:function(res){Ext.Msg.alert("提示","成功还原默认桌面设置!",function(){this.loadPersonality()},this)},scope:this})}})},addPortlet:function(col,row,id,config){var portal=this.getComponent("homePage"),portlet;if(portal&&portal.getXType()=="ux.portal"){var pms=Ext.getObjVal(Global,"Portal.PanelMC");if(pms&&pms.getCount()){portlet=pms.key(id)}}},changeSkin:function(value){EasyJF.Ext.Util.applySkin(value)}};Ext.override(Ext.data.JsonWriter,{render:function(params,baseParams,data){if(this.encode===true){Ext.apply(params,baseParams);params[this.meta.root]=Ext.encode(data)}else{var jdata=Ext.apply({},baseParams);if(Ext.isArray(data)){data=Ext.obj2Arr(data)}if(!Ext.isObject(data)){data={id:data}}Ext.apply(params,data,jdata)}}});EasyJF.Ext.CrudRowEditorPanel=Ext.extend(Ext.Panel,{layout:"fit",defaultSortable:true,storeMapping:["id"],gridStore:null,gridStoreAutoLoad:true,gridStoreInitData:null,gridConfig:{},gridViewConfig:{},gridPageSize:20,baseUrl:"",cmdParamName:"cmd",defaultsActions:{create:"save",list:"list",view:"view",update:"update",remove:"remove"},defaultShowButtons:["btn_add","btn_edit","btn_view","btn_remove","btn_refresh","searchField"],extraShowButtons:[],disableShowButtons:["btn_view"],getCmdName:function(cmd){return this.defaultsActions[cmd]},getCmdUrl:function(cmdName){var cmd={},url;cmd[this.cmdParamName]=this.getCmdName(cmdName);url=Ext.urlAppend(this.baseUrl,Ext.urlEncode(cmd));return url},clearSearch:function(){this.gridStore.baseParams={};this.gridStore.load({params:{start:0,pageSize:this.gridPageSize}})},crud_operators:[{itemId:"btn_add",name:"btn_add",text:"添加(<u>A</u>)",iconCls:"add",method:"create",cmd:"save",noneSelectRow:true,hidden:true},{itemId:"btn_edit",name:"btn_edit",text:"编辑(<u>E</u>)",iconCls:"edit",disabled:true,method:"edit",cmd:"update",hidden:true,singleRow:true},{itemId:"btn_view",name:"btn_view",text:"查看(<u>V</u>)",iconCls:"view",method:"view",disabled:true,hidden:true,singleRow:true},{itemId:"btn_remove",name:"btn_remove",text:"删除(<u>D</u>)",iconCls:"delete",disabled:false,method:"remove",cmd:"remove",hidden:true},{itemId:"btn_refresh",name:"btn_refresh",text:"刷新",iconCls:"refresh",method:"refresh",noneSelectRow:true},{itemId:"btn_advancedSearch",name:"btn_advancedSearch",text:"高级查询(<u>S</u>)",iconCls:"srsearch",method:"advancedSearch",cmd:"list",hidden:true,noneSelectRow:true,clientOperator:true},{itemId:"btn_clearSearch",name:"btn_clearSearch",text:"显示全部",cls:"x-btn-text-icon",iconCls:"search",noneSelectRow:true,method:"clearSearch",hidden:true},{itemId:"btn_print",name:"btn_print",text:"打印(<u>P</u>)",iconCls:"print-icon",disabled:true,method:"printRecord",hidden:true},{itemId:"btn_export",name:"btn_export",text:"导出Excel(<u>O</u>)",iconCls:"export-icon",method:"exportExcel",noneSelectRow:true,hidden:true},{itemId:"btn_import",name:"btn_import",text:"导入数据(<u>I</u>)",iconCls:"import-icon",method:"importExcel",noneSelectRow:true,hidden:true},"->",{itemId:"searchField",name:"searchField",type:"searchfield",width:100,noneSelectRow:true,paramName:"searchKey",clientOperator:true}],_getGridButtons:function(){if(!this.grid_CrudButtons){this.grid_CrudButtons=this.crud_operators.concat([])}var buttons=this.defaultShowButtons.concat(this.extraShowButtons);var gbuttons=[];Ext.each(this.grid_CrudButtons,function(gbtn){var n=gbtn.name;if((buttons.contains(n)&&!this.disableShowButtons.contains(n))||Ext.isString(gbtn)){gbuttons.push(gbtn)}},this);return gbuttons},_getCheckPermissionsInfo:function(){var args={},names=[],actions=[],cmds=[];var btns=this._getGridButtons();var baseUrl=this.baseUrl;Ext.each(btns,function(o){if(typeof o!="string"){if(!o.clientOperator&&(o.cmd||o.method)){actions.push(o.action||baseUrl);cmds.push(o.cmd||o.method||"");names.push(o.name||o.id||"")}}});return{names:names,actions:actions,cmds:cmds}},useOperatorsPermission:function(args){var ret=args||this.permissions;var args=[];for(var i=0;i<ret.length;i++){args.push(ret[i]);var o=this.operators.find(function(c){var n1=c.name||c.id;if(n1==args[i]){return true}});if(o){o.hidden=false}}this.showOperaterItem(args);this.fireEvent("usepermission",this)},buildCrudOperator:function(){},buildButtons:function(){var btns=this._getGridButtons(),buttons=[];var showBtns=this.defaultShowButtons;var bs=[];Ext.each(btns,function(c){if(typeof c=="string"){bs.push(c)}else{if(!c.showInMenuOnly){var co=this.operatorConfig2Component(c);var key=co.name||co.id;try{if(Ext.isString(co.type)){this[key]=Ext.create(co,co.type)}else{this[key]=new Ext.Toolbar.Button(co)}bs.push(this[key])}catch(e){alert(key+":"+e)}}}},this);return bs},buildGridStore:function(){var store=this.gridStore;if(!store){store=new Ext.data.JsonStore({root:"result",totalProperty:"rowCount",pageSize:this.gridPageSize,url:this.getCmdUrl("list"),fields:this.storeMapping,restful:false,autoLoad:true,writer:new Ext.data.JsonWriter({encode:false}),proxy:new Ext.data.HttpProxy({api:{update:this.getCmdUrl("update"),create:this.getCmdUrl("create"),destroy:this.getCmdUrl("remove"),read:this.getCmdUrl("list")}})});if(this.gridStoreInitData){store.loadData(this.gridStoreInitData)}else{if(this.gridStoreAutoLoad){store.load()}}}return store},buildGridCm:function(){var cm;if(Ext.isArray(this.columns)){cm=new Ext.grid.ColumnModel({defaultSortable:this.defaultSortable,columns:this.columns})}return cm},onBeforeRowEditor:function(){return this.permissions.contains("btn_edit")},buildGrid:function(){this.rowEditor=new Ext.ux.grid.RowEditor({saveText:"Update",errorSummary:false,listeners:{scope:this,beforeedit:this.onBeforeRowEditor}});this.gridCm=this.buildGridCm();var viewConfig={forceFit:true};var vcf=Ext.apply(viewConfig,this.gridViewConfig);var gcf=Ext.apply({store:this.gridStore,border:false,cm:this.gridCm,sm:this.gridSm,bbar:new EasyJF.Ext.PagingComBo({displayInfo:true,rowComboSelect:true,store:this.gridStore,pageSize:this.gridPageSize})},this.gridConfig);if(!gcf.viewConfig){gcf.viewConfig={}}Ext.apply(gcf.viewConfig,vcf);gcf.plugins=gcf.plugins||[];gcf.plugins.push(this.rowEditor);var grid=new Ext.grid.GridPanel(gcf);return grid},findOperatorBy:function(callback){var objs=[];this.operators.each(function(o){if(typeof o!="string"){if(callback&&callback(o)){objs.push(o)}}});return objs},findOperatorByProperty:function(name,value){return this.findOperatorBy(function(o){if(o[name]==value){return true}})},toggleSingleRowOperator:function(enable){var ids=this.findOperatorByProperty("singleRow",true);var args=[];if(ids&&ids.length){for(var i=0;i<ids.length;i++){args.push(ids[i].name||ids[i].id)}}this[(enable?"enable":"disable")+"OperaterItem"](args)},enableOperaterItem:function(){var args=Ext.args();this.getTopToolbar().enables(args)},disableOperaterItem:function(){var args=Ext.args();this.getTopToolbar().disables(args)},showOperaterItem:function(){var args=Ext.args();this.getTopToolbar().shows(args)},hideOperaterItem:function(){var args=Ext.args();this.getTopToolbar().hides(args)},onGridRowSelectionChang:function(g,index,r){var sel=this.grid.getSelections();this.toggleSingleRowOperator(!(sel&&sel.length>1));var ids=this.findOperatorByProperty("batch",true);var args=[];if(ids&&ids.length){for(var i=0;i<ids.length;i++){args.push(ids[i].name||ids[i].id)}}this.enableOperaterItem(args)},operatorConfig2Component:function(o,isMenu){var co=Ext.apply({},o);if(!co.handler){if(co.method&&this[co.method]){co.handler=this[co.method]}}if(co.handler&&!co.scope){co.scope=this}if(!isMenu){if(this.operatorButtonStyle==2){if(co.icon){co.cls="x-btn-icon";co.text=""}}else{if(this.operatorButtonStyle==3){co.icon="";co.cls=""}}}var key=co.name||co.id;if(key=="searchField"){co.store=this.gridStore}else{if(key=="btn_advancedSearch"){co.hidden=!((this.searchFormPanel||this.searchFP)&&this.allowSearch)}}return co},loadOperatorsPermission:function(){if(!this.permissions){var objs=this._getCheckPermissionsInfo();if(Lanyo_Ajax.permissionCheck){Ext.Ajax.request({url:(Lanyo_Ajax.permissionCheckAction||"permissionCheck.ejf"),params:objs,callback:function(options,success,response){var ret=Ext.decode(response.responseText);if(ret&&ret.permissions&&ret.permissions.length){this.permissions=ret.permissions;this.useOperatorsPermission()}if(ret&&ret.queryObjects){this.addQueryObjectOperator(ret.queryObjects)}},scope:this})}else{this.permissions=["btn_add","btn_edit","btn_view","btn_remove","btn_refresh"];this.useOperatorsPermission()}}else{this.useOperatorsPermission()}},initCrudRowEditorEvents:function(){var g=this.grid,sm=g.getSelectionModel();sm.on("rowselect",this.onGridRowSelectionChang,this,{buffer:200})},create:function(){var data=new this.gridStore.recordType({});this.rowEditor.stopEditing();this.gridStore.insert(0,data);this.rowEditor.startEditing(0)},edit:function(){var rowIndex=this.getSingleRow();this.rowEditor.startEditing(rowIndex,false);this.rowEditor.doFocus.defer(this.rowEditor.focusDelay,this,[])},view:function(){var rowIndex=this.getSingleRow()},remove:function(){var rowIndex=this.getSingleRow();this.gridStore.remove(this.gridStore.getAt(rowIndex))},refresh:function(){this.grid.getStore().reload()},getSingleRow:function(){var g=this.grid,s=g.getStore();var records=g.getSelections();if(records&&records.length){var rowIndex=s.indexOf(records[0])}return rowIndex},beforeDestroy:function(){if(this.rowEditor){Ext.destroy(this.rowEditor);delete this.rowEditor}},initComponent:function(){this.gridStore=this.buildGridStore();var gridTbars=this.buildButtons();this.operators=new Ext.util.MixedCollection(false,function(o){return o.id||o.name});this.operators.addAll(gridTbars);this.tbar=gridTbars;this.grid=this.buildGrid();this.items=[this.grid];this.initCrudRowEditorEvents();this.loadOperatorsPermission();EasyJF.Ext.CrudRowEditorPanel.superclass.initComponent.call(this)}});EasyJF.Ext.MainTabPanel=Ext.extend(Ext.TabPanel,{singleTabMode:false,iframe:false,enableAnimate:false,resizeTabs:true,minTabWidth:65,tabWidth:120,enableTabScroll:true,activeTab:0,maxTabs:10,initComponent:function(){EasyJF.Ext.MainTabPanel.superclass.initComponent.call(this)}});Ext.apply(EasyJF.Ext.MainTabPanel.prototype,{},EasyJF.Ext.MainAppService);EasyJF.Ext.MainSinglePanel=Ext.extend(Ext.Panel,{iframe:false,maxTabs:10,singleTabMode:true,enableAnimate:true,layout:"fit",homeMenu:"menu",theStyle:"ext-all",setActiveTab:function(p){p.show();p.ownerCt.doLayout()},getActiveTab:function(){return this.getComponent(0)},getSingleTabMode:function(){return true},closeAll:function(excep){this.items.each(function(p){if(p!=excep){this.closeTab(p)}},this)},initComponent:function(){EasyJF.Ext.MainSinglePanel.superclass.initComponent.call(this)}});Ext.apply(EasyJF.Ext.MainSinglePanel.prototype,{},EasyJF.Ext.MainAppService);Ext.namespace("Ext.ux.plugins");EasyJF.Ext.PagingComBo=Ext.extend(Ext.PagingToolbar,{displayMsg:"第{0}-{1}条&nbsp;&nbsp;共{2}条&nbsp;&nbsp;&nbsp;&nbsp;共{3}页",style:"font-weight:900",rowComboSelect:true,displayInfo:true,doLoad:function(start){var o={},pn=this.getParams()||{};o[pn.start]=start;o[pn.limit]=this.pageSize;if(this.store.baseParams&&this.store.baseParams[pn.limit]){this.store.baseParams[pn.limit]=this.pageSize}if(this.fireEvent("beforechange",this,o)!==false){this.store.load({params:o})}},onPagingSelect:function(combo,record,index){var d=this.getPageData(),pageNum;pageNum=this.readPage(d);if(pageNum!==false){pageNum=Math.min(Math.max(1,record.data.pageIndex),d.pages)-1;this.doLoad(pageNum*this.pageSize)}},readPage:Ext.emptyFn,onLoad:function(store,r,o){var d=this.getPageData(),ap=d.activePage,ps=d.pages;this.combo.store.removeAll();if(ps==0){this.combo.store.add(new Ext.data.Record({pageIndex:1}));this.combo.setValue(1)}else{for(var i=0;i<ps;i++){this.combo.store.add(new Ext.data.Record({pageIndex:i+1}))}this.combo.setValue(ap)}if(this.rowComboSelect){this.rowcombo.setValue(this.pageSize)}EasyJF.Ext.PagingComBo.superclass.onLoad.apply(this,arguments)},updateInfo:function(){if(this.displayItem){var count=this.store.getCount();var activePage=this.getPageData().activePage;var msg=count==0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+count,this.store.getTotalCount(),Math.ceil(this.store.getTotalCount()/this.pageSize),activePage);this.displayItem.setText(msg)}},onComboPageSize:function(combo,record,index){var pageSize=record.get("pageSize");this.store.pageSize=this.pageSize=pageSize;var d=this.getPageData(),pageNum;pageNum=this.readPage(d);if(pageNum!==false){pageNum=Math.min(Math.max(1,record.data.pageIndex),d.pages)-1;this.doLoad(0)}},initComponent:function(){if(Ext.getObjVal(this.store,"pageSize")){this.pageSize=Ext.getObjVal(this.store,"pageSize")}this.combo=Ext.ComponentMgr.create(Ext.applyIf(this.combo||{},{value:1,width:50,store:new Ext.data.SimpleStore({fields:["pageIndex"],data:[[1]]}),mode:"local",xtype:"combo",minListWidth:50,allowBlank:false,triggerAction:"all",displayField:"pageIndex",allowDecimals:false,allowNegative:false,enableKeyEvents:true,selectOnFocus:true,submitValue:false}));this.combo.on("select",this.onPagingSelect,this);this.combo.on("specialkey",function(){this.combo.setValue(this.combo.getValue())},this);var T=Ext.Toolbar;var pagingItems=[];if(this.displayInfo){pagingItems.push(this.displayItem=new T.TextItem({}))}if(this.rowComboSelect){var data=this.rowComboData?this.rowComboData:[[10],[20],[30],[50],[80],[100],[150],[200]];this.rowcombo=this.rowcombo||Ext.create({store:new Ext.data.SimpleStore({fields:["pageSize"],data:data}),value:this.pageSize,width:50,mode:"local",xtype:"combo",allowBlank:false,minListWidth:50,displayField:"pageSize",triggerAction:"all"});pagingItems.push(this.rowcombo,"条/页&nbsp;&nbsp;");this.rowcombo.on("select",this.onComboPageSize,this);this.rowcombo.on("specialkey",function(){this.combo.setValue(this.combo.getValue())},this)}pagingItems.push("->",this.first=new T.Button({tooltip:this.firstText,overflowText:this.firstText,iconCls:"x-tbar-page-first",disabled:true,handler:this.moveFirst,scope:this}),this.prev=new T.Button({tooltip:this.prevText,overflowText:this.prevText,iconCls:"x-tbar-page-prev",disabled:true,handler:this.movePrevious,scope:this}),"-",this.beforePageText,this.inputItem=this.combo,this.afterTextItem=new T.TextItem({text:String.format(this.afterPageText,1)}),"-",this.next=new T.Button({tooltip:this.nextText,overflowText:this.nextText,iconCls:"x-tbar-page-next",disabled:true,handler:this.moveNext,scope:this}),this.last=new T.Button({tooltip:this.lastText,overflowText:this.lastText,iconCls:"x-tbar-page-last",disabled:true,handler:this.moveLast,scope:this}),"-",this.refresh=new T.Button({tooltip:this.refreshText,overflowText:this.refreshText,iconCls:"x-tbar-loading",handler:this.doRefresh,scope:this}));var userItems=this.items||this.buttons||[];if(this.prependButtons===true){this.items=userItems.concat(pagingItems)}else{if(Ext.isNumber(this.prependButtons)){pagingItems.splice.apply(pagingItems,[this.prependButtons,0].concat(userItems));this.items=pagingItems}else{this.items=pagingItems.concat(userItems)}}delete this.buttons;Ext.PagingToolbar.superclass.initComponent.call(this);this.addEvents("change","beforechange");this.on("afterlayout",this.onFirstLayout,this,{single:true});this.cursor=0;this.bindStore(this.store,true)}});Ext.ux.PagingComBo=EasyJF.Ext.PagingComBo;Ext.reg("pagingComBo",Ext.ux.PagingComBo);Ext.grid.ObjectColumn=Ext.extend(Ext.grid.Column,{field:"",emptyText:"",constructor:function(cfg){Ext.grid.ObjectColumn.superclass.constructor.call(this,cfg);var et=this.emptyText,f=this.field;this.renderer=function(v){if(v){if(!Ext.isArray(f)){return Ext.value(Ext.getObjVal(v,f),et)}else{for(var i=0;i<f.length;i++){if(v.hasOwnProperty(f[i])){return Ext.value(v[f[i]],et)}}}}return et}}});Ext.grid.Column.types.objectcolumn=Ext.grid.ObjectColumn;Ext.apply(Ext.form.Field.prototype,{plugins:new EasyJF.Ext.HelpIconPlugin()});Ext.Ajax.on("beforerequest",function(conn,options){if(options.waitMsg){Ext.Msg.wait(options.waitMsg,options.waitTitle||"请稍候...")}});Ext.Ajax.on("requestcomplete",function(conn,response,options){if(response&&response.getResponseHeader&&response.getResponseHeader("LoginRequired")){EasyJF.Ext.Msg.alert("对不起，您还没有登录或者登录超时，请重新登录！","提示",function(){if(!EasyJF.Ext.LoginWin){var win=window.top?window.top:window;if(win.relogin&&!EasyJF.Ext.isLogin){EasyJF.Ext.isLogin=true;win.relogin()}else{if(!win.relogin){win.location.href=""}}}else{if(!EasyJF.Ext.isLogin){EasyJF.Ext.isLogin=true;var loginWin=new EasyJF.Ext.LoginWin();loginWin.show()}}});return}if(response&&response.getResponseHeader&&response.getResponseHeader("Unauthorized")){EasyJF.Ext.Msg.alert("你没有该项操作的权限，请与管理员联系！","警告");return}if(options.waitMsg){Ext.MessageBox.updateProgress(1);Ext.MessageBox.hide()}});Ext.Ajax.on("requestexception",function(conn,response,options){var code=response.status||0;var Msg=EasyJF.Ext.Msg;switch(code){case 0:case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:Msg.error("您的网络连接发生中断!","通讯异常!","警告");return false;break;case -1:return false;break;case 403:EasyJF.Ext.Msg.alert("您没有操作的权限，请与管理员联系!"+code,"警告!");return false;break;default:if(code<200||code>=300){var data=Ext.decode(response.responseText);var errMsg="发生了其它通讯异常，异常状态编码为"+code+"警告!";if(Ext.getObjVal(data,"err")){errMsg=Ext.getObjVal(data,"err")}EasyJF.Ext.Msg.error(errMsg);return false}}return true});new Ext.KeyMap(document.documentElement,[{key:Ext.EventObject.BACKSPACE,fn:function(key,e){var regExp=/(?:INPUT|TEXTAREA)/;if(!regExp.test(e.getTarget().nodeName)){e.stopEvent()}}}]);Ejf.Ext=EasyJF.Ext;